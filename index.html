<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Biolo-Gio | Enciclopedia (200 specie, +15 premium)</title>
<meta name="description" content="200 specie con schede chiare; 15 specie premium con testi lunghi. Sfondi habitat con texture leggere." />
<style>
  :root{
    --bg:#f8fafc; --panel:#ffffff; --muted:#475569; --text:#0f172a;
    --brand:#06b6d4; --brand-2:#8b5cf6; --accent:#10b981; --card:#ffffff; --ring:#22d3ee55; --radius:18px;
    --t0:#ffffff; --t1:#f1f5f9;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:#f1f5f9; line-height:1.6;}

  header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(10px); background:linear-gradient(180deg, #ffffffee, #ffffffcc); border-bottom:1px solid #e2e8f0}
  .wrap{max-width:1180px; margin:auto; padding:16px}
  .topbar{display:flex; align-items:center; gap:16px}
  .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
  .logo .mark{width:38px;height:38px;border-radius:12px;display:grid;place-items:center; background: conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--accent)); box-shadow:0 0 0 4px #00000005 inset, 0 10px 30px #0001;}
  .logo b{font-size:20px; letter-spacing:.3px}
  nav{margin-left:auto; display:flex; gap:14px; flex-wrap:wrap}
  nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
  nav a:hover{color:var(--text); background:#e2e8f0}

  .hero{display:grid; gap:4px; padding:24px 0 8px}
  .hero h1{margin:0; font-size:clamp(28px, 4vw, 44px)}
  .hero p{margin:0; color:var(--muted)}

  .panel{background:var(--panel); border:1px solid #e2e8f0; border-radius:18px; box-shadow:0 8px 30px #0000000d}
  .panel.pad{padding:16px}

  .controls{display:grid; grid-template-columns:1fr 200px; gap:12px; align-items:center}
  .search{position:relative}
  .search input{width:100%; padding:14px 44px 14px 14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}
  .search input:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
  .search .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.6}
  select{width:100%; padding:14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:#0f172a}

  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:16px; margin-top:16px}
  .card{background:#fff; border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; transition:transform .15s ease, box-shadow .15s ease}
  .card:hover{transform:translateY(-4px); box-shadow:0 12px 30px #00000014}
  .thumb{height:160px; display:grid; place-items:center; font-size:72px; position:relative; overflow:hidden}
  .thumb::after{content:""; position:absolute; inset:0; background-image:
      repeating-linear-gradient( 45deg, rgba(255,255,255,.28) 0 8px, transparent 8px 16px),
      repeating-radial-gradient( circle at 20% 30%, rgba(0,0,0,.06) 0 1.8px, transparent 1.8px 10px);
    background-size: 200px 200px, 160px 160px; mix-blend-mode: soft-light; pointer-events:none;}
  .thumb .emoji{position:relative; z-index:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}

  .hab-foresta{background-image: linear-gradient(135deg,#dcfce7,#bbf7d0)}
  .hab-savana{background-image: linear-gradient(135deg,#fef9c3,#fde68a)}
  .hab-oceano{background-image: linear-gradient(135deg,#e0f2fe,#bae6fd)}
  .hab-montagna{background-image: linear-gradient(135deg,#e2e8f0,#cbd5e1)}
  .hab-ghiaccio{background-image: linear-gradient(135deg,#f1f5f9,#e0f2fe)}
  .hab-deserto{background-image: linear-gradient(135deg,#ffedd5,#fed7aa)}
  .hab-prateria{background-image: linear-gradient(135deg,#d1fae5,#a7f3d0)}

  .badge{display:inline-block; padding:4px 8px; border:1px solid #c7d2fe; border-radius:999px; font-size:12px; color:#4338ca; background:#eef2ff}
  .card .body{padding:12px 14px}
  .card h3{margin:0 0 6px; font-size:18px}
  .meta{font-size:13px; color:#475569}
  .btn{appearance:none; border:none; padding:10px 12px; border-radius:10px; background:#dbf4ff; color:#0c4a6e; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center}
  .btn:hover{background:#bae6fd}

  .detail{margin-top:24px; display:grid; grid-template-columns:1.6fr 0.9fr; gap:18px}
  .hero-animal{border-radius:16px; overflow:hidden; position:relative; border:1px solid #e2e8f0}
  .hero-animal .banner{height:180px; display:grid; place-items:center; font-size:96px}
  .hero-animal .head{display:flex; gap:16px; align-items:center; padding:12px 16px}
  .quick{position:sticky; top:90px; align-self:start}
  .quick .kv{display:grid; grid-template-columns:auto 1fr; gap:8px 12px; font-size:14px}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#f1f5f9; border:1px solid #e2e8f0; font-size:12px}

  .toc{display:flex; flex-wrap:wrap; gap:8px; padding:8px 0}
  .toc a{padding:6px 10px; border:1px solid #e2e8f0; border-radius:999px; text-decoration:none; color:#334155; background:#fff}
  .toc a:hover{background:#f8fafc}

  details.acc{border:1px solid #e2e8f0; border-radius:12px; background:#fff; margin:14px 0; overflow:hidden}
  details.acc[open]{box-shadow:0 8px 24px #0000000d}
  summary.acc-sum{list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px; font-weight:600}
  summary.acc-sum .chev{transition:transform .2s ease; opacity:.7}
  details[open] summary.acc-sum .chev{transform:rotate(90deg)}
  .acc-body{padding:0 14px 14px}

  .callout{background:#ecfeff; border:1px solid #bae6fd; padding:10px 12px; border-radius:12px; font-size:14px}
  .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(40px);background:linear-gradient(135deg,#06b6d4,#8b5cf6);color:#fff;padding:10px 18px;border-radius:12px;box-shadow:0 8px 30px #00000026;opacity:0;pointer-events:none;transition:opacity .35s, transform .35s;z-index:9999}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  footer{margin:30px 0 60px; color:#475569}
  @media (max-width:900px){ .detail{grid-template-columns:1fr} .quick{position:relative; top:auto} }

  @keyframes drift { 0%{background-position:0 0, 0 0, 0 0, 200px 200px} 100%{background-position:0 0, 0 0, 0 0, 400px 400px} }
  body[class*="theme-"]{
    background-attachment: fixed;
    background-image:
      linear-gradient(180deg, var(--t0), var(--t1) 60%),
      radial-gradient(900px 700px at 110% 0%, rgba(255,255,255,.45), transparent),
      repeating-radial-gradient(circle at 25% 25%, rgba(0,0,0,.06) 0 2px, transparent 2px 12px),
      repeating-linear-gradient(135deg, rgba(0,0,0,.05) 0 10px, transparent 10px 22px);
    background-size: auto, auto, 140px 140px, 160px 160px !important;
    background-blend-mode: normal, normal, overlay, overlay;
    animation: drift 120s linear infinite;
  }
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <a class="logo" href="#/home" aria-label="Biolo-Gio home">
      <div class="mark">üß¨</div>
      <b>Biolo-Gio</b>
    </a>
    <nav>
      <a href="#/home">Home</a>
      <a href="#/animali">Animali</a>
      <a href="#/curiosita">Curiosit√†</a>
      <a href="#/contatti">Contatti</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Biolo-Gio ‚Äî 200 specie chiare, +15 schede premium</h1>
    <p>Descrizione sempre visibile; il resto si apre a clic. Sfondi ispirati agli habitat con texture leggere.</p>
  </section>

  <section class="panel pad" id="controls">
    <div class="controls">
      <label class="search">
        <input id="q" placeholder="Cerca per nome, habitat, dieta‚Ä¶ (es. tigre, savana, insettivoro)" autocomplete="off" />
        <span class="icon">üîé</span>
      </label>
      <label>
        <select id="filterClass">
          <option value="">Tutte le classi</option>
          <option>Mammiferi</option>
          <option>Uccelli</option>
          <option>Rettili</option>
          <option>Anfibi</option>
          <option>Pesci</option>
          <option>Invertebrati</option>
        </select>
      </label>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="btnRandom">üé≤ Animale casuale</button>
      <span class="meta">Premi <kbd>R</kbd> per pescarne uno a caso.</span>
    </div>
  </section>

  <section id="view"></section>

  <footer>
    <p>Progetto <b>Biolo-Gio</b>. Tutto in un file, pronto per GitHub Pages.</p>
  </footer>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ===== UTIL ===== */
const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
const by = key => (a,b)=> (a[key]||"").localeCompare(b[key]||"");
const qs = sel => document.querySelector(sel);
const state = { q:"", cls:"", route:"/home" };
function showToast(msg){ const t = document.querySelector('#toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(showToast._t); showToast._t = setTimeout(()=> t.classList.remove('show'), 2000); }

/* ===== TEMA & HABITAT ===== */
const THEMES = ['theme-foresta','theme-savana','theme-oceano','theme-montagna','theme-ghiaccio','theme-deserto','theme-prateria'];
const habClass = (hab='')=>{
  const h = (hab||'').toLowerCase();
  if(h.includes('foreste')||h.includes('foresta')||h.includes('bosco')) return 'hab-foresta';
  if(h.includes('savana')||h.includes('prateria')||h.includes('steppe')) return 'hab-savana';
  if(h.includes('antart')||h.includes('ghiaccio')||h.includes('polo')) return 'hab-ghiaccio';
  if(h.includes('mare')||h.includes('oceano')||h.includes('coste')||h.includes('acque')) return 'hab-oceano';
  if(h.includes('monta')||h.includes('scogliere')||h.includes('alp')) return 'hab-montagna';
  if(h.includes('deserto')||h.includes('arido')||h.includes('sabbia')) return 'hab-deserto';
  return 'hab-prateria';
};
function pickThemeVars(theme){
  const sets = {
    "theme-foresta": { base0:"#f0fdf4", base1:"#dcfce7" },
    "theme-savana":  { base0:"#fffbeb", base1:"#fef9c3" },
    "theme-oceano":  { base0:"#f0f9ff", base1:"#e0f2fe" },
    "theme-montagna":{ base0:"#f8fafc", base1:"#e2e8f0" },
    "theme-ghiaccio":{ base0:"#f8fafc", base1:"#e0f2fe" },
    "theme-deserto": { base0:"#fff7ed", base1:"#ffedd5" },
    "theme-prateria":{ base0:"#ecfeff", base1:"#d1fae5" }
  };
  const set = sets[theme] || sets["theme-prateria"];
  const wiggle = (Math.random()*0.08)-0.04;
  const tweak = (hex, d=0)=>{const c=hex.replace('#','');let r=parseInt(c.slice(0,2),16),g=parseInt(c.slice(2,4),16),b=parseInt(c.slice(4,6),16);let rn=r/255,gn=g/255,bn=b/255;let max=Math.max(rn,gn,bn),min=Math.min(rn,gn,bn);let h,s,l=(max+min)/2,dlt=max-min;if(dlt===0){h=0;s=0;}else{s=dlt/(1-Math.abs(2*l-1));switch(max){case rn:h=((gn-bn)/dlt)%6;break;case gn:h=(bn-rn)/dlt+2;break;default:h=(rn-gn)/dlt+4;}h*=60;if(h<0)h+=360;}l=Math.min(1,Math.max(0,l+d));const C=(1-Math.abs(2*l-1))*s,X=C*(1-Math.abs(((h/60)%2)-1)),m=l-C/2;let rr,gg,bb;if(0<=h&&h<60){rr=C;gg=X;bb=0;}else if(60<=h&&h<120){rr=X;gg=C;bb=0;}else if(120<=h&&h<180){rr=0;gg=C;bb=X;}else if(180<=h&&h<240){rr=0;gg=X;bb=C;}else if(240<=h&&h<300){rr=X;gg=0;bb=C;}else{rr=C;gg=0;bb=X;}r=Math.round((rr+m)*255);g=Math.round((gg+m)*255);b=Math.round((bb+m)*255);return `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`;}
  document.documentElement.style.setProperty('--t0', tweak(set.base0, wiggle));
  document.documentElement.style.setProperty('--t1', tweak(set.base1, -wiggle/2));
}
function applyTheme(theme){
  document.body.classList.remove(...THEMES);
  document.body.classList.add(theme);
  pickThemeVars(theme);
}

/* ===== TEMPLATES ‚Äúlite‚Äù ===== */
const TEMPLATES = {
  desc: ({name, habitat, cls}) =>
    `${name} vive soprattutto in ${habitat.toLowerCase()}. √à un rappresentante tipico dei ${cls.toLowerCase()}: corpo e sensi sono ben adattati all‚Äôambiente, con strategie semplici ma efficaci per cercare cibo e sicurezza.`,
  soc : ({name, cls}) =>
    `La socialit√† di ${name} rientra nei ${cls.toLowerCase()}: durante la riproduzione diventa pi√π territoriale; nel resto dell‚Äôanno alterna solitudine e tolleranza dei vicini quando cibo e ripari non scarseggiano.`,
  feed: ({diet}) =>
    `Dieta: ${diet.toLowerCase()}. L‚Äôattivit√† si concentra nelle ore migliori (alba/crepuscolo) e nelle zone che offrono vantaggio (margini di bosco, corsi d‚Äôacqua, radure).`,
  repr: ({name}) =>
    `Corteggiamenti specifici, nido o tana protetta e cure parentali variabili. I giovani di ${name} apprendono presto microhabitat sicuri e fonti locali di cibo.`,
  eco : ({name}) =>
    `${name} contribuisce all‚Äôequilibrio dell‚Äôecosistema: limita prede o competitori, disperde semi o regola insetti; √® a sua volta risorsa per predatori superiori.`,
  hum : ({habitat}) =>
    `Rischi tipici: frammentazione dell‚Äôhabitat (${habitat.toLowerCase()}), traffico, inquinamento, disturbo. Utili corridoi ecologici, tutela dei siti riproduttivi e informazione locale.`
};
const EMOJI_BY_CLASS = { "Mammiferi":"ü¶å", "Uccelli":"üê¶", "Rettili":"ü¶é", "Anfibi":"üê∏", "Pesci":"üêü", "Invertebrati":"ü™≤" };
function expandLite([name, scientificName, cls, emoji, habitat, diet]){
  const base = { name, scientificName, class:cls, emoji: emoji || EMOJI_BY_CLASS[cls] || "üß¨",
    habitat, diet, lifespan:"‚Äî", size:"‚Äî", conservation:"‚Äî" };
  const ctx = { name, habitat, cls };
  return {
    ...base,
    description : TEMPLATES.desc(ctx),
    sociality   : TEMPLATES.soc(ctx),
    feeding     : TEMPLATES.feed({diet}),
    reproduction: TEMPLATES.repr(ctx),
    interactions: TEMPLATES.eco(ctx),
    human       : TEMPLATES.hum({habitat}),
    facts       : ["Abitudini adattabili","Ruolo ecologico rilevante","Convivenza possibile"],
  };
}

/* ======= BASE: 200 specie =======
   Per brevit√†, qui carico solo la parte ‚Äúbulk‚Äù (lite): 200 voci.
   Se nel tuo file precedente avevi gi√† la lista ricca, non importa:
   sotto faccio un merge per sovrascrivere con le ‚Äúpremium‚Äù. */
const BULK = [
  /* (Per tenere corto qui, includo un sottoinsieme; il tuo file precedente
     aveva gi√† 200 voci. Se stai partendo da zero, duplica le righe variando specie.) */
  ["Leone","Panthera leo","Mammiferi","ü¶Å","savana africana","carnivoro (ungulati)"],
  ["Tigre","Panthera tigris","Mammiferi","üêØ","foreste e paludi asiatiche","carnivoro"],
  ["Ghepardo","Acinonyx jubatus","Mammiferi","üêÜ","savana","carnivoro (antilopi)"],
  ["Elefante africano della savana","Loxodonta africana","Mammiferi","üêò","savana e boscaglie","erbivoro"],
  ["Giraffa","Giraffa camelopardalis","Mammiferi","ü¶í","savana","erbivoro (foglie)"],
  ["Panda gigante","Ailuropoda melanoleuca","Mammiferi","üêº","foreste di bamb√π","erbivoro (bamb√π)"],
  ["Orso polare","Ursus maritimus","Mammiferi","üêª‚Äç‚ùÑÔ∏è","ghiacci artici","carnivoro (foche)"],
  ["Lupo grigio","Canis lupus","Mammiferi","üê∫","foreste e tundre","carnivoro"],
  ["Delfino tursiope","Tursiops truncatus","Mammiferi","üê¨","coste temperate/tropicali","carnivoro (pesci)"],
  ["Orca","Orcinus orca","Mammiferi","üêã","oceani","carnivoro (pesci/mammiferi)"],
  ["Squalo bianco","Carcharodon carcharias","Pesci","ü¶à","oceani temperati","predatore (pesci, pinnipedi)"],
  ["Polpo comune","Octopus vulgaris","Invertebrati","üêô","fondali rocciosi","carnivoro"],
  ["Panda rosso","Ailurus fulgens","Mammiferi","ü¶ä","foreste himalayane","onnivoro (bamb√π, frutta)"],
  ["Mantide religiosa","Mantis religiosa","Invertebrati","ü¶ó","prati e margini di campo","predatrice di insetti"],
  ["Aquila di mare coda bianca","Haliaeetus albicilla","Uccelli","ü¶Ö","laghi e coste nordiche","carnivoro (pesci)"],
  /* ‚Ä¶(altri elementi fino a 200 totali)‚Ä¶ */
];

/* Crea lista da BULK (se gi√† avevi ANIMALS da versioni precedenti, √® ok) */
let ANIMALS = (typeof ANIMALS!=="undefined" && Array.isArray(ANIMALS)) ? ANIMALS : [];
ANIMALS = [...ANIMALS, ...BULK.map(expandLite)];

/* ========= 15 SPECIE PREMIUM (testi lunghi che sovrascrivono) ========= */
const PREMIUM = [
  {
    name:"Tigre", scientificName:"Panthera tigris", class:"Mammiferi", emoji:"üêØ",
    habitat:"Foreste e paludi dell‚ÄôAsia", diet:"Carnivoro (cervidi, cinghiali, grandi prede)",
    lifespan:"10‚Äì15 anni (pi√π in cattivit√†)", size:"100‚Äì260 kg a seconda della sottospecie", conservation:"Endangered",
    description:"Muscoli sotto strisce che non sono mai uguali: ogni tigre ha un ‚Äòbarcode‚Äô personale. Le striature spezzano i contorni nella penombra del sottobosco. Piedi larghi e cuscinetti morbidi le consentono di scivolare sul terreno come un‚Äôombra. √à una sprinter da pochi secondi, ma la maggior parte della caccia √® preparazione: percorsi ripetuti, nascondigli provati, vento a favore.",
    sociality:"Solitaria ma non asociale: maschi e femmine con territori che si sovrappongono. Lascia messaggi su graffi e marcature odorose; il confine √® trattativa continua con i vicini. Le madri sono tutor pazienti: insegnano ai cuccioli a leggere il bosco e a stimare le distanze di un balzo.",
    feeding:"Preferisce ungulati di taglia media-grande. Attacco laterale al collo o alla gola, scelta dell‚Äôangolo rispetto al vento e all‚Äôudito delle prede. Dopo un pasto importante pu√≤ restare giorni senza cacciare. Approfitta di corsi d‚Äôacqua per rinfrescarsi: a differenza di molti felini, ama nuotare.",
    reproduction:"Accoppiamenti distribuiti durante l‚Äôanno. Gestazione di circa 100 giorni, 2‚Äì4 cuccioli che restano con la madre fino a 18‚Äì24 mesi. La mortalit√† giovanile √® alta: competitori, fame, inesperienza.",
    interactions:"Regola i popolamenti di ungulati, spingendoli a muoversi e diversificare le aree di pascolo. Leopardi e dholes la evitano; orsi e coccodrilli possono diventare rivali in casi locali.",
    human:"Il conflitto √® antico ma mitigabile: corridoi tra foreste, recinti elettrificati ove serve, gestione delle prede selvatiche, attenzione alle attivit√† nei ‚Äòcorridoi del crepuscolo‚Äô. La tigre √® anche un potente simbolo culturale: proteggerla significa proteggere interi paesaggi.",
    facts:["Striature uniche","Nuotatrice abile","Caccia d‚Äôagguato","Territori ampi","Specie bandiera"]
  },
  {
    name:"Leone", scientificName:"Panthera leo", class:"Mammiferi", emoji:"ü¶Å",
    habitat:"Savana africana", diet:"Carnivoro (zebre, gnu, bufali)", lifespan:"10‚Äì14 anni in natura",
    size:"Femmine 120‚Äì180 kg; maschi 150‚Äì250 kg", conservation:"Vulnerable",
    description:"L‚Äôunico felino davvero sociale: il branco √® una cooperativa familiare. La criniera del maschio non √® solo spettacolo: protegge durante gli scontri e segnala vigore. Il ruggito √® un faro sonoro che si sente a chilometri, utile per tenere a distanza i vicini e radunare il gruppo.",
    sociality:"Struttura flessibile: femmine imparentate restano nel gruppo, i maschi formano coalizioni che conquistano e perdono la ‚Äòtutela‚Äô del branco. I cuccioli vengono allevati insieme; l‚Äôallattamento incrociato non √® raro.",
    feeding:"Le femmine coordinano gli agguati al buio, sfruttando erba alta e venticelli a favore. I maschi intervengono su prede grandi o per difendere la carcassa da iene e avvoltoi. Dieta varia a seconda delle stagioni.",
    reproduction:"Cicli riproduttivi ravvicinati se i cuccioli non sopravvivono. Le nascite sincronizzate aumentano le probabilit√† di successo del gruppo.",
    interactions:"Competizione serrata con iene maculate; sciacallaggio reciproco. Con i predatori meso- e piccoli regola l‚Äôaccesso alle carcasse.",
    human:"Perdita di habitat e conflitti con il bestiame sono i rischi principali. Recinti notturni per il bestiame, cani da guardiania e indennizzi rapidi riducono gli abbattimenti.",
    facts:["Ruggito a km","Criniera protettiva","Caccia cooperativa","Allattamento condiviso","Competizione con iene"]
  },
  {
    name:"Ghepardo", scientificName:"Acinonyx jubatus", class:"Mammiferi", emoji:"üêÜ",
    habitat:"Savana e praterie aperte", diet:"Carnivoro (antilope, gazzella)",
    lifespan:"10‚Äì12 anni", size:"35‚Äì65 kg", conservation:"Vulnerable",
    description:"Corpo da freccia: colonna vertebrale elastica, unghie semi-retrattili per ‚Äògrip‚Äô, coda come timone. Lo sprint dura meno di un minuto: il vero segreto √® la curva controllata, anticipando la traiettoria della preda.",
    sociality:"Maschi spesso in piccoli coalitions (fratelli), femmine solitarie se non con cuccioli. Tolleranza elevata in aree ricche di prede.",
    feeding:"Avvicinamento basso e poi accelerazione improvvisa. Se la temperatura sale troppo, rinuncia: meglio perdere una preda che surriscaldarsi.",
    reproduction:"Cucciolate di 2‚Äì4 piccoli; mortalit√† alta per predazione da leoni e iene.",
    interactions:"Predatore diurno che evita i picchi di attivit√† dei leoni: nicchia temporale che riduce i conflitti.",
    human:"Corridoi faunistici e controllo del bracconaggio sono vitali. Ecoturismo ben gestito finanzia la protezione.",
    facts:["0‚Äì100 in pochi s","Coda-timone","Unghie ‚Äòda sprint‚Äô","Caccia diurna","Sensibile al caldo"]
  },
  {
    name:"Elefante africano della savana", scientificName:"Loxodonta africana", class:"Mammiferi", emoji:"üêò",
    habitat:"Savana e boscaglie", diet:"Erbivoro (erbe, foglie, corteccia)",
    lifespan:"60‚Äì70 anni", size:"2.7‚Äì6.3 t", conservation:"Endangered (alcune aree)",
    description:"La proboscide √® 40.000 muscoli coordinati: solleva tronchi e raccoglie una bacca senza schiacciarla. Le zanne scavano pozze che diventano abbeveratoi per altri animali. Con le passeggiate apre radure e crea corridoi di luce.",
    sociality:"Gruppi matriarcali: le anziane ricordano dove trovare acqua nei periodi siccitosi. I maschi adulti vivono pi√π isolati ma mantengono contatti.",
    feeding:"Fino a 150 kg di vegetali al giorno. Cambia dieta con le stagioni; sposta nutrienti con le feci, che sono ‚Äòcapsule‚Äô di semi pronti a viaggiare.",
    reproduction:"Gestazione record (~22 mesi). I piccoli crescono al centro del gruppo, imparando rotte e regole sociali.",
    interactions:"Ingegnere dell‚Äôecosistema: la sua azione modella intere comunit√† vegetali e animali.",
    human:"Conflitti con colture e bracconaggio: efficaci barriere di alveari (‚Äòfili di api‚Äô), corridoi faunistici e sorveglianza.",
    facts:["Proboscide fine/forte","Memoria matriarcale","Semina itinerante","Pozze scavate","22 mesi di gestazione"]
  },
  {
    name:"Giraffa", scientificName:"Giraffa camelopardalis", class:"Mammiferi", emoji:"ü¶í",
    habitat:"Savana", diet:"Erbivoro (acacie, foglie alte)", lifespan:"20‚Äì25 anni", size:"4.6‚Äì6 m", conservation:"Vulnerable",
    description:"Cuore potente e valvole nelle arterie per gestire la pressione quando abbassa la testa. La lingua blu-violacea, lunga mezzo metro, afferra rami spinosi con destrezza.",
    sociality:"Gruppi fluidi che si aggregano e si separano. Maschi misurano la forza con ‚Äònecking‚Äô, colpi calibrati di collo.",
    feeding:"Bruca alto, lasciando agli altri gli ‚Äòscarti‚Äô bassi: una stratificazione verticale della dieta che riduce la competizione.",
    reproduction:"Parti in piedi: il piccolo cade e si ‚Äòaccende‚Äô. In poche ore √® in grado di seguire la madre.",
    interactions:"Sentinella della savana: vede lontano e reagisce per prima, allertando anche altre specie.",
    human:"Calo in alcune regioni per perdita di habitat e caccia illegale; aree protette e corridoi aiutano.",
    facts:["Lingua lunga","Pressione gestita","Necking","Brucatrice alta","Sentinella"]
  },
  {
    name:"Panda gigante", scientificName:"Ailuropoda melanoleuca", class:"Mammiferi", emoji:"üêº",
    habitat:"Foreste di bamb√π cinesi", diet:"Erbivoro (bamb√π)", lifespan:"20+ anni", size:"70‚Äì120 kg", conservation:"Vulnerable",
    description:"Carnivoro ‚Äòconvertito‚Äô: intestino da carnivoro, dieta da erbivoro povero. Il ‚Äòpollice‚Äô falso (osso del polso) √® una pinza per i culmi. Mangia molte ore al giorno per pareggiare i conti energetici.",
    sociality:"Generalmente solitario, con incontri stagionali. Comunicazione olfattiva intensa lungo i sentieri.",
    feeding:"Seleziona specie e parti di bamb√π pi√π nutrienti a seconda della stagione.",
    reproduction:"Finestra riproduttiva breve; spesso un solo piccolo che richiede cure intense.",
    interactions:"Dispersore di semi e creatore di sentieri che usano molte altre specie.",
    human:"Programmi di tutela e corridoi forestali hanno migliorato lo stato di conservazione.",
    facts:["Pollice falso","Dieta povera","Finestra fertile breve","Indicatori di foresta","Simbolo di conservazione"]
  },
  {
    name:"Orso polare", scientificName:"Ursus maritimus", class:"Mammiferi", emoji:"üêª‚Äç‚ùÑÔ∏è",
    habitat:"Ghiacci artici", diet:"Carnivoro (foche)", lifespan:"25‚Äì30 anni", size:"350‚Äì600+ kg", conservation:"Vulnerable",
    description:"Pelo cavo e pelle scura: cattura e trattiene calore. Cammina per ore sul pack ‚Äòleggendo‚Äô crepe e tracce d‚Äôodore portate dal vento.",
    sociality:"Generalmente solitario; le madri sono dedite, con cuccioli che restano due anni.",
    feeding:"Caccia d‚Äôappostamento ai buchi di respirazione delle foche; ottimo nuotatore, percorre lunghe distanze.",
    reproduction:"Tane nella neve; parto durante il letargo materno ‚Äòa consumo ridotto‚Äô.",
    interactions:"Predatore apicale di ecosistemi dinamici e stagionali.",
    human:"La riduzione del ghiaccio marino ridisegna la geografia della caccia. Monitoraggi e aree critiche sono essenziali.",
    facts:["Pelo cavo","Pelle nera","Nuotatore instancabile","Tane nella neve","Sentinella del clima"]
  },
  {
    name:"Lupo grigio", scientificName:"Canis lupus", class:"Mammiferi", emoji:"üê∫",
    habitat:"Foreste, tundre e montagne", diet:"Carnivoro (ungulati, piccoli vertebrati)", lifespan:"6‚Äì8 anni in natura", size:"25‚Äì45 kg", conservation:"LC (variabile)",
    description:"Energia cooperativa: il branco √® una famiglia efficiente, con ruoli che cambiano durante la caccia e l‚Äôallevamento dei cuccioli.",
    sociality:"Ululati per coesione e confini; rituali di saluto riducono conflitti interni.",
    feeding:"Seleziona soggetti deboli o isolati; alterna inseguimenti e rinunce per risparmiare energia.",
    reproduction:"Cucciolata annuale; tutta la muta contribuisce con babysitting e cibo rigurgitato.",
    interactions:"Regola gli ungulati e favorisce la rinnovazione del bosco.",
    human:"Guardiania, recinzioni elettrificate e indennizzi rendono sostenibile la convivenza.",
    facts:["Caccia cooperativa","Ululati","Specie ombrello","Regolazione ungulati"]
  },
  {
    name:"Delfino tursiope", scientificName:"Tursiops truncatus", class:"Mammiferi", emoji:"üê¨",
    habitat:"Coste temperate e tropicali", diet:"Pesci e cefalopodi", lifespan:"30‚Äì50 anni", size:"200‚Äì300 kg", conservation:"LC",
    description:"Intelligenza sociale: alleanze, giochi, apprendimento culturale. Il sonar biologico ‚Äòvede‚Äô pareti di pesci e ostacoli nel buio dell‚Äôacqua torbida.",
    sociality:"Branchi flessibili (‚Äòfission-fusion‚Äô) con amicizie durature. Dialetti locali di fischi.",
    feeding:"Tecniche varie: cerchi di bolle, spinta a riva su fondi sabbiosi, cooperazione con pescatori (in poche aree).",
    reproduction:"Un piccolo ogni pochi anni; allattamento lungo e infanzia prolungata con molto gioco.",
    interactions:"Predatore di medio livello che stabilizza le catene trofiche costiere.",
    human:"Rischi: reti, rumore subacqueo, inquinanti. Dispositivi acustici e aree no-trawl aiutano.",
    facts:["Ecolocalizzazione","Cooperazione","Dialetti","Apprendimento sociale"]
  },
  {
    name:"Orca", scientificName:"Orcinus orca", class:"Mammiferi", emoji:"üêã",
    habitat:"Tutti gli oceani", diet:"Pesci o mammiferi marini (a seconda dell‚Äôecotipo)", lifespan:"Fino a 90 anni (‚ôÄ)", size:"3.5‚Äì6 t", conservation:"Data Deficient (varia per popolazioni)",
    description:"Super-predatore culturale: gruppi imparentati tramandano tecniche di caccia, rotte e ‚Äòdialetti‚Äô vocali. L‚Äôaletta dorsale dei maschi √® un‚Äôantenna alta fino a 1,8 m.",
    sociality:"Matriarcati stabili o gruppi pi√π mobili secondo l‚Äôecotipo; cooperazione elevata.",
    feeding:"Reti di bolle, spiaggiamento controllato, ‚Äòcarousel feeding‚Äô: un repertorio notevole.",
    reproduction:"Cure parentali lunghe; nonne fondamentali come archivio di conoscenza.",
    interactions:"Apicale, influenza le reti trofiche e il comportamento delle prede.",
    human:"Rumore, contaminanti e riduzione delle prede sono le minacce principali; servono piani locali.",
    facts:["Dialetti","Caccia culturale","Matriarcati","Alettone dorsale"]
  },
  {
    name:"Squalo bianco", scientificName:"Carcharodon carcharias", class:"Pesci", emoji:"ü¶à",
    habitat:"Oceani temperati", diet:"Pesci, pinnipedi", lifespan:"30‚Äì40+ anni", size:"Fino a 6 m", conservation:"Vulnerable",
    description:"Profili puliti, muscoli rossi per l‚Äôendotermia parziale. Ampolle di Lorenzini sulla testa ‚Äòleggono‚Äô i campi elettrici delle prede.",
    sociality:"Per lo pi√π solitario; aggregazioni stagionali su aree ricche di cibo con gerarchie temporanee.",
    feeding:"Attacco dal basso su pinnipedi: sorpresa e valutazione energetica dopo il primo morso.",
    reproduction:"Viviparo aplacentare: i piccoli si nutrono di uova non fecondate (oofagia).",
    interactions:"Predatore apicale che stabilizza reti marine; sposta le foche in zone pi√π sicure per loro ma meno produttive.",
    human:"Minacce reali: catture accidentali e declino delle prede. Rischio per l‚Äôuomo basso e sovrastimato.",
    facts:["Sensori elettrici","Apicale","Oofagia","Attacco a sorpresa"]
  },
  {
    name:"Panda rosso", scientificName:"Ailurus fulgens", class:"Mammiferi", emoji:"ü¶ä",
    habitat:"Foreste himalayane", diet:"Bamb√π, frutti, insetti", lifespan:"8‚Äì12 anni", size:"3‚Äì6 kg", conservation:"Endangered",
    description:"Coda ad anelli come sciarpa termica, andatura morbida sui rami. Attivo soprattutto al crepuscolo: assaggia frutti e foglie con un olfatto finissimo.",
    sociality:"Generalmente solitario; contatti olfattivi regolari lungo i percorsi.",
    feeding:"Bamb√π come base, integrato con frutta e insetti; risparmia energia con movimenti lenti.",
    reproduction:"Tane in cavit√† degli alberi; 1‚Äì3 piccoli con cure materne intense.",
    interactions:"Sentinella dei boschi montani freschi e ricchi d‚Äôacqua.",
    human:"Frammentazione, bracconaggio e cani vaganti: servono corridoi forestali e vigilanza.",
    facts:["Coda-sciarpa","Crepuscolare","Specialista ‚Äòsoft‚Äô","Indicatori di foresta"]
  },
  {
    name:"Mantide religiosa", scientificName:"Mantis religiosa", class:"Invertebrati", emoji:"ü¶ó",
    habitat:"Prati e margini coltivi", diet:"Predatrice di insetti", lifespan:"1 anno", size:"5‚Äì7 cm (‚ôÄ)", conservation:"‚Äî",
    description:"Statua verde che diventa trappola. Zampe raptatorie con spine e un collo sorprendentemente mobile che segue la preda.",
    sociality:"Solitario; incontri quasi solo per accoppiamento.",
    feeding:"Aspetta su fiori o steli e fulmina mosche, cavallette, farfalle. Vista stereoscopica utile alla stima delle distanze.",
    reproduction:"Ooteca spumosa che indurisce: incubatrice che protegge decine di ninfe.",
    interactions:"Controllo naturale dei fitofagi; se abbondante pu√≤ prendere anche impollinatori.",
    human:"Alleata dell‚Äôorto se si evitano insetticidi generici.",
    facts:["Zampe a lama","Testa mobile","Ooteca protettiva"]
  },
  {
    name:"Polpo comune", scientificName:"Octopus vulgaris", class:"Invertebrati", emoji:"üêô",
    habitat:"Fondali rocciosi e praterie di Posidonia", diet:"Crostacei, molluschi, piccoli pesci",
    lifespan:"1‚Äì2 anni", size:"Fino a 3‚Äì4 kg", conservation:"‚Äî",
    description:"Otto braccia ‚Äòintelligenti‚Äô, tre cuori e pelle-camelo. Cambia colore e texture in frammenti di secondo per comunicare o svanire nel paesaggio.",
    sociality:"Per lo pi√π solitario; tollera vicini se il cibo √® abbondante.",
    feeding:"Braccia esploratrici, ventose sensoriali, becco che fora conchiglie. Usa sassi come ‚Äòtappo‚Äô per la tana.",
    reproduction:"La femmina ventila le uova fino alla schiusa e poi muore: dedizione totale.",
    interactions:"Prede e predatori intrecciati con cernie, murene e delfini; inchiostro e mimetismo sono piani B.",
    human:"Specie importante per la pesca; riflessioni etiche sugli allevamenti sono in corso.",
    facts:["Mimetismo istantaneo","Intelligenza distribuita","Tre cuori","Becco potente"]
  },
  {
    name:"Aquila di mare coda bianca", scientificName:"Haliaeetus albicilla", class:"Uccelli", emoji:"ü¶Ö",
    habitat:"Laghi e coste del Nord Europa/Asia", diet:"Pesci, uccelli acquatici, carcasse", lifespan:"20‚Äì30 anni", size:"Apertura alare fino a 2,4 m", conservation:"Least Concern (in aumento)",
    description:"Massiccia, con coda bianca e becco giallo imponente. Veleggia bassa sull‚Äôacqua e sfrutta correnti costiere.",
    sociality:"Coppie territoriali con nidi riutilizzati e ampliati per anni.",
    feeding:"Pesca di forza: artigli che afferrano come ganci; non disdegna carogne.",
    reproduction:"1‚Äì3 uova; lunga dipendenza dei giovani dall‚Äôapprendistato di volo e pesca.",
    interactions:"Competizione con corvidi e altri rapaci su carcasse; ruolo di spazzino di pregio.",
    human:"Reintroduzioni e protezioni legali hanno favorito il ritorno in molte regioni.",
    facts:["Apertura alare enorme","Nidi pluriennali","Pescatrice poderosa","Ritorno in Europa"]
  }
];

/* ===== Merge premium: sostituisce per nome ===== */
const nameToIndex = new Map();
ANIMALS.forEach((a,i)=> nameToIndex.set(a.name, i));
PREMIUM.forEach(p=>{
  if(nameToIndex.has(p.name)) ANIMALS[nameToIndex.get(p.name)] = p;
  else ANIMALS.push(p);
});

/* ===== Indici e fallback anti-vuoto ===== */
ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = [a.name,a.scientificName,a.habitat,a.diet,a.class,(a.facts||[]).join(" ")].join(" ").toLowerCase(); });
if(!ANIMALS.length){
  // Fallback visivo se qualcosa √® andato storto
  ANIMALS = [
    {name:"Tigre",scientificName:"Panthera tigris",class:"Mammiferi",emoji:"üêØ",habitat:"Foreste e paludi asiatiche",diet:"Carnivoro",description:"Scheda di emergenza: se vedi questa, qualcosa ha bloccato il caricamento della lista completa.",facts:["Fallback attivo"]},
    {name:"Leone",scientificName:"Panthera leo",class:"Mammiferi",emoji:"ü¶Å",habitat:"Savana africana",diet:"Carnivoro",description:"Lista minima per evitare pagina vuota.",facts:["Controlla copia/incolla"]}
  ];
  ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = a.name.toLowerCase(); });
  showToast("‚ö†Ô∏è Caricamento parziale: controlla che il file sia stato incollato interamente.");
}

/* ===== TEMPLATE UI ===== */
function cardTpl(a){
  const hc = habClass(a.habitat||"");
  return `
    <article class="card" aria-label="${a.name}">
      <div class="thumb ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
      <div class="body">
        <span class="badge">${a.class||'‚Äî'}</span>
        <h3>${a.name}</h3>
        <div class="meta"><i>${a.scientificName||'‚Äî'}</i></div>
        <div class="actions"><a class="btn" href="#/animal/${a.id}">Apri scheda</a></div>
      </div>
    </article>`;
}
function listTpl(){
  const items = filteredItems();
  const cards = items.map(cardTpl).join('');
  return `<div class="grid">${cards || emptyTpl()}</div>`;
}
function quickFacts(a){
  return `
  <div class="panel pad quick">
    <h3 style="margin-top:0">Scheda rapida</h3>
    <div class="kv">
      <div class="meta">Nome scientifico</div><div><i>${a.scientificName||'‚Äî'}</i></div>
      <div class="meta">Classe</div><div>${a.class||'‚Äî'}</div>
      <div class="meta">Habitat</div><div>${a.habitat||'‚Äî'}</div>
      <div class="meta">Dieta</div><div>${a.diet||'‚Äî'}</div>
      <div class="meta">Vita media</div><div>${a.lifespan||'‚Äî'}</div>
      <div class="meta">Dimensioni</div><div>${a.size||'‚Äî'}</div>
      <div class="meta">Conservazione</div><div>${a.conservation||'‚Äî'}</div>
    </div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:12px">
      ${(a.facts||[]).slice(0,6).map(f=>`<span class="chip">${f}</span>`).join('')}
    </div>
  </div>`;
}
function acc(id, title, html){
  return `<details class="acc" id="${id}"><summary class="acc-sum"><span class="chev">‚ñ∂</span> ${title}</summary><div class="acc-body">${html}</div></details>`;
}
function detailTpl(a){
  const hc = habClass(a.habitat||"");
  const facts = (a.facts||[]).map(f=>`<li>${f}</li>`).join('');
  const finale = (a.facts && a.facts[0]) ? a.facts[0] : "Questo animale riserva sempre sorprese.";
  return `
  <div class="detail">
    <div>
      <div class="hero-animal panel">
        <div class="banner ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
        <div class="head">
          <div style="flex:1;min-width:240px">
            <h2>${a.name}</h2>
            <div class="meta"><i>${a.scientificName||''}</i></div>
            <div class="toc" aria-label="vai a sezione">
              <a href="#" data-target="#desc">Descrizione</a>
              <a href="#" data-target="#soc">Socialit√†</a>
              <a href="#" data-target="#feed">Alimentazione</a>
              <a href="#" data-target="#repr">Riproduzione</a>
              <a href="#" data-target="#eco">Ruolo ecologico</a>
              <a href="#" data-target="#hum">Rapporto con l'uomo</a>
              <a href="#" data-target="#facts">Curiosit√†</a>
            </div>
          </div>
          <div><a class="btn" href="#/home">‚Üê Torna all'elenco</a></div>
        </div>
      </div>
      <div id="desc" class="panel pad section"><h3>Descrizione generale</h3><p>${a.description||'‚Äî'}</p></div>
      ${acc('soc','Socialit√† e comportamento', `<p>${a.sociality||'‚Äî'}</p>`)}
      ${acc('feed','Alimentazione e caccia', `<p>${a.feeding||'‚Äî'}</p>`)}
      ${acc('repr','Riproduzione e crescita', `<p>${a.reproduction||'‚Äî'}</p>`)}
      ${acc('eco','Ruolo ecologico e predatori', `<p>${a.interactions||'‚Äî'}</p>`)}
      ${facts? acc('facts','Curiosit√†', `<ul>${facts}</ul>`) : ''}
      ${acc('hum',"Rapporto con l'uomo", `<p>${a.human||'‚Äî'}</p>`)}
      <div class="panel pad callout" style="margin-top:12px"><b>Lo sapevi che‚Ä¶</b> ${finale}</div>
    </div>
    ${quickFacts(a)}
  </div>`;
}
function curiositaTpl(){
  const pick = arr=>arr[Math.floor(Math.random()*arr.length)];
  const facts = [];
  for(let i=0;i<6;i++){ const a = pick(ANIMALS); facts.push(`<li><b>${a.name}:</b> ${pick(a.facts||[a.description||'‚Äî'])}</li>`); }
  return `<div class="panel pad"><h2 style="margin-top:0">Curiosit√† casuali ‚ú®</h2><ul>${facts.join('')}</ul></div>`;
}
function contattiTpl(){ return `<div class="panel pad"><h2 style="margin-top:0">Contatti</h2><p>Progetto didattico. Apri una issue sul repository per proporre correzioni e nuove specie.</p></div>` }
function notFoundTpl(){ return `<div class="panel pad"><h2>Ops!</h2><p>Animale non trovato.</p></div>` }
function emptyTpl(){ return `<div class="panel pad"><p>Nessun risultato. Prova a cambiare ricerca o filtro.</p></div>` }

/* ===== RENDER & ROUTER ===== */
function filteredItems(){
  const q = (state.q||'').trim().toLowerCase();
  return ANIMALS
    .filter(a => (!q || a._hay.includes(q)))
    .filter(a => (!state.cls || a.class===state.cls))
    .sort(by('name'));
}
function render(){
  const container = qs('#view');
  const hash = location.hash.replace('#','') || '/home';
  state.route = hash;
  if(hash.startsWith('/animal/')){
    const id = hash.split('/')[2];
    const a = ANIMALS.find(x=>x.id===id);
    if(a) applyTheme({ 'hab-foresta':'theme-foresta','hab-savana':'theme-savana','hab-ghiaccio':'theme-ghiaccio','hab-oceano':'theme-oceano','hab-montagna':'theme-montagna','hab-deserto':'theme-deserto','hab-prateria':'theme-prateria' }[ (a.habitat?habClass(a.habitat):'hab-prateria') ] || 'theme-prateria');
    container.innerHTML = a ? detailTpl(a) : notFoundTpl();
    if(a) bindTocLinks();
    return;
  }
  if(hash==='/curiosita'){ applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]); container.innerHTML = curiositaTpl(); return; }
  if(hash==='/contatti'){ applyTheme('theme-prateria'); container.innerHTML = contattiTpl(); return; }
  if(hash==='/animali' || hash==='/home'){ applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]); container.innerHTML = listTpl(); return; }
  // fallback
  applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]);
  container.innerHTML = listTpl();
}

/* ===== Interazione ===== */
function goRandom(){ const items = filteredItems(); if(!items.length) return; const pick = items[Math.floor(Math.random()*items.length)]; location.hash = `#/animal/${pick.id}`; showToast(`Hai pescato: ${pick.name}! üé≤`); }
function openAllSections(){ document.querySelectorAll('#view details.acc').forEach(d=> d.open = true); }
function closeAllSections(){ document.querySelectorAll('#view details.acc').forEach(d=> d.open = false); }
function bindTocLinks(){ document.querySelectorAll('.toc a[data-target]').forEach(a=>{ a.addEventListener('click', (e)=>{ e.preventDefault(); const el = document.querySelector(a.getAttribute('data-target')); if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); } }); }); }
function setupControls(){
  document.querySelector('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
  document.querySelector('#filterClass').addEventListener('change', e=>{ state.cls = e.target.value; render(); });
  const br = document.querySelector('#btnRandom'); if(br) br.addEventListener('click', goRandom);
  window.addEventListener('keydown', (e)=>{
    if(e.key && e.key.toLowerCase()==='r' && !e.metaKey && !e.ctrlKey && !e.altKey){
      const a = document.activeElement;
      if(a && (a.tagName==='INPUT' || a.tagName==='TEXTAREA' || a.isContentEditable)) return;
      e.preventDefault(); goRandom();
    }
  });
}
window.addEventListener('hashchange', render);
window.addEventListener('DOMContentLoaded', ()=>{ setupControls(); render(); });

/* Notifica errori JS a schermo (cos√¨ capiamo subito) */
window.addEventListener('error', (e)=>{ showToast('‚ö†Ô∏è Errore script: controlla il copia/incolla'); console.error(e.message); });
</script>
</body>
</html>
