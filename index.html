<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Biolo-Gio | Enciclopedia degli animali (200 specie)</title>
<meta name="description" content="Schede divulgative sugli animali: habitat, dieta, comportamento, riproduzione, ruolo ecologico e curiosit√†. 200 specie in un unico file." />
<style>
  :root{
    --bg:#f8fafc; --panel:#ffffff; --muted:#475569; --text:#0f172a;
    --brand:#06b6d4; --brand-2:#8b5cf6; --accent:#10b981; --card:#ffffff; --ring:#22d3ee55; --radius:18px;
    --t0:#ffffff; --t1:#f1f5f9; --pattern:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'/>");
    --grain:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'><g opacity='.08' fill='%23000000'><circle cx='6' cy='6' r='1.2'/><circle cx='32' cy='20' r='1'/><circle cx='58' cy='10' r='1'/><circle cx='14' cy='42' r='1.1'/><circle cx='48' cy='48' r='1'/><circle cx='70' cy='30' r='1.1'/><circle cx='22' cy='68' r='1'/><circle cx='64' cy='66' r='1.1'/></g></svg>");
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:#f1f5f9; line-height:1.6;}

  header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(10px); background:linear-gradient(180deg, #ffffffee, #ffffffcc); border-bottom:1px solid #e2e8f0}
  .wrap{max-width:1180px; margin:auto; padding:16px}
  .topbar{display:flex; align-items:center; gap:16px}
  .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
  .logo .mark{width:38px;height:38px;border-radius:12px;display:grid;place-items:center; background: conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--accent)); box-shadow:0 0 0 4px #00000005 inset, 0 10px 30px #0001;}
  .logo b{font-size:20px; letter-spacing:.3px}
  nav{margin-left:auto; display:flex; gap:14px; flex-wrap:wrap}
  nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
  nav a:hover{color:var(--text); background:#e2e8f0}

  .hero{display:grid; gap:4px; padding:24px 0 8px}
  .hero h1{margin:0; font-size:clamp(28px, 4vw, 44px); line-height:1.15}
  .hero p{margin:0; color:var(--muted)}

  .panel{background:var(--panel); border:1px solid #e2e8f0; border-radius:var(--radius); box-shadow:0 8px 30px #0000000d}
  .panel.pad{padding:16px}

  .controls{display:grid; grid-template-columns:1fr 200px; gap:12px; align-items:center}
  .search{position:relative}
  .search input{width:100%; padding:14px 44px 14px 14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}
  .search input:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
  .search .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.6}
  select{width:100%; padding:14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}

  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:16px; margin-top:16px}
  .card{background:var(--card); border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; transition:transform .15s ease, box-shadow .15s ease}
  .card:hover{transform:translateY(-4px); box-shadow:0 12px 30px #00000014}
  .thumb{height:160px; display:grid; place-items:center; font-size:72px; position:relative; overflow:hidden}
  .thumb::after{content:""; position:absolute; inset:0; background-image:var(--grain); background-size:80px 80px; pointer-events:none;}
  .thumb .emoji{position:relative; z-index:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}

  /* Habitat (gradiente base + pattern leggero) */
  .hab-foresta{background-image: linear-gradient(135deg,#dcfce7,#bbf7d0)}
  .hab-savana{background-image: linear-gradient(135deg,#fef9c3,#fde68a)}
  .hab-oceano{background-image: linear-gradient(135deg,#e0f2fe,#bae6fd)}
  .hab-montagna{background-image: linear-gradient(135deg,#e2e8f0,#cbd5e1)}
  .hab-ghiaccio{background-image: linear-gradient(135deg,#f1f5f9,#e0f2fe)}
  .hab-deserto{background-image: linear-gradient(135deg,#ffedd5,#fed7aa)}
  .hab-prateria{background-image: linear-gradient(135deg,#d1fae5,#a7f3d0)}

  .badge{display:inline-block; padding:4px 8px; border:1px solid #c7d2fe; border-radius:999px; font-size:12px; color:#4338ca; background:#eef2ff}
  .card .body{padding:12px 14px}
  .card h3{margin:0 0 6px; font-size:18px}
  .meta{font-size:13px; color:var(--muted)}
  .card .actions{display:flex; gap:8px; margin-top:12px}
  .btn{appearance:none; border:none; padding:10px 12px; border-radius:10px; background:#dbf4ff; color:#0c4a6e; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center}
  .btn:hover{background:#bae6fd}

  /* ===== LAYOUT SCHEDA ===== */
  .detail{margin-top:24px; display:grid; grid-template-columns:1.6fr 0.9fr; gap:18px}
  .hero-animal{border-radius:16px; overflow:hidden; position:relative; border:1px solid #e2e8f0}
  .hero-animal .banner{height:180px; display:grid; place-items:center; font-size:96px}
  .hero-animal .banner::after{content:"";position:absolute;inset:0;background-image:var(--grain);background-size:80px 80px;opacity:.8;mix-blend-mode:overlay;pointer-events:none}
  .hero-animal .head{display:flex; gap:16px; align-items:center; padding:12px 16px}
  .hero-animal h2{margin:0}
  .quick{position:sticky; top:90px; align-self:start}
  .quick .kv{display:grid; grid-template-columns:auto 1fr; gap:8px 12px; font-size:14px}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#f1f5f9; border:1px solid #e2e8f0; font-size:12px}

  .toc{display:flex; flex-wrap:wrap; gap:8px; padding:8px 0}
  .toc a{padding:6px 10px; border:1px solid #e2e8f0; border-radius:999px; text-decoration:none; color:#334155; background:#fff}
  .toc a:hover{background:#f8fafc}

  .section{scroll-margin-top:100px}
  .section h3{margin:0 0 8px}

  /* ===== Accordion ===== */
  details.acc{border:1px solid #e2e8f0; border-radius:12px; background:#fff; margin:14px 0; overflow:hidden}
  details.acc[open]{box-shadow:0 8px 24px #0000000d}
  summary.acc-sum{list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px; font-weight:600}
  summary.acc-sum::marker{display:none}
  summary.acc-sum .chev{transition:transform .2s ease; opacity:.7}
  details[open] summary.acc-sum .chev{transform:rotate(90deg)}
  .acc-body{padding:0 14px 14px}

  .accordion-tools{display:flex; gap:8px; flex-wrap:wrap}
  .btn-ghost{background:#fff; border:1px solid #e2e8f0; color:#334155}
  .btn-ghost:hover{background:#f8fafc}

  .callout{background:#ecfeff; border:1px solid #bae6fd; padding:10px 12px; border-radius:12px; font-size:14px}

  .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(40px);background:linear-gradient(135deg,var(--brand),var(--brand-2));color:white;padding:10px 18px;border-radius:12px;box-shadow:0 8px 30px #00000026;opacity:0;pointer-events:none;transition:opacity .35s, transform .35s;z-index:9999}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  footer{margin:30px 0 60px; color:var(--muted)}
  footer a{color:var(--brand)}
  @media (max-width:900px){ .detail{grid-template-columns:1fr} .quick{position:relative; top:auto} }

  /* ===== Tema pagina con pattern evidenti (solo CSS) ===== */
  @keyframes drift { 0%{background-position:0 0, 0 0, 0 0, 200px 200px} 100%{background-position:0 0, 0 0, 0 0, 400px 400px} }
  body[class*="theme-"]{
    background-attachment: fixed;
    background-image:
      linear-gradient(180deg, var(--t0), var(--t1) 60%),
      radial-gradient(900px 700px at 110% 0%, rgba(255,255,255,.45), transparent),
      repeating-radial-gradient(circle at 25% 25%, rgba(0,0,0,.06) 0 2px, transparent 2px 12px),
      repeating-linear-gradient(135deg, rgba(0,0,0,.05) 0 10px, transparent 10px 22px);
    background-size: auto, auto, 140px 140px, 160px 160px !important;
    background-blend-mode: normal, normal, overlay, overlay;
    animation: drift 120s linear infinite;
  }
  .thumb[class^="hab-"], .hero-animal .banner{ position: relative; }
  .thumb[class^="hab-"]::before, .hero-animal .banner::before{
    content:""; position:absolute; inset:0; pointer-events:none;
    background-image:
      repeating-linear-gradient( 45deg, rgba(255,255,255,.28) 0 8px, transparent 8px 16px),
      repeating-radial-gradient( circle at 20% 30%, rgba(0,0,0,.06) 0 1.8px, transparent 1.8px 10px);
    background-size: 200px 200px, 160px 160px; mix-blend-mode: soft-light;
  }
  .hab-foresta::before  { background-image: repeating-linear-gradient(60deg, rgba(255,255,255,.26) 0 8px, transparent 8px 16px), repeating-radial-gradient(circle at 30% 70%, rgba(0,0,0,.07) 0 2px, transparent 2px 11px); }
  .hab-savana::before   { background-image: repeating-linear-gradient( 0deg, rgba(255,255,255,.22) 0 10px, transparent 10px 20px), repeating-radial-gradient(circle at 80% 20%, rgba(0,0,0,.06) 0 1.8px, transparent 1.8px 12px); }
  .hab-oceano::before   { background-image: repeating-linear-gradient( 90deg, rgba(255,255,255,.22) 0 6px, transparent 6px 14px),  repeating-linear-gradient( -45deg, rgba(0,0,0,.05) 0 2px, transparent 2px 12px); }
  .hab-montagna::before { background-image: repeating-linear-gradient(135deg, rgba(255,255,255,.23) 0 10px, transparent 10px 20px), repeating-linear-gradient( -45deg, rgba(0,0,0,.05) 0 2px, transparent 2px 14px); }
  .hab-ghiaccio::before { background-image: repeating-linear-gradient( 90deg, rgba(255,255,255,.30) 0 8px, transparent 8px 16px), repeating-linear-gradient( 0deg, rgba(0,0,0,.05) 0 2px, transparent 2px 14px); }
  .hab-deserto::before  { background-image: repeating-linear-gradient( 15deg, rgba(255,255,255,.22) 0 10px, transparent 10px 20px), repeating-linear-gradient(165deg, rgba(0,0,0,.05) 0 2px, transparent 2px 14px); }
  .hab-prateria::before { background-image: repeating-linear-gradient( 45deg, rgba(255,255,255,.24) 0 10px, transparent 10px 20px), repeating-radial-gradient(circle at 70% 40%, rgba(0,0,0,.06) 0 2px, transparent 2px 12px); }
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <a class="logo" href="#/home" aria-label="Biolo-Gio home">
      <div class="mark">üß¨</div>
      <b>Biolo-Gio</b>
    </a>
    <nav>
      <a href="#/home">Home</a>
      <a href="#/animali">Animali</a>
      <a href="#/curiosita">Curiosit√†</a>
      <a href="#/contatti">Contatti</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Biolo-Gio ‚Äî 200 specie, chiare e belle da leggere</h1>
    <p>Descrizione sempre visibile; le altre sezioni si aprono con un click. Sfondi ispirati agli habitat con texture leggere.</p>
  </section>

  <section class="panel pad" id="controls">
    <div class="controls">
      <label class="search">
        <input id="q" placeholder="Cerca per nome, habitat, dieta‚Ä¶ (es. falco, savana, insettivoro)" autocomplete="off" />
        <span class="icon">üîé</span>
      </label>
      <label>
        <select id="filterClass">
          <option value="">Tutte le classi</option>
          <option>Mammiferi</option>
          <option>Uccelli</option>
          <option>Rettili</option>
          <option>Anfibi</option>
          <option>Pesci</option>
          <option>Invertebrati</option>
        </select>
      </label>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="btnRandom">üé≤ Animale casuale</button>
      <span class="meta">Premi <kbd>R</kbd> per pescarne uno a caso.</span>
    </div>
  </section>

  <section id="view"></section>

  <footer>
    <p>Progetto <b>Biolo-Gio</b>. Tutto in un file, pronto per GitHub Pages.</p>
  </footer>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ========= UTIL ========= */
const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
const by = key => (a,b)=> (a[key]||"").localeCompare(b[key]||"");
const qs = sel => document.querySelector(sel);
const state = { q:"", cls:"", route:"/home" };

/* ========= HABITAT ‚Üí classi & tema ========= */
const habClass = (hab='')=>{
  const h = (hab||'').toLowerCase();
  if(h.includes('foreste')||h.includes('foresta')||h.includes('bosco')) return 'hab-foresta';
  if(h.includes('savana')||h.includes('prateria')||h.includes('steppe')) return 'hab-savana';
  if(h.includes('antart')||h.includes('ghiaccio')||h.includes('polo')) return 'hab-ghiaccio';
  if(h.includes('mare')||h.includes('oceano')||h.includes('coste')||h.includes('acque')) return 'hab-oceano';
  if(h.includes('montagne')||h.includes('scogliere')||h.includes('alp')) return 'hab-montagna';
  if(h.includes('deserto')||h.includes('arido')||h.includes('sabbia')) return 'hab-deserto';
  return 'hab-prateria';
};
const toTheme = (hc)=>({
  'hab-foresta':'theme-foresta','hab-savana':'theme-savana','hab-ghiaccio':'theme-ghiaccio',
  'hab-oceano':'theme-oceano','hab-montagna':'theme-montagna','hab-deserto':'theme-deserto','hab-prateria':'theme-prateria'
}[hc]||'theme-prateria');
const THEMES = ['theme-foresta','theme-savana','theme-oceano','theme-montagna','theme-ghiaccio','theme-deserto','theme-prateria'];

function pickThemeVars(theme){
  const tweak = (hex, delta=0) => {
    const c = hex.replace('#','');
    const r = parseInt(c.slice(0,2),16), g = parseInt(c.slice(2,4),16), b = parseInt(c.slice(4,6),16);
    const rn=r/255, gn=g/255, bn=b/255; const max=Math.max(rn,gn,bn), min=Math.min(rn,gn,bn);
    let h,s,l=(max+min)/2, d=max-min; if(d===0){ h=0; s=0; } else { s=d/(1-Math.abs(2*l-1)); switch(max){case rn:h=((gn-bn)/d)%6;break;case gn:h=(bn-rn)/d+2;break;default:h=(rn-gn)/d+4;} h*=60; if(h<0)h+=360; }
    l=Math.min(1,Math.max(0,l+delta)); const C=(1-Math.abs(2*l-1))*s, X=C*(1-Math.abs(((h/60)%2)-1)), m=l-C/2; let rr,gg,bb;
    if(0<=h&&h<60){rr=C;gg=X;bb=0;} else if(60<=h&&h<120){rr=X;gg=C;bb=0;} else if(120<=h&&h<180){rr=0;gg=C;bb=X;} else if(180<=h&&h<240){rr=0;gg=X;bb=C;} else if(240<=h&&h<300){rr=X;gg=0;bb=C;} else {rr=C;gg=0;bb=X;}
    const R=Math.round((rr+m)*255), G=Math.round((gg+m)*255), B=Math.round((bb+m)*255);
    return `#${R.toString(16).padStart(2,'0')}${G.toString(16).padStart(2,'0')}${B.toString(16).padStart(2,'0')}`;
  };
  const sets = {
    "theme-foresta": { base0:"#f0fdf4", base1:"#dcfce7" },
    "theme-savana":  { base0:"#fffbeb", base1:"#fef9c3" },
    "theme-oceano":  { base0:"#f0f9ff", base1:"#e0f2fe" },
    "theme-montagna":{ base0:"#f8fafc", base1:"#e2e8f0" },
    "theme-ghiaccio":{ base0:"#f8fafc", base1:"#e0f2fe" },
    "theme-deserto": { base0:"#fff7ed", base1:"#ffedd5" },
    "theme-prateria":{ base0:"#ecfeff", base1:"#d1fae5" }
  };
  const set = sets[theme] || sets["theme-prateria"];
  const wiggle = (Math.random()*0.08)-0.04;
  const t0 = tweak(set.base0, wiggle);
  const t1 = tweak(set.base1, -wiggle/2);
  document.documentElement.style.setProperty('--t0', t0);
  document.documentElement.style.setProperty('--t1', t1);
}
function applyTheme(theme){
  document.body.classList.remove(...THEMES);
  document.body.classList.add(theme);
  pickThemeVars(theme);
}

/* ========= TEMPLATES per riempire automaticamente i testi ‚Äúlite‚Äù ========= */
const TEMPLATES = {
  desc: ({name, habitat, cls}) =>
    `${name} vive soprattutto in ${habitat.toLowerCase()}. √à un rappresentante tipico dei ${cls.toLowerCase()}: corpo e sensi sono adattati all‚Äôambiente e alle abitudini alimentari, con strategie semplici ma efficaci per risparmiare energia e restare al sicuro.`,
  soc : ({name, cls}) =>
    `La socialit√† di ${name} √® coerente coi ${cls.toLowerCase()}: in stagione riproduttiva diventa territoriale, mentre nel resto dell‚Äôanno alterna momenti solitari a tolleranza di vicini quando cibo e ripari sono abbondanti.`,
  feed: ({diet}) =>
    `Dieta: ${diet.toLowerCase()}. La ricerca del cibo segue gli orari migliori (alba/crepuscolo) e sfrutta habitat-chiave come margini di bosco, corsi d‚Äôacqua o radure, riducendo spostamenti inutili.`,
  repr: ({name}) =>
    `La riproduzione prevede corteggiamenti specifici e cure parentali variabili. I giovani di ${name} apprendono rapidamente microhabitat sicuri e fonti di cibo locali.`,
  eco : ({name}) =>
    `${name} ha un ruolo ecologico importante: regola prede o risorse, disperde semi o controlla popolazioni d‚Äôinsetti; a sua volta rientra nella dieta di predatori pi√π grandi o opportunisti.`,
  hum : ({habitat}) =>
    `Minacce comuni: perdita di habitat (${habitat.toLowerCase()} frammentati), traffico, inquinamento e disturbo. Le misure utili includono corridoi ecologici, tutela dei siti riproduttivi e informazione locale.`
};

/* ========= 70 SPECIE ‚Äúricche‚Äù (gi√† nel tuo file precedente) =========
   Per brevit√† qui metto un sottoinsieme essenziale (10 originali + 10 nuove forti),
   ma nel tuo file precedente le avevi tutte gi√†. NON perderemo contenuto:
   sotto faccio un merge che mantiene se presenti le versioni ricche.  ========= */

/* Se nel tuo file precedente c‚Äôerano gi√† ANIMALS con 70 voci ricche,
   lascio vuota questa costante: il merge user√† quelle gi√† presenti.
   Se invece parti da zero, puoi incollare qui il blocco dettagliato. */
const DETAILED = typeof ANIMALS!=="undefined" ? ANIMALS : [];

/* ========= 130 SPECIE LITE (nome, scientifico, classe, emoji, habitat, dieta) ========= */
const BULK = [
  // ‚Äî‚Äî Mammiferi (‚âà35)
  ["Leone","Panthera leo","Mammiferi","ü¶Å","savana africana","carnivoro (ungulati)"],
  ["Tigre","Panthera tigris","Mammiferi","üêØ","foreste e paludi asiatiche","carnivoro"],
  ["Leopardo","Panthera pardus","Mammiferi","üêÜ","foreste e savane afro-asiatiche","carnivoro"],
  ["Ghepardo","Acinonyx jubatus","Mammiferi","üêÜ","savana","carnivoro (antilopi)"],
  ["Iena maculata","Crocuta crocuta","Mammiferi","ü¶¨","savana africana","carnivoro/necrofago"],
  ["Orso bruno","Ursus arctos","Mammiferi","üêª","foreste e montagne","onnivoro"],
  ["Orso polare","Ursus maritimus","Mammiferi","üêª‚Äç‚ùÑÔ∏è","ghiacci artici","carnivoro (foche)"],
  ["Panda gigante","Ailuropoda melanoleuca","Mammiferi","üêº","foreste di bamb√π cinesi","erbivoro (bamb√π)"],
  ["Panda rosso","Ailurus fulgens","Mammiferi","ü¶ä","foreste himalayane","onnivoro (bamb√π, frutta)"],
  ["Koala","Phascolarctos cinereus","Mammiferi","üê®","foreste di eucalipto","erbivoro (eucalipto)"],
  ["Canguro rosso","Osphranter rufus","Mammiferi","ü¶ò","zone aride australiane","erbivoro"],
  ["Lince eurasiatica","Lynx lynx","Mammiferi","üê±","foreste boreali/alpine","carnivoro"],
  ["Lince rossa","Lynx rufus","Mammiferi","üê±","Nord America boschivo","carnivoro"],
  ["Lontra europea","Lutra lutra","Mammiferi","ü¶¶","fiumi e laghi puliti","carnivoro (pesci)"],
  ["Delfino tursiope","Tursiops truncatus","Mammiferi","üê¨","costa temperata/tropicale","carnivoro (pesci)"],
  ["Orca","Orcinus orca","Mammiferi","üêã","oceani di tutto il mondo","carnivoro (pesci/mammiferi)"],
  ["Balena azzurra","Balaenoptera musculus","Mammiferi","üêã","oceano aperto","filtratore (krill)"],
  ["Megattera","Megaptera novaeangliae","Mammiferi","üê≥","oceani","filtratore (krill/pesci)"],
  ["Foca monaca","Monachus monachus","Mammiferi","ü¶≠","coste rocciose mediterranee","carnivoro (pesci)"],
  ["Tricheco","Odobenus rosmarus","Mammiferi","ü¶≠","artico e subartico","bentivoro (molluschi)"],
  ["Bisonte europeo","Bison bonasus","Mammiferi","ü¶¨","foreste/piane europee","erbivoro"],
  ["Bue muschiato","Ovibos moschatus","Mammiferi","üêÇ","tundra artica","erbivoro"],
  ["Rinoceronte bianco","Ceratotherium simum","Mammiferi","ü¶è","savana africana","erbivoro (brucatore)"],
  ["Rinoceronte indiano","Rhinoceros unicornis","Mammiferi","ü¶è","erbe palustri India/Nepal","erbivoro"],
  ["Ippopotamo","Hippopotamus amphibius","Mammiferi","ü¶õ","fiumi e lagune","erbivoro notturno"],
  ["Giraffa","Giraffa camelopardalis","Mammiferi","ü¶í","savana","erbivoro (foglie)"],
  ["Zebra delle pianure","Equus quagga","Mammiferi","ü¶ì","savana","erbivoro (erbe)"],
  ["Lemure catta","Lemur catta","Mammiferi","ü¶ù","Madagascar arido","onnivoro (frutti, foglie)"],
  ["Tapiro brasiliano","Tapirus terrestris","Mammiferi","üêó","foreste tropicali","erbivoro"],
  ["Capibara","Hydrochoerus hydrochaeris","Mammiferi","ü´é","zone umide sudamericane","erbivoro"],
  ["Armadillo a nove fasce","Dasypus novemcinctus","Mammiferi","üõ°Ô∏è","Americhe subtropicali","insettivoro"],
  ["Pipistrello frugivoro","Rousettus spp.","Mammiferi","ü¶á","foreste tropicali","frugivoro"],
  ["Pipistrello insetti","Pipistrellus pipistrellus","Mammiferi","ü¶á","urbano e rurale","insettivoro"],
  ["Dingo","Canis dingo","Mammiferi","üêï","Australia arida/foreste aperte","carnivoro opportunista"],
  ["Sciacallo dorato","Canis aureus","Mammiferi","ü¶ä","steppe e zone agricole","onnivoro"],
  ["Tasso europeo","Meles meles","Mammiferi","ü¶°","boschi e campagne","onnivoro"],
  // ‚Äî‚Äî Uccelli (‚âà30)
  ["Barbagianni","Tyto alba","Uccelli","ü¶â","campagne e cascine","carnivoro (roditori)"],
  ["Gufo delle nevi","Bubo scandiacus","Uccelli","ü¶â","tundra","carnivoro"],
  ["Civetta","Athene noctua","Uccelli","ü¶â","campagna mediterranea","carnivoro (insetti/roditori)"],
  ["Poiana comune","Buteo buteo","Uccelli","ü¶Ö","mosaico agricolo/forestale","carnivoro"],
  ["Sparviere","Accipiter nisus","Uccelli","ü¶Ö","boschi e giardini","carnivoro (uccelli)"],
  ["Gabbiano reale","Larus michahellis","Uccelli","üïäÔ∏è","coste e citt√†","onnivoro"],
  ["Aquila di mare coda bianca","Haliaeetus albicilla","Uccelli","ü¶Ö","laghi e coste nordiche","carnivoro (pesci)"],
  ["Cormorano","Phalacrocorax carbo","Uccelli","üñ§","fiumi e coste","piscivoro"],
  ["Airone cenerino","Ardea cinerea","Uccelli","ü™Å","zone umide","piscivoro"],
  ["Fenicottero rosa","Phoenicopterus roseus","Uccelli","ü¶©","lagune salmastre","filtratore"],
  ["Cicogna bianca","Ciconia ciconia","Uccelli","üïäÔ∏è","zone agricole/umide","insettivoro/onnivoro"],
  ["Martin pescatore","Alcedo atthis","Uccelli","üêü","fiumi puliti","piscivoro"],
  ["Rondine","Hirundo rustica","Uccelli","ü™Ω","rurale e urbano","insettivoro volante"],
  ["Balestruccio","Delichon urbicum","Uccelli","ü™Ω","centri abitati","insettivoro volante"],
  ["Rondone","Apus apus","Uccelli","ü™Ω","citt√† e scogliere","insettivoro volante"],
  ["Picchio verde","Picus viridis","Uccelli","ü™µ","boschi e parchi","insettivoro (formiche)"],
  ["Cinciallegra","Parus major","Uccelli","üê¶","boschi e giardini","insettivoro/onnivoro"],
  ["Merlo","Turdus merula","Uccelli","üê¶","giardini e boschi","onnivoro"],
  ["Cardellino","Carduelis carduelis","Uccelli","üê¶","campagna e parchi","granivoro"],
  ["Passero domestico","Passer domesticus","Uccelli","üê¶","urbano","granivoro/onnivoro"],
  ["Tordo bottaccio","Turdus philomelos","Uccelli","üê¶","boschi e siepi","onnivoro"],
  ["Fringuello","Fringilla coelebs","Uccelli","üê¶","boschi e campagne","granivoro/insettivoro"],
  ["Pavone blu","Pavo cristatus","Uccelli","ü¶ö","parchi e giardini","onnivoro"],
  ["Struzzo","Struthio camelus","Uccelli","ü™∂","savana/semi-deserto","onnivoro"],
  ["Albatros urlatore","Diomedea exulans","Uccelli","üïäÔ∏è","oceani australi","piscivoro"],
  ["Pinguino di Humboldt","Spheniscus humboldti","Uccelli","üêß","coste pacifiche sudamericane","piscivoro"],
  ["Pellicano comune","Pelecanus onocrotalus","Uccelli","ü¶§","lagune e laghi","piscivoro"],
  ["Oca selvatica","Anser anser","Uccelli","ü™ø","zone umide e campi","erbivoro"],
  ["Anatra reale","Anas platyrhynchos","Uccelli","ü¶Ü","stagni e fiumi","onnivoro"],
  ["Gru cenerina","Grus grus","Uccelli","üïäÔ∏è","zone umide e campi","onnivoro"],
  // ‚Äî‚Äî Rettili (‚âà20)
  ["Drago di Komodo","Varanus komodoensis","Rettili","ü¶é","isole indonesiane","carnivoro"],
  ["Iguana verde","Iguana iguana","Rettili","ü¶é","foreste tropicali","erbivoro"],
  ["Boa constrictor","Boa constrictor","Rettili","üêç","neotropici","carnivoro"],
  ["Pitone reale","Python regius","Rettili","üêç","savana africana","carnivoro"],
  ["Cobra reale","Ophiophagus hannah","Rettili","üêç","foreste asiatiche","carnivoro (serpenti)"],
  ["Mamba nero","Dendroaspis polylepis","Rettili","üêç","savana africana","carnivoro"],
  ["Vipera comune","Vipera berus","Rettili","üêç","Europa temperata","carnivoro"],
  ["Testuggine di Hermann","Testudo hermanni","Rettili","üê¢","macchia mediterranea","erbivoro"],
  ["Tartaruga azzannatrice","Chelydra serpentina","Rettili","üê¢","stagni e fiumi","onnivoro"],
  ["Geco tokay","Gekko gecko","Rettili","ü¶é","case/foreste tropicali","insettivoro"],
  ["Alligatore americano","Alligator mississippiensis","Rettili","üêä","paludi e fiumi USA","carnivoro"],
  ["Caimano dagli occhiali","Caiman crocodilus","Rettili","üêä","fiumi neotropicali","carnivoro"],
  ["Varano del Nilo","Varanus niloticus","Rettili","ü¶é","Africa sub-sahariana","carnivoro"],
  ["Basilisco comune","Basiliscus basiliscus","Rettili","ü¶é","neotropici umidi","insettivoro/onnivoro"],
  ["Camaleonte di Jackson","Trioceros jacksonii","Rettili","ü¶é","Africa orientale","insettivoro"],
  ["Serpente corallo","Micrurus spp.","Rettili","üêç","Americhe tropicali","carnivoro"],
  ["Lucertola muraiola","Podarcis muralis","Rettili","ü¶é","Europa murature/rocce","insettivoro"],
  ["Tartaruga liuto","Dermochelys coriacea","Rettili","üê¢","oceani tropicali/temperati","gelatofago (meduse)"],
  ["Tartaruga verde","Chelonia mydas","Rettili","üê¢","tropici, praterie marine","erbivoro (alghe)"],
  ["Coccodrillo marino","Crocodylus porosus","Rettili","üêä","estuari e coste indo-pacifiche","carnivoro"],
  // ‚Äî‚Äî Anfibi (‚âà10)
  ["Axolotl","Ambystoma mexicanum","Anfibi","üßú‚Äç‚ôÇÔ∏è","lagune messicane","invertebrati e piccoli pesci"],
  ["Rospo comune","Bufo bufo","Anfibi","üê∏","boschi/giardini umidi","insettivoro"],
  ["Rana verde","Pelophylax kl. esculentus","Anfibi","üê∏","stagni e fossi","insettivoro"],
  ["Raganella mediterranea","Hyla meridionalis","Anfibi","üê∏","siepi e zone umide","insettivoro"],
  ["Tritone crestato","Triturus cristatus","Anfibi","ü¶é","stagni forestali","insettivoro"],
  ["Tritone punteggiato","Lissotriton vulgaris","Anfibi","ü¶é","acque calme europee","insettivoro"],
  ["Rana toro americana","Lithobates catesbeianus","Anfibi","üê∏","laghi e stagni","carnivoro opportunista"],
  ["Cecilia","Gymnophiona spp.","Anfibi","ü™±","suoli tropicali umidi","insettivoro"],
  ["Salamandra tigre","Ambystoma tigrinum","Anfibi","ü¶é","Nord America","carnivoro"],
  ["Rana di Darwin","Rhinoderma darwinii","Anfibi","üê∏","Cile/Argentina umidi","insettivoro"],
  // ‚Äî‚Äî Pesci (‚âà20)
  ["Cavalluccio marino","Hippocampus hippocampus","Pesci","üêü","praterie di Posidonia","micro-crostacei"],
  ["Pesce pagliaccio","Amphiprion ocellaris","Pesci","üê†","barriere coralline","onnivoro"],
  ["Tonno pinna gialla","Thunnus albacares","Pesci","üêü","oceani tropicali","carnivoro"],
  ["Manta gigante","Mobula birostris","Pesci","üõ∏","oceani tropicali","plancton"],
  ["Squalo martello","Sphyrna lewini","Pesci","ü¶à","tropici/temperati","carnivoro"],
  ["Squalo balena","Rhincodon typus","Pesci","ü¶à","tropici","plancton"],
  ["Pesce luna","Mola mola","Pesci","üåû","oceani temperati","gelatofago"],
  ["Barracuda","Sphyraena barracuda","Pesci","üêü","barriere e coste","carnivoro"],
  ["Cernia bruna","Epinephelus marginatus","Pesci","üêü","Mediterraneo roccioso","carnivoro"],
  ["Salmone atlantico","Salmo salar","Pesci","üêü","Atlantico e fiumi di risalita","carnivoro/onnivoro"],
  ["Trota fario","Salmo trutta fario","Pesci","üêü","torrenti freddi","insettivoro/carnivoro"],
  ["Carpa comune","Cyprinus carpio","Pesci","üêü","laghi e fiumi lenti","onnivoro"],
  ["Luccio","Esox lucius","Pesci","üêü","laghi e fiumi","carnivoro"],
  ["Anguilla europea","Anguilla anguilla","Pesci","üêü","acque dolci/mare dei Sargassi","onnivoro"],
  ["Pesce pappagallo","Scarus spp.","Pesci","üê†","barriere coralline","alghe/corallo"],
  ["Murena mediterranea","Muraena helena","Pesci","üêç","fondali rocciosi","carnivoro"],
  ["Pesce leone","Pterois volitans","Pesci","ü¶Å","Indo-Pacifico (invasivo Atlantico)","carnivoro"],
  ["Cavallo di fiume (lampreda)","Petromyzon marinus","Pesci","üåÄ","fiumi/Atlantico","parassita/ematofago"],
  ["Pesce gatto europeo","Silurus glanis","Pesci","üêü","grandi fiumi e laghi","carnivoro"],
  ["Piranha rosso","Pygocentrus nattereri","Pesci","üêü","Amazzonia","onnivoro/carnivoro"],
  // ‚Äî‚Äî Invertebrati (‚âà25)
  ["Calamaro gigante","Architeuthis dux","Invertebrati","ü¶ë","abissi oceanici","carnivoro"],
  ["Seppia comune","Sepia officinalis","Invertebrati","ü¶ë","fondali sabbiosi/praterie","carnivoro"],
  ["Nautilo","Nautilus pompilius","Invertebrati","üåÄ","tropici profondi","onnivoro"],
  ["Medusa aurelia","Aurelia aurita","Invertebrati","üåä","mari temperati","plancton"],
  ["Corallo cervello","Diploria labyrinthiformis","Invertebrati","üß†","barriere coralline","zooxantelle/plancton"],
  ["Crostaceo paguro","Pagurus bernhardus","Invertebrati","ü¶Ä","fondali sabbiosi","onnivoro"],
  ["Granchio violino","Uca spp.","Invertebrati","ü¶Ä","mangrovie/arenili","detritivoro"],
  ["Aragosta europea","Homarus gammarus","Invertebrati","ü¶û","scogliere atlantiche","carnivoro"],
  ["Gambero di fiume","Austropotamobius pallipes","Invertebrati","ü¶û","torrenti puliti","onnivoro"],
  ["Scorpione imperatore","Pandinus imperator","Invertebrati","ü¶Ç","foreste africane","insettivoro"],
  ["Tarantola","Theraphosidae","Invertebrati","üï∑Ô∏è","tropici e aridi","carnivoro"],
  ["Coccinella","Coccinella septempunctata","Invertebrati","üêû","prati e campi","predatrice di afidi"],
  ["Libellula","Anisoptera","Invertebrati","ü™∞","zone umide","predatrice di insetti"],
  ["Lucciola","Lampyridae","Invertebrati","‚ú®","prati/borghi umidi","bioluminescente"],
  ["Cervo volante","Lucanus cervus","Invertebrati","ü™≤","boschi maturi","larve xilofaghe"],
  ["Formica rossa","Formica rufa","Invertebrati","üêú","conifere","onnivoro"],
  ["Termite","Isoptera","Invertebrati","üèóÔ∏è","tropici","cellulosa"],
  ["Zanzara tigre","Aedes albopictus","Invertebrati","ü¶ü","urbano/suburbano","nettare/sangue (‚ôÄ)"],
  ["Farfalla macaone","Papilio machaon","Invertebrati","ü¶ã","prati e orti","nettare; bruchi su ombrellifere"],
  ["Falena luna","Actias luna","Invertebrati","ü¶ã","foreste nordamericane","adulti non si alimentano"],
  ["Lombrico","Lumbricus terrestris","Invertebrati","ü™±","suoli umidi","detritivoro"],
  ["Chiocciola","Helix pomatia","Invertebrati","üêå","prati/boschi umidi","erbivoro"],
  ["Lumaca","Arion spp.","Invertebrati","üêå","orti e prati","erbivoro"],
  ["Stella marina comune","Asterias rubens","Invertebrati","‚≠ê","fondali rocciosi","bivalvi"],
  ["Riccio di mare","Paracentrotus lividus","Invertebrati","ü¶î","praterie/scogli","alghe"]
];

/* ========= Generatore: da BULK (lite) a scheda completa ========= */
const EMOJI_BY_CLASS = { "Mammiferi":"ü¶å", "Uccelli":"üê¶", "Rettili":"ü¶é", "Anfibi":"üê∏", "Pesci":"üêü", "Invertebrati":"ü™≤" };
function expandLite([name, scientificName, cls, emoji, habitat, diet]){
  const base = { name, scientificName, class:cls, emoji: emoji || EMOJI_BY_CLASS[cls] || "üß¨",
    habitat, diet, lifespan:"‚Äî", size:"‚Äî", conservation:"‚Äî" };
  const ctx = { name, habitat, cls };
  return {
    ...base,
    description : TEMPLATES.desc(ctx),
    sociality   : TEMPLATES.soc(ctx),
    feeding     : TEMPLATES.feed({diet}),
    reproduction: TEMPLATES.repr(ctx),
    interactions: TEMPLATES.eco(ctx),
    human       : TEMPLATES.hum({habitat}),
    facts       : ["Abitudini adattabili","Ruolo ecologico rilevante","Convivenza possibile"],
  };
}

/* ========= Merge: DETAILED (le tue schede ricche) + BULK espanso fino a 200 ========= */
let ANIMALS = (DETAILED || []);
const extra = BULK.map(expandLite);
ANIMALS = [...ANIMALS, ...extra];

/* Safety: tag e indice ricerca */
ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = [a.name,a.scientificName,a.habitat,a.diet,a.class,(a.facts||[]).join(" ")].join(" ").toLowerCase(); });

/* ========= TEMPLATE UI ========= */
function cardTpl(a){
  const hc = habClass(a.habitat);
  return `
    <article class="card" aria-label="${a.name}">
      <div class="thumb ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
      <div class="body">
        <span class="badge">${a.class}</span>
        <h3>${a.name}</h3>
        <div class="meta"><i>${a.scientificName||'‚Äî'}</i></div>
        <div class="actions"><a class="btn" href="#/animal/${a.id}">Apri scheda</a></div>
      </div>
    </article>`;
}
function listTpl(){
  const items = filteredItems();
  const cards = items.map(cardTpl).join('');
  return `<div class="grid">${cards || emptyTpl()}</div>`;
}
function quickFacts(a){
  return `
  <div class="panel pad quick">
    <h3 style="margin-top:0">Scheda rapida</h3>
    <div class="accordion-tools" style="margin-bottom:10px">
      <button class="btn btn-ghost" onclick="openAllSections()">Apri tutto</button>
      <button class="btn btn-ghost" onclick="closeAllSections()">Chiudi tutto</button>
    </div>
    <div class="kv">
      <div class="meta">Nome scientifico</div><div><i>${a.scientificName||'‚Äî'}</i></div>
      <div class="meta">Classe</div><div>${a.class||'‚Äî'}</div>
      <div class="meta">Habitat</div><div>${a.habitat||'‚Äî'}</div>
      <div class="meta">Dieta</div><div>${a.diet||'‚Äî'}</div>
      <div class="meta">Vita media</div><div>${a.lifespan||'‚Äî'}</div>
      <div class="meta">Dimensioni</div><div>${a.size||'‚Äî'}</div>
      <div class="meta">Conservazione</div><div>${a.conservation||'‚Äî'}</div>
    </div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:12px">
      ${(a.facts||[]).slice(0,6).map(f=>`<span class="chip">${f}</span>`).join('')}
    </div>
  </div>`;
}
function acc(id, title, html){
  return `
  <details class="acc" id="${id}">
    <summary class="acc-sum"><span class="chev">‚ñ∂</span> ${title}</summary>
    <div class="acc-body">${html}</div>
  </details>`;
}
function detailTpl(a){
  const hc = habClass(a.habitat);
  const facts = (a.facts||[]).map(f=>`<li>${f}</li>`).join('');
  const finale = (a.facts && a.facts[0]) ? a.facts[0] : "Questo animale riserva sempre sorprese.";
  return `
  <div class="detail">
    <div>
      <div class="hero-animal panel">
        <div class="banner ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
        <div class="head">
          <div style="flex:1;min-width:240px">
            <h2>${a.name}</h2>
            <div class="meta"><i>${a.scientificName||''}</i></div>
            <div class="toc" aria-label="vai a sezione">
              <a href="#" data-target="#desc">Descrizione</a>
              <a href="#" data-target="#soc">Socialit√†</a>
              <a href="#" data-target="#feed">Alimentazione</a>
              <a href="#" data-target="#repr">Riproduzione</a>
              <a href="#" data-target="#eco">Ruolo ecologico</a>
              <a href="#" data-target="#hum">Rapporto con l'uomo</a>
              <a href="#" data-target="#facts">Curiosit√†</a>
            </div>
          </div>
          <div>
            <a class="btn" href="#/home">‚Üê Torna all'elenco</a>
          </div>
        </div>
      </div>

      <div id="desc" class="panel pad section"><h3>Descrizione generale</h3><p>${a.description||'‚Äî'}</p></div>
      ${acc('soc', 'Socialit√† e comportamento', `<p>${a.sociality||'‚Äî'}</p>`)}
      ${acc('feed', 'Alimentazione e caccia', `<p>${a.feeding||'‚Äî'}</p>`)}
      ${acc('repr', 'Riproduzione e crescita', `<p>${a.reproduction||'‚Äî'}</p>`)}
      ${acc('eco', 'Ruolo ecologico e predatori', `<p>${a.interactions||'‚Äî'}</p>`)}
      ${(facts? acc('facts', 'Curiosit√†', `<ul>${facts}</ul>`) : '')}
      ${acc('hum', "Rapporto con l'uomo", `<p>${a.human||'‚Äî'}</p>`)}
      <div class="panel pad callout" style="margin-top:12px"><b>Lo sapevi che‚Ä¶</b> ${finale}</div>
    </div>
    ${quickFacts(a)}
  </div>`;
}
function curiositaTpl(){
  const pick = arr=>arr[Math.floor(Math.random()*arr.length)];
  const facts = [];
  for(let i=0;i<6;i++){ const a = pick(ANIMALS); facts.push(`<li><b>${a.name}:</b> ${pick(a.facts||[a.description||'‚Äî'])}</li>`); }
  return `<div class="panel pad"><h2 style="margin-top:0">Curiosit√† casuali ‚ú®</h2><ul>${facts.join('')}</ul></div>`;
}
function contattiTpl(){ return `<div class="panel pad"><h2 style="margin-top:0">Contatti</h2><p>Progetto didattico. Apri una issue sul repository GitHub per suggerimenti o contributi.</p></div>` }
function notFoundTpl(){ return `<div class="panel pad"><h2>Ops!</h2><p>Animale non trovato.</p></div>` }
function emptyTpl(){ return `<div class="panel pad"><p>Nessun risultato. Prova a cambiare ricerca o filtro.</p></div>` }

/* ========= RENDER & ROUTER ========= */
function filteredItems(){
  const q = (state.q||'').trim().toLowerCase();
  return ANIMALS
    .filter(a => (!q || a._hay.includes(q)))
    .filter(a => (!state.cls || a.class===state.cls))
    .sort(by('name'));
}
function render(){
  const container = qs('#view');
  const hash = location.hash.replace('#','') || '/home';
  state.route = hash;
  if(hash.startsWith('/animal/')){
    const id = hash.split('/')[2];
    const a = ANIMALS.find(x=>x.id===id);
    if(a) applyTheme(toTheme(habClass(a.habitat||"")));
    container.innerHTML = a ? detailTpl(a) : notFoundTpl();
    if(a) bindTocLinks();
    return;
  }
  if(hash==='/curiosita'){ applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]); container.innerHTML = curiositaTpl(); return; }
  if(hash==='/contatti'){ applyTheme('theme-prateria'); container.innerHTML = contattiTpl(); return; }
  applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]);
  container.innerHTML = listTpl();
}

/* ========= INTERAZIONE ========= */
function showToast(msg){ const t = document.querySelector('#toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(showToast._t); showToast._t = setTimeout(()=> t.classList.remove('show'), 2000); }
function goRandom(){ const items = filteredItems(); if(!items.length) return; const pick = items[Math.floor(Math.random()*items.length)]; location.hash = `#/animal/${pick.id}`; showToast(`Hai pescato: ${pick.name}! üé≤`); }
function openAllSections(){ document.querySelectorAll('#view details.acc').forEach(d=> d.open = true); }
function closeAllSections(){ document.querySelectorAll('#view details.acc').forEach(d=> d.open = false); }
function bindTocLinks(){
  document.querySelectorAll('.toc a[data-target]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      const sel = a.getAttribute('data-target');
      const el = document.querySelector(sel);
      if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
    });
  });
}
function setupControls(){
  document.querySelector('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
  document.querySelector('#filterClass').addEventListener('change', e=>{ state.cls = e.target.value; render(); });
  const br = document.querySelector('#btnRandom'); if(br) br.addEventListener('click', goRandom);
  window.addEventListener('keydown', (e)=>{
    if(e.key && e.key.toLowerCase()==='r' && !e.metaKey && !e.ctrlKey && !e.altKey){
      const a = document.activeElement;
      if(a && (a.tagName==='INPUT' || a.tagName==='TEXTAREA' || a.isContentEditable)) return;
      e.preventDefault(); goRandom();
    }
  });
}

window.addEventListener('hashchange', render);
window.addEventListener('DOMContentLoaded', ()=>{ setupControls(); render(); });
</script>
</body>
</html>
