<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Biolo-Gio | Enciclopedia degli animali</title>
<meta name="description" content="Schede divulgative ricche ma chiare su animali, habitat, dieta, comportamento, riproduzione, ruolo ecologico e curiosit√†. Perfetto per GitHub Pages." />
<style>
  :root{
    --bg:#f8fafc; --panel:#ffffff; --muted:#475569; --text:#0f172a;
    --brand:#06b6d4; --brand-2:#8b5cf6; --accent:#10b981; --card:#ffffff; --ring:#22d3ee55; --radius:18px;
    --t0:#ffffff; --t1:#f1f5f9; --pattern:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'/>");
    --grain:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'><g opacity='.08' fill='%23000000'><circle cx='6' cy='6' r='1.2'/><circle cx='32' cy='20' r='1'/><circle cx='58' cy='10' r='1'/><circle cx='14' cy='42' r='1.1'/><circle cx='48' cy='48' r='1'/><circle cx='70' cy='30' r='1.1'/><circle cx='22' cy='68' r='1'/><circle cx='64' cy='66' r='1.1'/></g></svg>");
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:#f1f5f9; line-height:1.6;}

  header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(10px); background:linear-gradient(180deg, #ffffffee, #ffffffcc); border-bottom:1px solid #e2e8f0}
  .wrap{max-width:1180px; margin:auto; padding:16px}
  .topbar{display:flex; align-items:center; gap:16px}
  .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
  .logo .mark{width:38px;height:38px;border-radius:12px;display:grid;place-items:center; background: conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--accent)); box-shadow:0 0 0 4px #00000005 inset, 0 10px 30px #0001;}
  .logo b{font-size:20px; letter-spacing:.3px}
  nav{margin-left:auto; display:flex; gap:14px; flex-wrap:wrap}
  nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
  nav a:hover{color:var(--text); background:#e2e8f0}

  .hero{display:grid; gap:4px; padding:24px 0 8px}
  .hero h1{margin:0; font-size:clamp(28px, 4vw, 44px); line-height:1.15}
  .hero p{margin:0; color:var(--muted)}

  .panel{background:var(--panel); border:1px solid #e2e8f0; border-radius:var(--radius); box-shadow:0 8px 30px #0000000d}
  .panel.pad{padding:16px}

  .controls{display:grid; grid-template-columns:1fr 200px; gap:12px; align-items:center}
  .search{position:relative}
  .search input{width:100%; padding:14px 44px 14px 14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}
  .search input:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
  .search .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.6}
  select{width:100%; padding:14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}

  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:16px; margin-top:16px}
  .card{background:var(--card); border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; transition:transform .15s ease, box-shadow .15s ease}
  .card:hover{transform:translateY(-4px); box-shadow:0 12px 30px #00000014}
  .thumb{height:160px; display:grid; place-items:center; font-size:72px; position:relative; overflow:hidden}
  .thumb::after{content:""; position:absolute; inset:0; background-image:var(--grain); background-size:80px 80px; pointer-events:none;}
  .thumb .emoji{position:relative; z-index:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}

  .hab-foresta{background-image: linear-gradient(135deg,#dcfce7,#bbf7d0), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.18'><g fill='none' stroke='%231a6e2a' stroke-width='2'><path d='M10 200c30-30 90-30 120 0'/><path d='M0 160c30-30 90-30 120 0'/></g><g fill='%231a6e2a'><circle cx='30' cy='40' r='5'/><circle cx='150' cy='90' r='4'/></g></svg>"); background-size:cover, 160px 160px}
  .hab-savana{background-image: linear-gradient(135deg,#fef9c3,#fde68a), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.16'><path d='M0 180c40-12 80-12 240 0' fill='none' stroke='%236b4f1d' stroke-width='2'/><path d='M0 140c40-12 80-12 240 0' fill='none' stroke='%23865e1d' stroke-width='2'/></svg>"); background-size:cover, 160px 160px}
  .hab-oceano{background-image: linear-gradient(135deg,#e0f2fe,#bae6fd), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.18'><path d='M0 60q40 25 80 0t80 0t80 0' fill='none' stroke='%231084b3' stroke-width='2'/><path d='M0 120q40 25 80 0t80 0t80 0' fill='none' stroke='%230d5b8f' stroke-width='2'/></svg>"); background-size:cover, 160px 160px}
  .hab-montagna{background-image: linear-gradient(135deg,#e2e8f0,#cbd5e1), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='260' height='160' opacity='0.14'><path d='M0 120L40 80l20 20 20-25 40 45H0z' fill='%23cbd5e1'/></svg>"); background-size:cover, 160px 160px}
  .hab-ghiaccio{background-image: linear-gradient(135deg,#f1f5f9,#e0f2fe), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' opacity='0.16'><g fill='none' stroke='%230e7490' stroke-width='1.6'><path d='M100 0v200M0 100h200'/><path d='M50 0v200M0 50h200'/></g></svg>"); background-size:cover, 140px 140px}
  .hab-deserto{background-image: linear-gradient(135deg,#ffedd5,#fed7aa), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.16'><path d='M0 180c50-20 100-20 240 0' fill='none' stroke='%23a16207' stroke-width='2'/></svg>"); background-size:cover, 160px 160px}
  .hab-prateria{background-image: linear-gradient(135deg,#d1fae5,#a7f3d0), url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.14'><path d='M0 200l10-20 10 20 10-25 10 25 10-18 10 18 10-22 10 22 10-19 10 19' fill='none' stroke='%230f766e' stroke-width='2'/></svg>"); background-size:cover, 160px 160px}

  .badge{display:inline-block; padding:4px 8px; border:1px solid #c7d2fe; border-radius:999px; font-size:12px; color:#4338ca; background:#eef2ff}
  .card .body{padding:12px 14px}
  .card h3{margin:0 0 6px; font-size:18px}
  .meta{font-size:13px; color:var(--muted)}
  .card .actions{display:flex; gap:8px; margin-top:12px}
  .btn{appearance:none; border:none; padding:10px 12px; border-radius:10px; background:#dbf4ff; color:#0c4a6e; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center}
  .btn:hover{background:#bae6fd}

  /* ===== LAYOUT SCHEDA ===== */
  .detail{margin-top:24px; display:grid; grid-template-columns:1.6fr 0.9fr; gap:18px}
  .hero-animal{border-radius:16px; overflow:hidden; position:relative; border:1px solid #e2e8f0}
  .hero-animal .banner{height:180px; display:grid; place-items:center; font-size:96px}
  .hero-animal .banner::after{content:"";position:absolute;inset:0;background-image:var(--grain);background-size:80px 80px;opacity:.8;mix-blend-mode:overlay;pointer-events:none}
  .hero-animal .head{display:flex; gap:16px; align-items:center; padding:12px 16px}
  .hero-animal h2{margin:0}
  .quick{position:sticky; top:90px; align-self:start}
  .quick .kv{display:grid; grid-template-columns:auto 1fr; gap:8px 12px; font-size:14px}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#f1f5f9; border:1px solid #e2e8f0; font-size:12px}

  .toc{display:flex; flex-wrap:wrap; gap:8px; padding:8px 0}
  .toc a{padding:6px 10px; border:1px solid #e2e8f0; border-radius:999px; text-decoration:none; color:#334155; background:#fff}
  .toc a:hover{background:#f8fafc}

  .section{scroll-margin-top:100px}
  .section h3{margin:0 0 8px}

  /* ===== Accordion ===== */
  details.acc{border:1px solid #e2e8f0; border-radius:12px; background:#fff; margin:14px 0; overflow:hidden}
  details.acc[open]{box-shadow:0 8px 24px #0000000d}
  summary.acc-sum{list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px; font-weight:600}
  summary.acc-sum::marker{display:none}
  summary.acc-sum .chev{transition:transform .2s ease; opacity:.7}
  details[open] summary.acc-sum .chev{transform:rotate(90deg)}
  .acc-body{padding:0 14px 14px}

  .accordion-tools{display:flex; gap:8px; flex-wrap:wrap}
  .btn-ghost{background:#fff; border:1px solid #e2e8f0; color:#334155}
  .btn-ghost:hover{background:#f8fafc}

  .callout{background:#ecfeff; border:1px solid #bae6fd; padding:10px 12px; border-radius:12px; font-size:14px}

  .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(40px);background:linear-gradient(135deg,var(--brand),var(--brand-2));color:white;padding:10px 18px;border-radius:12px;box-shadow:0 8px 30px #00000026;opacity:0;pointer-events:none;transition:opacity .35s, transform .35s;z-index:9999}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  footer{margin:30px 0 60px; color:var(--muted)}
  footer a{color:var(--brand)}
  @media (max-width:900px){ .detail{grid-template-columns:1fr} .quick{position:relative; top:auto} }

  /* ===== Tema pagina con pattern evidenti ===== */
  @keyframes drift { 0%{background-position:0 0, 0 0, 0 0, 200px 200px} 100%{background-position:0 0, 0 0, 0 0, 400px 400px} }
  body[class*="theme-"]{
    background-attachment: fixed;
    background-image:
      linear-gradient(180deg, var(--t0), var(--t1) 60%),
      radial-gradient(900px 700px at 110% 0%, rgba(255,255,255,.45), transparent),
      var(--pattern),
      var(--grain);
    background-size:auto, auto, 140px 140px, 80px 80px; /* pattern + grana */
    background-blend-mode: normal, normal, normal, overlay;
    animation: drift 120s linear infinite;
  }
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <a class="logo" href="#/home" aria-label="Biolo-Gio home">
      <div class="mark">üß¨</div>
      <b>Biolo-Gio</b>
    </a>
    <nav>
      <a href="#/home">Home</a>
      <a href="#/animali">Animali</a>
      <a href="#/curiosita">Curiosit√†</a>
      <a href="#/contatti">Contatti</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Enciclopedia degli animali, chiara e completa.</h1>
    <p>Descrizione sempre visibile; le altre sezioni si aprono con un click. Sfondi che richiamano l‚Äôhabitat con texture leggere.</p>
  </section>

  <section class="panel pad" id="controls">
    <div class="controls">
      <label class="search">
        <input id="q" placeholder="Cerca per nome, habitat, dieta‚Ä¶ (es. falco, savana, insettivoro)" autocomplete="off" />
        <span class="icon">üîé</span>
      </label>
      <label>
        <select id="filterClass">
          <option value="">Tutte le classi</option>
          <option>Mammiferi</option>
          <option>Uccelli</option>
          <option>Rettili</option>
          <option>Anfibi</option>
          <option>Pesci</option>
          <option>Invertebrati</option>
        </select>
      </label>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="btnRandom">üé≤ Animale casuale</button>
      <span class="meta">Premi <kbd>R</kbd> per pescarne uno a caso.</span>
    </div>
  </section>

  <section id="view"></section>

  <footer>
    <p>Progetto <b>Biolo-Gio</b>. Un solo file, massima semplicit√†. Pubblica su GitHub Pages e diffondi la meraviglia del regno animale.</p>
  </footer>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ==========================
   DATI ‚Äî 10 specie, testi pi√π discorsivi
   (ogni campo √® in paragrafi; niente elenchi lunghi)
   ========================== */
const ANIMALS = [
  { // 1 Wombat
    name: "Wombat",
    scientificName: "Vombatus ursinus",
    class: "Mammiferi",
    emoji: "ü™µ",
    habitat: "Praterie e foreste aperte dell'Australia sud-orientale",
    diet: "Erbivoro (erbe, cortecce, radici)",
    lifespan: "10‚Äì15 anni",
    size: "20‚Äì35 kg; ~1 m",
    conservation: "Least Concern",
    description:
"Il wombat √® un marsupiale costruito come un bulldozer gentile: basso, largo, con spalle poderose e artigli piatti che scavano come pale. Le sue gallerie sono citt√† sotterranee con corridoi, camere di riposo asciutte e prese d‚Äôaria naturali. La testa squadrata fa da ariete per spingere zolle e chiudere passaggi, mentre il mantello fitto e le orecchie piccole tengono lontani polvere e freddo.\n\nVive dove l‚Äôacqua scarseggia. Ha un metabolismo lento e un apparato digerente che non spreca nulla: estrae energia da erbe dure e corteccia, impacchetta l‚Äôacqua fino all‚Äôultima goccia e produce le celebri feci cubiche, perfette per restare sui sassi a fare da messaggi olfattivi. Dopo un incendio, le sue tane diventano rifugi provvisori per altri animali: minuscoli condomini di emergenza.",
    sociality:
"Non √® un tipo di compagnia, ma non √® nemmeno un eremita. Pi√π individui usano la stessa rete di tunnel in momenti diversi, come turni in metropolitana. Si riconoscono con l‚Äôodore e con marcature ben visibili. Di notte pascola con calma; se serve, diventa un proiettile sorprendente e si infila di colpo in galleria, tappandone l‚Äôingresso con la schiena corazzata.\n\nDavanti a novit√† non fugge sempre: osserva, annusa, decide. Ma le zone attorno agli ingressi delle tane sono territorio serio e vengono difese con testate, soffi e‚Ä¶ ostinazione.",
    feeding:
"Bruca vegetali poveri con pazienza millimetrica: erbe, rizomi, giovani cortecce. La digestione √® lunghissima; ogni molecola d‚Äôacqua viene recuperata. Nei periodi secchi dorme pi√π a lungo e si muove nelle ore pi√π fresche, sfruttando la sua ‚Äòcantina‚Äô naturale per risparmiare energie.",
    reproduction:
"La femmina partorisce un solo piccolo minuscolo che si arrampica nel marsupio rivolto all‚Äôindietro: una trovata perfetta per non riempirlo di terra mentre scava. Rimane l√¨ sei‚Äìsette mesi, poi inizia a seguire la madre imparando percorsi e uscite. La crescita √® lenta ma robusta: meglio un carro armato che una moto da corsa, in un ambiente di erba ruvida e piogge capricciose.",
    interactions:
"Le gallerie del wombat cambiano fisicamente il suolo: lo aerano, drenano l‚Äôacqua, creano microhabitat umidi. Piccoli rettili, marsupiali e uccelli terricoli usano volentieri questi rifugi pronti. I predatori principali sono dingo e cani; contro di loro la strategia del ‚Äòtappo vivente‚Äô funziona alla grande.",
    human:
"Le strade notturne e le recinzioni sono i rischi maggiori. Sottopassi faunistici e varchi ‚Äòamici dei wombat‚Äô aiutano la convivenza. La specie √® protetta in molte aree; la mappatura delle tane tutela anche altri animali che le usano.",
    facts:["Tane ramificate","Marsupio all‚Äôindietro","Digestione lentissima","Cubi che non rotolano","Scatto a 40 km/h"]
  },
  { // 2 Falco pellegrino
    name: "Falco pellegrino",
    scientificName: "Falco peregrinus",
    class: "Uccelli",
    emoji: "ü™∂",
    habitat: "Scogliere, montagne e citt√† in tutto il mondo",
    diet: "Carnivoro (uccelli in volo)",
    lifespan: "~15 anni",
    size: "Apertura alare 80‚Äì120 cm",
    conservation: "Least Concern",
    description:
"Il pellegrino √® un progetto aerodinamico con le piume: corpo affusolato, ali affilate, baffi scuri a tagliare i riflessi. In picchiata supera i 300 km/h, ma la cosa impressionante √® il controllo: chiude il corpo a freccia, regola le penne come alette e tiene gli occhi protetti da una membrana trasparente che scivola come una visiera.\n\nHa una vista da cecchino. Dalla sommit√† di un campanile o di una parete rocciosa legge il traffico aereo degli uccelli e sceglie l‚Äôangolo di attacco con calcoli che a noi servirebbe un software per imitare. La citt√†, per lui, √® una scogliera ben riscaldata, piena di passaggi d‚Äôaria veloci.",
    sociality:
"In stagione riproduttiva la coppia √® affiatata e territoriale. Non costruisce nidi elaborati: gli basta una cengia o un tetto ghiaioso. Sorveglia con passaggi tesi e richiami secchi. Fuori stagione ognuno si gestisce i propri spazi, ma i giovani rimangono a lungo nell‚Äôarea dei genitori, imparando posatoi, corridoi d‚Äôaria e bersagli tipici.",
    feeding:
"La caccia √® un gioco di precisione e tempismo. Il pellegrino punta un uccello in volo, cade in picchiata, lo colpisce di taglio per stordirlo e completa con la presa o con un recupero elegante a terra. Il becco ha un piccolo ‚Äòdente‚Äô che spezza rapidamente le vertebre del collo: chirurgia rapida, sofferenza minima.",
    reproduction:
"Sulla cengia o sul tetto, due‚Äìquattro uova sono la scommessa di primavera. Incubano entrambi; quando i giovani crescono, gli adulti fanno scuola di volo lanciando una preda in aria e invitando al passaggio a mezz‚Äôaria. √à ginnastica e geometria in un colpo solo. La coppia affezionata al sito lo riutilizza per anni.",
    interactions:
"In citt√† regola popolazioni numerose di piccioni e storni. Gabbiani e corvidi non gradiscono: quando lo individuano partono mobbing e inseguimenti rumorosi. Anche questo fa parte del bilancio ecologico urbano.",
    human:
"Dopo il crollo dovuto ai pesticidi nel secolo scorso, il pellegrino √® tornato. Divieti, reintroduzioni e la sorprendente disponibilit√† di grattacieli ‚Äòa misura di scogliera‚Äô lo hanno aiutato. Le webcam sui nidi hanno portato migliaia di persone a tifare per pulcini dal temperamento da stuntman.",
    facts:[">300 km/h","Vista finissima","Nidi urbani","Becco con ‚Äòdente‚Äô","Membrana nittitante"]
  },
  { // 3 Corvo
    name: "Corvo comune",
    scientificName: "Corvus corone",
    class: "Uccelli",
    emoji: "üê¶",
    habitat: "Campagne, citt√† e boschi aperti in Europa e Asia",
    diet: "Onnivoro opportunista",
    lifespan: "10‚Äì15 anni",
    size: "45‚Äì50 cm; apertura alare ~1 m",
    conservation: "Least Concern",
    description:
"Lucido come un‚Äôauto nuova e curioso come un detective. Il corvo osserva, prova, memorizza. Se vede qualcuno risolvere un problema, √® capace di copiarlo e adattarlo. Sa usare rametti come utensili, sa lasciare cadere noci sull‚Äôasfalto e tornare quando passano le auto. √à un cervello sociale dentro un vestito nero.",
    sociality:
"Durante la riproduzione forma coppie solide e discrete. In altre stagioni ama la vita di gruppo: i dormitori serali sono dialoghi incessanti, scambi di informazioni e amicizie che durano anni. I giovani girano in bande esplorative, trovano nuove fonti di cibo e mappano il territorio come startupper della campagna.",
    feeding:
"Mangia quasi tutto: insetti, semi, frutta, carcasse e scarti. Sa essere pulitore ecologico e, quando serve, ladro di opportunit√†. Nasconde il surplus in piccole dispense e ricorda dove ha messo cosa, anche molto tempo dopo.",
    reproduction:
"Il nido √® un‚Äôopera robusta, con rami grossi fuori e morbido dentro. Tre‚Äìsei uova aprono la stagione; entrambi i genitori nutrono i piccoli, che poi seguono gli adulti in veri tour didattici: dove cercare, quando osare, come stare al riparo.",
    interactions:
"Tra rapaci e corvidi il corvo √® spesso regista: se un falco pattuglia, parte un coro di avvisi e inseguimenti. In cambio, falchi e aquile lo tengono sulle spine: il gioco del gatto e del topo, ma in cielo.",
    human:
"In citt√† ha imparato i nostri orari: sa quando escono le mense, quando si svuotano i cestini, quando i trattori rivoltano il terreno. Non sempre √® silenzioso, ma √® un vicino sorprendentemente utile.",
    facts:["Usa attrezzi","Memoria lunga","Adattabile","Vocabolario ricco","Dispense nascoste"]
  },
  { // 4 Pinguino
    name: "Pinguino imperatore",
    scientificName: "Aptenodytes forsteri",
    class: "Uccelli",
    emoji: "üêß",
    habitat: "Antartide: piattaforme di ghiaccio e acque gelide",
    diet: "Pesci, krill, calamari",
    lifespan: "15‚Äì20 anni",
    size: "Fino a 120 cm; 20‚Äì40 kg",
    conservation: "Near Threatened",
    description:
"Il pinguino imperatore vive dove l‚Äôinverno non √® una stagione: √® l‚Äôambiente. Piume fittissime intrappolano aria, lo strato di grasso √® una sciarpa permanente e lo scambio di calore nelle zampe evita di disperdere energia nel ghiaccio. A terra √® un personaggio buffo, in acqua un nuotatore elastico e veloce che sfrutta bolle e riflessi sotto la banchisa.",
    sociality:
"Nelle tempeste, migliaia di corpi diventano un‚Äôunica creatura che respira e ruota: l‚Äôhuddle. Chi sta al centro cede il posto a chi √® rimasto al gelo, in un movimento lento e cooperativo. Fra tanto frastuono, ogni pulcino riconosce i propri genitori da un‚Äôimpronta vocale unica.",
    feeding:
"In mare l‚Äôimperatore diventa un sub professionista: discende anche oltre 500 metri, rallenta il cuore, usa la mioglobina come riserva di ossigeno e torna su come un cavatappi di bolle. Pesce e krill sono il piatto forte; le rotte dipendono da correnti, luce e margini del ghiaccio.",
    reproduction:
"Un solo uovo, una staffetta di sacrificio. La femmina depone e parte verso il mare; il maschio resta immobile per quasi due mesi, l‚Äôuovo al caldo sui piedi. Al cambio turno riparte lui, dimagrito ma determinato. Quando i giovani crescono, la colonia diventa una scuola di scivolate e primi tuffi.",
    interactions:
"Foche leopardo e orche sono i rischi principali in mare, skua e gabbiani a terra. Ma √® il ghiaccio ‚Äì la sua geografia in movimento ‚Äì a scrivere davvero le regole del gioco.",
    human:
"√à una specie sentinella del clima: dove cambia il ghiaccio, cambiano nidificazioni e rotte. Il monitoraggio satellitare individua le colonie addirittura dalle macchie di guano.",
    facts:["Colonie enormi","Uovo sui piedi","Immersioni profonde","Huddle","Firme vocali uniche"]
  },
  { // 5 Gallina
    name: "Gallina domestica",
    scientificName: "Gallus gallus domesticus",
    class: "Uccelli",
    emoji: "üêî",
    habitat: "Aree rurali e urbane di tutto il mondo",
    diet: "Onnivora (semi, insetti, erbe)",
    lifespan: "5‚Äì10 anni",
    size: "Variabile per razza",
    conservation: "‚Äî",
    description:
"La gallina √® un‚Äôottimizzatrice nata: razzola, becchetta, setaccia. Ogni giorno trasforma un cortile in una mappa di opportunit√†, con attenzione a sole, ombra e ripari. Ha un linguaggio che non ti aspetti: un richiamo per dire ‚Äòho trovato qualcosa di buono‚Äô, un altro per ‚Äòrapace in alto‚Äô, un altro ancora per ‚Äòseguitemi‚Äô.",
    sociality:
"Vive in gruppo con una semplice gerarchia che riduce i conflitti. Le madri sono maestre pazienti: mostrano cosa √® cibo e cosa no, radunano i pulcini sotto il piumaggio e li difendono con coraggio. I galli fanno da sentinelle e regolano l‚Äôordine con qualche scena teatrale.",
    feeding:
"Una dieta varia la mantiene in forma: semi, erbe, insetti e un po‚Äô di cucina di recupero fatta bene. Grit e conchiglia tritata aiutano la digestione e il guscio; acqua fresca e spazi da esplorare sono benessere allo stato puro.",
    reproduction:
"Se decide di covare, ventuno giorni sono la misura della pazienza. I pulcini nascono precoci, caldi di curiosit√†: camminano e mangiano da subito, imparando dal gruppo una piccola cultura di pollaio.",
    interactions:
"In campagna attira volpi, faine e rapaci: un recinto buono fa la differenza. In orto, invece, √® alleata: riduce insetti e lascia un concime naturale di tutto rispetto.",
    human:
"√à compagna dell‚Äôuomo da millenni, tra cibo, simboli e razze straordinarie. Oggi cresce l‚Äôinteresse per sistemi che rispettino la sua natura: luce naturale, tempo all‚Äôaperto, arricchimenti semplici ma intelligenti.",
    facts:["21 giorni di cova","Ordine di beccata","Richiami diversificati","Alleata dell‚Äôorto","Molte razze"]
  },
  { // 6 Coccodrillo
    name: "Coccodrillo del Nilo",
    scientificName: "Crocodylus niloticus",
    class: "Rettili",
    emoji: "üêä",
    habitat: "Fiumi, laghi e paludi dell‚ÄôAfrica",
    diet: "Carnivoro (pesci e grandi vertebrati)",
    lifespan: "40+ anni",
    size: ">5 m (massimi)",
    conservation: "Least Concern (tutele locali)",
    description:
"Corazza, muscoli e pazienza. Il coccodrillo sembra immobile, ma √® una molla trattenuta. Con occhi e narici in cima al muso fa il periscopio tra canneti e riflessi. Regola la temperatura alternando sole e acqua; a bocca spalancata dissipa calore come un radiatore biologico.",
    sociality:
"Condivide rive e posatoi soleggiati con altri individui, soprattutto durante la stagione secca, stabilendo piccole precedenze locali. I giovani spesso si aggregano in nursery sorvegliate: la tolleranza degli adulti √® maggiore di quanto ci aspetteremmo.",
    feeding:
"Denti per afferrare, non per masticare. Cattura pesci con scatti laterali, trascina grandi prede in acqua e, quando serve, ruota su s√© stesso per staccare pezzi con la ‚Äòdeath roll‚Äô. Pu√≤ digiunare a lungo: l‚Äôeconomia dell‚Äôattesa √® il suo mestiere.",
    reproduction:
"La femmina scava un nido nella sabbia, depone molte uova e sorveglia. Al momento giusto i piccoli pigolano dall‚Äôinterno e lei risponde, aiuta la schiusa e li porta in acqua tenendoli in bocca con una cura sorprendente per un rettile.",
    interactions:
"Predatore al vertice, seleziona prede deboli e mantiene l‚Äôequilibrio nelle comunit√† acquatiche. Attorno a una carcassa si organizza una mensa a turni con avvoltoi e altri necrofagi.",
    human:
"Conflitti nascono dove rive affollate e abbeveratoi coincidono. Cartelli, corridoi sicuri e vasche separate per il bestiame riducono rischi per tutti. La specie √® protetta in molte aree e gestita con piani locali.",
    facts:["Morsi potentissimi","Cure parentali","Rotazione della morte","Periscopio naturale","Radiatore a bocca aperta"]
  },
  { // 7 Aquila
    name: "Aquila reale",
    scientificName: "Aquila chrysaetos",
    class: "Uccelli",
    emoji: "ü¶Ö",
    habitat: "Montagne e scogliere dell'emisfero nord",
    diet: "Carnivoro (predatore)",
    lifespan: "20‚Äì30 anni",
    size: "Apertura alare fino a 2,3 m",
    conservation: "Least Concern",
    description:
"√à l‚Äôidea stessa di ‚Äòrapace maestoso‚Äô: grandi ali scure, nuca dorata, sguardo che sembra sapere gi√† dov‚Äô√® la preda. Vola sfruttando termiche e correnti di valle, restando in aria per ore con pochi colpi d‚Äôala. Le sue fovee sono due superfici ad altissima definizione: scovano una marmotta ferma come se si muovesse.",
    sociality:
"Vive in coppia su territori vasti e ben difesi. I nidi sono edificio pi√π che arredamento: rami, pelle, erbe, riutilizzati e ampliati per anni. I giovani restano a lungo nei dintorni, imparando i dislivelli giusti, i posatoi ventosi e l‚Äôarte di leggere l‚Äôaria.",
    feeding:
"La preda tipica √® una lepre o una marmotta; quando l‚Äôinverno irrigidisce i ritmi, anche le carcasse diventano risorsa. L‚Äôattacco √® un misto di strategia e potenza: picchiata o affondo sfruttando il terreno, artigli che serrano e una precisione che non perdona.",
    reproduction:
"Depone uno‚Äìtre uova, ma spesso il primo nato ha la meglio: in ambienti difficili la natura si tiene un margine di sicurezza crudele ma efficace. I genitori alternano caccia e cova; i giovani si allenano con planate sempre pi√π ampie prima del grande salto.",
    interactions:
"Corvidi e altre aquile la sfidano su carogne e confini: il mobbing √® frequente in entrambe le direzioni. Uova e pulli sono vulnerabili a predatori opportunisti se il nido resta incustodito.",
    human:
"Soffre disturbi vicino ai nidi e rischi con cavi o strutture. Progetti di conservazione mappano siti sensibili e pianificano i lavori in periodi ‚Äòneutri‚Äô. Dove la tutela funziona, l‚Äôaquila torna.",
    facts:["Supervista","Nidi monumentali","Artigli poderosi","Territori estesi","Necrofagia invernale"]
  },
  { // 8 Salamandra
    name: "Salamandra pezzata",
    scientificName: "Salamandra salamandra",
    class: "Anfibi",
    emoji: "ü¶é",
    habitat: "Boschi umidi europei, presso acque pulite",
    diet: "Insettivora (vermi, larve, piccoli invertebrati)",
    lifespan: "Fino a 20 anni",
    size: "15‚Äì25 cm",
    conservation: "Varia per area",
    description:
"Nero lucido, giallo brillante: dice ‚Äònon toccarmi‚Äô in un linguaggio universale. La pelle sottile e vascolarizzata serve anche a respirare; per questo la salamandra √® fedele a ombra e umidit√†. Di giorno scompare sotto tronchi e pietre fresche; dopo la pioggia cammina sicura su sentieri e fossi come se li avesse disegnati lei.",
    sociality:
"Animale solitario ma non raro dove il bosco √® sano. Condivide rifugi in tempi diversi e lascia pochissime tracce se non quell‚Äôandatura misurata e le macchie che la rendono inconfondibile.",
    feeding:
"Caccia a raggio cortissimo: lombrichi, larve, piccoli artropodi. Non serve velocit√†, serve opportunismo. Vista e olfatto fanno da radar vicino al suolo.",
    reproduction:
"In molte popolazioni la femmina partorisce larve in acque fredde e pulite; altrove depone uova. La metamorfosi √® una corsa contro l‚Äôessiccamento estivo: quando i giovani emergono, la pioggia diventa guida e protezione.",
    interactions:
"Le secrezioni cutanee sono un dissuasore efficace. La sua presenza segnala habitat di qualit√†; quando scompare, spesso l‚Äôacqua si √® sporcata o il bosco si √® aperto troppo.",
    human:
"Inquinamento, frammentazione e malattie fungine sono i pericoli principali. Proteggere ruscelli ombrosi e sottobosco significa proteggere un intero microcosmo, non solo lei.",
    facts:["Aposematismo","Pelle sensibile","Attiva dopo la pioggia","Larve in acqua pulita","Specie indicatrice"]
  },
  { // 9 Camaleonte
    name: "Camaleonte comune",
    scientificName: "Chamaeleo chamaeleon",
    class: "Rettili",
    emoji: "ü¶é",
    habitat: "Macchia mediterranea, arbusti e alberi bassi",
    diet: "Insettivoro",
    lifespan: "4‚Äì7 anni",
    size: "20‚Äì35 cm (con coda)",
    conservation: "Varia localmente",
    description:
"√à un equilibrista con guanti a pinza e una coda che funziona come una quinta mano. Gli occhi girano indipendenti e poi, quando la preda √® scelta, convergono come fari. Il cambio di colore non √® magia: √® comunicazione e termoregolazione, un linguaggio che dice ‚Äòsto bene‚Äô, ‚Äòsto male‚Äô, ‚Äònon avvicinarti‚Äô.",
    sociality:
"Territoriale quanto basta, preferisce incontri brevi e molto teatrali: si gonfia, oscilla come una foglia, mostra colori pi√π accesi. La maggior parte del tempo √® un fotografo appostato che aspetta il momento perfetto.",
    feeding:
"Caccia d‚Äôagguato sugli insetti. La lingua scatta come una molla appiccicosa pilotata da un calcolo preciso di distanza. Per farlo bene sceglie posatoi che offrano copertura e visuale, e si muove a piccoli dondolii in sincronia col vento.",
    reproduction:
"Dopo l‚Äôaccoppiamento la femmina depone uova in terreni soffici e ben drenati. I piccoli nascono gi√† arrampicatori; imparano presto la geografia dei cespugli e il ritmo del caldo mediterraneo.",
    interactions:
"Rapaci e serpenti sono i suoi esaminatori pi√π severi. Le difese sono pazienza e mimetismo: a volte, per un minuto intero, il camaleonte diventa una foglia che respira.",
    human:
"Perdita di habitat costiero e strade sono le minacce principali. Siepi, corridoi ecologici e sensibilit√† locale tengono unite le popolazioni.",
    facts:["Lingua proiettile","Occhi indipendenti","Coda prensile","Mimetismo comunicativo","Andatura a dondolo"]
  },
  { // 10 Gatto
    name: "Gatto domestico",
    scientificName: "Felis catus",
    class: "Mammiferi",
    emoji: "üê±",
    habitat: "Case, fattorie e citt√† di tutto il mondo",
    diet: "Carnivoro facoltativo",
    lifespan: "12‚Äì18 anni",
    size: "3‚Äì6 kg (media)",
    conservation: "‚Äî",
    description:
"Il gatto √® un atleta silenzioso fatto di molle e antenne. Le pupille si aprono come porte sul crepuscolo, i baffi misurano passaggi e sporgenze, le orecchie raccolgono ultrasuoni che noi ignoriamo. Anche in appartamento resta un predatore in miniatura che organizza inseguimenti e imboscate con fantasia instancabile.",
    sociality:
"Pu√≤ vivere da solo oppure creare piccole comunit√† intorno a cibo e ripari. Le relazioni si leggono in dettagli fini: toelettature reciproche, sonnellini a contatto, scelte di vicinanza. La comunicazione √® un mix di fusa (anche per calmarsi), miagolii modulati sul singolo umano, posture e marcature odorose.",
    feeding:
"Preferisce proteine animali e pasti piccoli ma frequenti. In casa la salute passa da arricchimento ambientale, gioco quotidiano e acqua lontana dal cibo. Un gatto stanco e appagato √® un gatto sereno: la ‚Äòcaccia‚Äô simulata √® la sua palestra mentale.",
    reproduction:
"Senza sterilizzazione pu√≤ avere pi√π cucciolate all‚Äôanno. I gattini nascono ciechi e sordi, ma recuperano in fretta; le prime settimane sono la finestra d‚Äôoro per una socializzazione che eviti paure future.",
    interactions:
"All‚Äôaperto √® un predatore molto efficiente: campanellino, orari e rientro notturno proteggono la fauna. In casa riduce stress e solitudine, ma chiede routine e rispetto dei suoi tempi.",
    human:
"Vaccinazioni, visite, tiragraffi e luoghi in alto sono investimenti di felicit√†. Con poche accortezze, convivenza e benessere crescono insieme.",
    facts:["Visione crepuscolare","Baffi sensori","Cacciatore naturale","Gioco quotidiano","Routine prevedibili"]
  }
];

/* ==========================
   INDICIZZAZIONE & UTIL
   ========================== */
const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = [a.name,a.scientificName,a.habitat,a.diet,a.class,(a.facts||[]).join(" ")].join(" ").toLowerCase(); });
const by = key => (a,b)=> (a[key]||"").localeCompare(b[key]||"");
const qs = sel => document.querySelector(sel);
const state = { q:"", cls:"", route:"/home" };

/* ==========================
   HABITAT ‚Üí classi card & tema pagina
   ========================== */
const habClass = (hab='')=>{
  const h = hab.toLowerCase();
  if(h.includes('foreste')||h.includes('foresta')) return 'hab-foresta';
  if(h.includes('savana')||h.includes('prateria')) return 'hab-savana';
  if(h.includes('antart')||h.includes('ghiaccio')||h.includes('polo')) return 'hab-ghiaccio';
  if(h.includes('mare')||h.includes('oceano')||h.includes('coste')||h.includes('acque')) return 'hab-oceano';
  if(h.includes('montagne')||h.includes('scogliere')||h.includes('alp')) return 'hab-montagna';
  if(h.includes('deserto')||h.includes('arido')) return 'hab-deserto';
  if(h.includes('prateria')||h.includes('steppe')) return 'hab-prateria';
  return 'hab-prateria';
};
const toTheme = (hc)=>({
  'hab-foresta':'theme-foresta','hab-savana':'theme-savana','hab-ghiaccio':'theme-ghiaccio',
  'hab-oceano':'theme-oceano','hab-montagna':'theme-montagna','hab-deserto':'theme-deserto','hab-prateria':'theme-prateria'
}[hc]||'theme-prateria');
const THEMES = ['theme-foresta','theme-savana','theme-oceano','theme-montagna','theme-ghiaccio','theme-deserto','theme-prateria'];

/* ==========================
   SFONDI: palette/pattern evidenti
   ========================== */
function pickThemeVars(theme){
  const tweak = (hex, delta=0) => {
    const c = hex.replace('#','');
    const r = parseInt(c.slice(0,2),16), g = parseInt(c.slice(2,4),16), b = parseInt(c.slice(4,6),16);
    const rn=r/255, gn=g/255, bn=b/255; const max=Math.max(rn,gn,bn), min=Math.min(rn,gn,bn);
    let h,s,l=(max+min)/2, d=max-min; if(d===0){ h=0; s=0; } else { s=d/(1-Math.abs(2*l-1)); switch(max){case rn:h=((gn-bn)/d)%6;break;case gn:h=(bn-rn)/d+2;break;default:h=(rn-gn)/d+4;} h*=60; if(h<0)h+=360; }
    l=Math.min(1,Math.max(0,l+delta)); const C=(1-Math.abs(2*l-1))*s, X=C*(1-Math.abs(((h/60)%2)-1)), m=l-C/2; let rr,gg,bb;
    if(0<=h&&h<60){rr=C;gg=X;bb=0;} else if(60<=h&&h<120){rr=X;gg=C;bb=0;} else if(120<=h&&h<180){rr=0;gg=C;bb=X;} else if(180<=h&&h<240){rr=0;gg=X;bb=C;} else if(240<=h&&h<300){rr=X;gg=0;bb=C;} else {rr=C;gg=0;bb=X;}
    const R=Math.round((rr+m)*255), G=Math.round((gg+m)*255), B=Math.round((bb+m)*255);
    return `#${R.toString(16).padStart(2,'0')}${G.toString(16).padStart(2,'0')}${B.toString(16).padStart(2,'0')}`;
  };
  const sets = {
    "theme-foresta": { base0:"#f0fdf4", base1:"#dcfce7", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.20'><g fill='none' stroke='%231a6e2a' stroke-width='2'><path d='M10 200c30-30 90-30 120 0'/><path d='M0 160c30-30 90-30 120 0'/></g><g fill='%231a6e2a'><circle cx='30' cy='40' r='5'/><circle cx='150' cy='90' r='4'/></g></svg>"
    ]},
    "theme-savana": { base0:"#fffbeb", base1:"#fef9c3", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.20'><path d='M0 180c40-12 80-12 240 0' fill='none' stroke='%236b4f1d' stroke-width='2'/><path d='M0 140c40-12 80-12 240 0' fill='none' stroke='%23865e1d' stroke-width='2'/></svg>"
    ]},
    "theme-oceano": { base0:"#f0f9ff", base1:"#e0f2fe", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.22'><path d='M0 60q40 25 80 0t80 0t80 0' fill='none' stroke='%231084b3' stroke-width='2'/><path d='M0 120q40 25 80 0t80 0t80 0' fill='none' stroke='%230d5b8f' stroke-width='2'/></svg>"
    ]},
    "theme-montagna": { base0:"#f8fafc", base1:"#e2e8f0", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='260' height='160' opacity='0.18'><path d='M0 120L40 80l20 20 20-25 40 45H0z' fill='%23cbd5e1'/></svg>"
    ]},
    "theme-ghiaccio": { base0:"#f8fafc", base1:"#e0f2fe", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' opacity='0.20'><g fill='none' stroke='%230e7490' stroke-width='1.6'><path d='M100 0v200M0 100h200'/><path d='M50 0v200M0 50h200'/></g></svg>"
    ]},
    "theme-deserto": { base0:"#fff7ed", base1:"#ffedd5", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.20'><path d='M0 180c50-20 100-20 240 0' fill='none' stroke='%23a16207' stroke-width='2'/></svg>"
    ]},
    "theme-prateria": { base0:"#ecfeff", base1:"#d1fae5", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.18'><path d='M0 200l10-20 10 20 10-25 10 25 10-18 10 18 10-22 10 22 10-19 10 19' fill='none' stroke='%230f766e' stroke-width='2'/></svg>"
    ]}
  };
  const set = sets[theme] || sets["theme-prateria"];
  const wiggle = (Math.random()*0.08)-0.04;
  const t0 = tweak(set.base0, wiggle);
  const t1 = tweak(set.base1, -wiggle/2);
  const pat = set.patterns[Math.floor(Math.random()*set.patterns.length)];
  return { t0, t1, pat };
}
function applyTheme(theme){
  document.body.classList.remove(...THEMES);
  document.body.classList.add(theme);
  const { t0, t1, pat } = pickThemeVars(theme);
  document.documentElement.style.setProperty('--t0', t0);
  document.documentElement.style.setProperty('--t1', t1);
  document.documentElement.style.setProperty('--pattern', `url("${pat}")`);
}

/* ==========================
   TEMPLATE
   ========================== */
function cardTpl(a){
  const hc = habClass(a.habitat);
  return `
    <article class="card" aria-label="${a.name}">
      <div class="thumb ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
      <div class="body">
        <span class="badge">${a.class}</span>
        <h3>${a.name}</h3>
        <div class="meta"><i>${a.scientificName}</i></div>
        <div class="actions"><a class="btn" href="#/animal/${a.id}">Apri scheda</a></div>
      </div>
    </article>`;
}
function listTpl(){
  const items = filteredItems();
  const cards = items.map(cardTpl).join('');
  return `<div class="grid">${cards || emptyTpl()}</div>`;
}
function quickFacts(a){
  return `
  <div class="panel pad quick">
    <h3 style="margin-top:0">Scheda rapida</h3>
    <div class="accordion-tools" style="margin-bottom:10px">
      <button class="btn btn-ghost" onclick="openAllSections()">Apri tutto</button>
      <button class="btn btn-ghost" onclick="closeAllSections()">Chiudi tutto</button>
    </div>
    <div class="kv">
      <div class="meta">Nome scientifico</div><div><i>${a.scientificName||'‚Äî'}</i></div>
      <div class="meta">Classe</div><div>${a.class||'‚Äî'}</div>
      <div class="meta">Habitat</div><div>${a.habitat||'‚Äî'}</div>
      <div class="meta">Dieta</div><div>${a.diet||'‚Äî'}</div>
      <div class="meta">Vita media</div><div>${a.lifespan||'‚Äî'}</div>
      <div class="meta">Dimensioni</div><div>${a.size||'‚Äî'}</div>
      <div class="meta">Conservazione</div><div>${a.conservation||'‚Äî'}</div>
    </div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:12px">
      ${(a.facts||[]).slice(0,6).map(f=>`<span class="chip">${f}</span>`).join('')}
    </div>
  </div>`;
}
function acc(id, title, html){
  return `
  <details class="acc" id="${id}">
    <summary class="acc-sum"><span class="chev">‚ñ∂</span> ${title}</summary>
    <div class="acc-body">${html}</div>
  </details>`;
}
function detailTpl(a){
  const hc = habClass(a.habitat);
  const facts = (a.facts||[]).map(f=>`<li>${f}</li>`).join('');
  const finale = (a.facts && a.facts[0]) ? a.facts[0] : "Questo animale riserva sempre sorprese.";
  return `
  <div class="detail">
    <div>
      <div class="hero-animal panel">
        <div class="banner ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
        <div class="head">
          <div style="flex:1;min-width:240px">
            <h2>${a.name}</h2>
            <div class="meta"><i>${a.scientificName}</i></div>
            <div class="toc" aria-label="vai a sezione">
              <a href="#" data-target="#desc">Descrizione</a>
              <a href="#" data-target="#soc">Socialit√†</a>
              <a href="#" data-target="#feed">Alimentazione</a>
              <a href="#" data-target="#repr">Riproduzione</a>
              <a href="#" data-target="#eco">Ruolo ecologico</a>
              <a href="#" data-target="#hum">Rapporto con l'uomo</a>
              <a href="#" data-target="#facts">Curiosit√†</a>
            </div>
          </div>
          <div>
            <a class="btn" href="#/home">‚Üê Torna all'elenco</a>
          </div>
        </div>
      </div>

      <div id="desc" class="panel pad section"><h3>Descrizione generale</h3><p>${a.description||'‚Äî'}</p></div>
      ${acc('soc', 'Socialit√† e comportamento', `<p>${a.sociality||'‚Äî'}</p>`)}
      ${acc('feed', 'Alimentazione e caccia', `<p>${a.feeding||'‚Äî'}</p>`)}
      ${acc('repr', 'Riproduzione e crescita', `<p>${a.reproduction||'‚Äî'}</p>`)}
      ${acc('eco', 'Ruolo ecologico e predatori', `<p>${a.interactions||'‚Äî'}</p>`)}
      ${facts? acc('facts', 'Curiosit√†', `<ul>${facts}</ul>`) : ''}
      ${acc('hum', "Rapporto con l'uomo", `<p>${a.human||'‚Äî'}</p>`)}
      <div class="panel pad callout" style="margin-top:12px"><b>Lo sapevi che‚Ä¶</b> ${finale}</div>
    </div>
    ${quickFacts(a)}
  </div>`;
}
function curiositaTpl(){
  const pick = arr=>arr[Math.floor(Math.random()*arr.length)];
  const facts = [];
  for(let i=0;i<6;i++){ const a = pick(ANIMALS); facts.push(`<li><b>${a.name}:</b> ${pick(a.facts||[a.description||'‚Äî'])}</li>`); }
  return `<div class="panel pad"><h2 style="margin-top:0">Curiosit√† casuali ‚ú®</h2><ul>${facts.join('')}</ul></div>`;
}
function contattiTpl(){ return `<div class="panel pad"><h2 style="margin-top:0">Contatti</h2><p>Progetto didattico. Apri una issue sul repository GitHub per suggerimenti o contributi.</p></div>` }
function notFoundTpl(){ return `<div class="panel pad"><h2>Ops!</h2><p>Animale non trovato.</p></div>` }
function emptyTpl(){ return `<div class="panel pad"><p>Nessun risultato. Prova a cambiare ricerca o filtro.</p></div>` }

/* ==========================
   RENDER & ROUTER
   ========================== */
function filteredItems(){
  const q = (state.q||'').trim().toLowerCase();
  return ANIMALS
    .filter(a => (!q || a._hay.includes(q)))
    .filter(a => (!state.cls || a.class===state.cls))
    .sort(by('name'));
}
function render(){
  const container = qs('#view');
  const hash = location.hash.replace('#','') || '/home';
  state.route = hash;
  if(hash.startsWith('/animal/')){
    const id = hash.split('/')[2];
    const a = ANIMALS.find(x=>x.id===id);
    if(a) applyTheme(toTheme(habClass(a.habitat)));
    container.innerHTML = a ? detailTpl(a) : notFoundTpl();
    if(a) bindTocLinks(); // attiva i chip indice
    return;
  }
  if(hash==='/curiosita'){ applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]); container.innerHTML = curiositaTpl(); return; }
  if(hash==='/contatti'){ applyTheme('theme-prateria'); container.innerHTML = contattiTpl(); return; }
  // Home/Elenco
  applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]);
  container.innerHTML = listTpl();
}

/* ==========================
   INTERAZIONE
   ========================== */
function showToast(msg){ const t = document.querySelector('#toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(showToast._t); showToast._t = setTimeout(()=> t.classList.remove('show'), 2000); }
function goRandom(){ const items = filteredItems(); if(!items.length) return; const pick = items[Math.floor(Math.random()*items.length)]; location.hash = `#/animal/${pick.id}`; showToast(`Hai pescato: ${pick.name}! üé≤`); }
function openAllSections(){ document.querySelectorAll('#view details.acc').forEach(d=> d.open = true); }
function closeAllSections(){ document.querySelectorAll('#view details.acc').forEach(d=> d.open = false); }
function bindTocLinks(){
  document.querySelectorAll('.toc a[data-target]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      const sel = a.getAttribute('data-target');
      const el = document.querySelector(sel);
      if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
    });
  });
}

function setupControls(){
  document.querySelector('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
  document.querySelector('#filterClass').addEventListener('change', e=>{ state.cls = e.target.value; render(); });
  const br = document.querySelector('#btnRandom'); if(br) br.addEventListener('click', goRandom);
  window.addEventListener('keydown', (e)=>{ if(e.key && e.key.toLowerCase()==='r' && !e.metaKey && !e.ctrlKey && !e.altKey){ const a = document.activeElement; if(a && (a.tagName==='INPUT' || a.tagName==='TEXT
