<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biolo‚ÄëGio | Enciclopedia giocosa degli animali</title>
  <meta name="description" content="Biolo‚ÄëGio: scopri specie, habitat, dieta, conservazione e curiosit√† ‚Äî veloce e semplice su GitHub Pages." />
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --muted:#475569; --text:#0f172a; --brand:#06b6d4; --brand-2:#8b5cf6; --accent:#10b981; --card:#ffffff; --ring:#22d3ee55; --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:#f1f5f9; line-height:1.6; transition: background 400ms ease;}

    /* Temi habitat con dettagli SVG sottili */
    body.theme-foresta{background:
      radial-gradient(1200px 800px at 10% -10%, #bbf7d0, transparent),
      radial-gradient(900px 700px at 110% 0%, #86efac, transparent),
      linear-gradient(180deg, #f0fdf4, #dcfce7 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160" opacity="0.07"><g fill="none" stroke="%231A6E2A" stroke-width="1"><path d="M0 140l20-40 20 35 20-45 20 50 20-30 20 30"/></g><g fill="%231A6E2A" opacity="0.08"><circle cx="30" cy="30" r="6"/><circle cx="120" cy="70" r="5"/></g></svg>'); background-attachment:fixed;}
    body.theme-savana{background:
      radial-gradient(1200px 800px at 10% -10%, #fde68a, transparent),
      radial-gradient(900px 700px at 110% 0%, #fef3c7, transparent),
      linear-gradient(180deg, #fffbeb, #fef9c3 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" opacity="0.06"><path d="M0 150c40-12 80-12 200 0" fill="none" stroke="%236B4F1D"/><path d="M0 110c40-12 80-12 200 0" fill="none" stroke="%23865E1D"/></svg>'); background-attachment:fixed;}
    body.theme-oceano{background:
      radial-gradient(1200px 800px at 10% -10%, #bae6fd, transparent),
      radial-gradient(900px 700px at 110% 0%, #a5f3fc, transparent),
      linear-gradient(180deg, #f0f9ff, #e0f2fe 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" opacity="0.07"><path d="M0 60q40 25 80 0t80 0t80 0" fill="none" stroke="%231084B3"/><path d="M0 120q40 25 80 0t80 0t80 0" fill="none" stroke="%230D5B8F"/></svg>'); background-attachment:fixed;}
    body.theme-montagna{background:
      radial-gradient(1200px 800px at 10% -10%, #e2e8f0, transparent),
      radial-gradient(900px 700px at 110% 0%, #cbd5e1, transparent),
      linear-gradient(180deg, #f8fafc, #e2e8f0 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="140" viewBox="0 0 220 140" opacity="0.07"><path d="M0 120L40 80l20 20 20-25 40 45H0z" fill="%23cbd5e1"/></svg>'); background-attachment:fixed;}
    body.theme-ghiaccio{background:
      radial-gradient(1200px 800px at 10% -10%, #e0f2fe, transparent),
      radial-gradient(900px 700px at 110% 0%, #f1f5f9, transparent),
      linear-gradient(180deg, #f8fafc, #e0f2fe 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160" opacity="0.06"><g fill="none" stroke="%230e7490" stroke-width="1"><path d="M80 0v160M0 80h160"/><path d="M40 0v160M0 40h160"/></g></svg>'); background-attachment:fixed;}
    body.theme-deserto{background:
      radial-gradient(1200px 800px at 10% -10%, #fed7aa, transparent),
      radial-gradient(900px 700px at 110% 0%, #ffedd5, transparent),
      linear-gradient(180deg, #fff7ed, #ffedd5 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" opacity="0.06"><path d="M0 150c50-20 100-20 200 0" fill="none" stroke="%23a16207"/></svg>'); background-attachment:fixed;}
    body.theme-prateria{background:
      radial-gradient(1200px 800px at 10% -10%, #a7f3d0, transparent),
      radial-gradient(900px 700px at 110% 0%, #d1fae5, transparent),
      linear-gradient(180deg, #ecfeff, #d1fae5 60%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160" opacity="0.06"><path d="M0 140l10-20 10 20 10-25 10 25 10-18 10 18 10-22 10 22 10-19 10 19" fill="none" stroke="%230f766e"/></svg>'); background-attachment:fixed;}

    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(10px); background:linear-gradient(180deg, #ffffffee, #ffffffcc); border-bottom:1px solid #e2e8f0}
    .wrap{max-width:1100px; margin:auto; padding:16px}
    .topbar{display:flex; align-items:center; gap:16px}
    .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .logo .mark{width:38px;height:38px;border-radius:12px;display:grid;place-items:center; background: conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--accent)); box-shadow:0 0 0 4px #00000005 inset, 0 10px 30px #0001;}
    .logo b{font-size:20px; letter-spacing:.3px}
    nav{margin-left:auto; display:flex; gap:14px; flex-wrap:wrap}
    nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
    nav a:hover{color:var(--text); background:#e2e8f0}

    .hero{display:grid; gap:18px; padding:30px 0 8px}
    .hero h1{margin:0; font-size:clamp(28px, 4vw, 44px); line-height:1.15}
    .hero p{margin:0; color:var(--muted)}

    .panel{background:var(--panel); border:1px solid #e2e8f0; border-radius:var(--radius); box-shadow:0 8px 30px #0000000d}
    .panel.pad{padding:16px}

    .controls{display:grid; grid-template-columns:1fr 180px; gap:12px; align-items:center}
    .search{position:relative}
    .search input{width:100%; padding:14px 44px 14px 14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}
    .search input:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
    .search .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.6}
    select{width:100%; padding:14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}

    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:14px; margin-top:14px}
    .card{background:var(--card); border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-4px); box-shadow:0 12px 30px #00000014}
    .thumb{height:140px; display:grid; place-items:center; font-size:60px; position:relative; overflow:hidden}
    .thumb .emoji{position:relative; z-index:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}
    .hab-foresta{background: linear-gradient(135deg,#dcfce7,#bbf7d0)}
    .hab-savana{background: linear-gradient(135deg,#fef9c3,#fde68a)}
    .hab-oceano{background: linear-gradient(135deg,#e0f2fe,#bae6fd)}
    .hab-montagna{background: linear-gradient(135deg,#e2e8f0,#cbd5e1)}
    .hab-ghiaccio{background: linear-gradient(135deg,#f1f5f9,#e0f2fe)}
    .hab-deserto{background: linear-gradient(135deg,#ffedd5,#fed7aa)}
    .hab-prateria{background: linear-gradient(135deg,#d1fae5,#a7f3d0)}

    .badge{display:inline-block; padding:4px 8px; border:1px solid #c7d2fe; border-radius:999px; font-size:12px; color:#4338ca; background:#eef2ff}
    .card .body{padding:12px 14px}
    .card h3{margin:0 0 6px; font-size:18px}
    .meta{font-size:13px; color:var(--muted)}
    .card .actions{display:flex; gap:8px; margin-top:12px}
    .btn{appearance:none; border:none; padding:10px 12px; border-radius:10px; background:#dbf4ff; color:#0c4a6e; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center}
    .btn:hover{background:#bae6fd}

    .detail{margin-top:24px; display:grid; gap:18px}
    .back{color:var(--brand); text-decoration:none}

    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(40px);background:linear-gradient(135deg,var(--brand),var(--brand-2));color:white;padding:10px 18px;border-radius:12px;box-shadow:0 8px 30px #00000026;opacity:0;pointer-events:none;transition:opacity .35s, transform .35s;z-index:9999}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    @media (max-width:700px){ .controls{grid-template-columns:1fr} }
  </style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <a class="logo" href="#/home" aria-label="Biolo‚ÄëGio home">
      <div class="mark">üß¨</div>
      <b>Biolo‚ÄëGio</b>
    </a>
    <nav>
      <a href="#/home">Home</a>
      <a href="#/animali">Animali</a>
      <a href="#/curiosita">Curiosit√†</a>
      <a href="#/contatti">Contatti</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Enciclopedia degli animali, a misura di curiosit√†.</h1>
    <p>Scopri specie, habitat, dieta, stato di conservazione e perle zoologiche. 100% GitHub Pages friendly.</p>
  </section>

  <section class="panel pad" id="controls">
    <div class="controls">
      <label class="search">
        <input id="q" placeholder="Cerca per nome, habitat, dieta‚Ä¶ (es. panda, savana, onnivoro)" autocomplete="off" />
        <span class="icon">üîé</span>
      </label>
      <label>
        <select id="filterClass">
          <option value="">Tutte le classi</option>
          <option>Mammiferi</option>
          <option>Uccelli</option>
          <option>Rettili</option>
          <option>Anfibi</option>
          <option>Pesci</option>
          <option>Invertebrati</option>
        </select>
      </label>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="btnRandom">üé≤ Animale casuale</button>
      <span class="meta">Premi <kbd>R</kbd> per pescarne uno a caso.</span>
    </div>
  </section>

  <section id="view"></section>

  <footer style="margin:30px 0 60px; color:var(--muted)">
    <p>Progetto <b>Biolo‚ÄëGio</b>. Un solo file, massima semplicit√†. Pubblica su GitHub Pages e diffondi la meraviglia del regno animale.</p>
  </footer>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
// ==========================
// DATI (ridotti per esempio; pronti ad espandersi)
// ==========================
const ANIMALS = [
  {
    name: "Wombat",
    scientificName: "Vombatus ursinus",
    class: "Mammiferi",
    emoji: "ü™µ",
    habitat: "Praterie e foreste aperte dell'Australia sud‚Äëorientale",
    diet: "Erbivoro (erbe, cortecce, radici)",
    lifespan: "10‚Äì15 anni (in natura)",
    size: "20‚Äì35 kg; lungo ~1 m",
    conservation: "Least Concern (LC)",
    description: "Il wombat √® un marsupiale tozzo e scavatori professionista. Ha zampe robuste e artigli per costruire lunghe tane sotterranee, dove la temperatura resta stabile. Il suo metabolismo √® lento: digerisce le fibre per molte ore, come una piccola mucca con la pala in mano.",
    sociality: "In genere √® solitario e notturno. Condivide talvolta i cunicoli con altri wombat, ma mantiene piccole aree territoriali segnate con odori.",
    reproduction: "La femmina partorisce un piccolo che resta nel marsupio (aperto verso dietro, cos√¨ non entra terra) per circa 6‚Äì7 mesi. Diventa indipendente attorno all'anno di et√†.",
    feeding: "Bruca erbe dure e cortecce. L‚Äôapparato digerente estrae il massimo dalle fibre, motivo per cui le feci sono famose: cubiche! Cos√¨ non rotolano, e possono marcare meglio il territorio.",
    interactions: "Scavando crea micro‚Äëhabitat per altri animali che sfruttano le tane. In caso di predatori, si rifugia nel tunnel e pu√≤ chiudere l‚Äôaccesso col posteriore osseo come uno ‚Äòscudo‚Äô.",
    human: "Pu√≤ danneggiare recinzioni ma √® amato dai locali. La perdita di habitat e le strade sono i rischi principali.",
    fun: "Le sue feci a forma di cubo sono un‚Äôicona del web naturalista."
  },
  {
    name: "Falco pellegrino",
    scientificName: "Falco peregrinus",
    class: "Uccelli",
    emoji: "ü™∂",
    habitat: "Scogliere, citt√†, montagne; distribuzione quasi globale",
    diet: "Carnivoro (uccelli in volo)",
    lifespan: "~15 anni",
    size: "Apertura alare 80‚Äì120 cm",
    conservation: "Least Concern (LC)",
    description: "√à l‚Äôanimale pi√π veloce del pianeta: in picchiata supera i 300 km/h. Corpo aerodinamico, ali appuntite e vista eccezionale lo rendono un cacciatore formidabile.",
    sociality: "Vive in coppie territoriali durante la stagione riproduttiva; al di fuori √® solitario. Nelle citt√† usa palazzi e campanili come ‚Äòscogliere‚Äô moderne.",
    reproduction: "Nidifica su cenge o edifici; depone 2‚Äì4 uova. I piccoli imparano presto il volo e la caccia con inseguimenti spettacolari.",
    feeding: "Colpisce uccelli in aria con la picchiata, stordendoli con l‚Äôimpatto del becco ‚Äòa dente‚Äô. Prede comuni: piccioni, storni, limicoli.",
    interactions: "Predatore apicale degli uccelli di citt√†; pu√≤ entrare in competizione con corvidi e gabbiani.",
    human: "√à tornato nelle citt√† dopo i divieti su pesticidi dannosi. Molti progetti urbani proteggono nidi su torri e grattacieli.",
    fun: "Radar naturale: insegue un piccione tra i palazzi come un jet tra canyon."
  },
  {
    name: "Corvo comune",
    scientificName: "Corvus corone",
    class: "Uccelli",
    emoji: "üê¶",
    habitat: "Campagne, citt√†, boschi aperti in Europa e Asia",
    diet: "Onnivoro opportunista",
    lifespan: "10‚Äì15 anni (pi√π in cattivit√†)",
    size: "45‚Äì50 cm; apertura alare ~1 m",
    conservation: "Least Concern (LC)",
    description: "Intelligente, curioso e adattabile. I corvi riconoscono volti, risolvono problemi e sanno usare semplici ‚Äòattrezzi‚Äô. Neri e lucidi, hanno un verso caratteristico e ‚Äòcommentano‚Äô spesso quello che vedono.",
    sociality: "Spesso in coppie stabili; si aggregano in dormitori serali rumorosi. Giovani in gruppi imparano tecniche di foraggiamento.",
    reproduction: "Nido in alto su alberi o strutture; 3‚Äì6 uova. Entrambi i genitori partecipano alle cure.",
    feeding: "Di tutto un po‚Äô: insetti, cereali, frutta, carcasse, scarti urbani. Grande memoria dei luoghi con cibo.",
    interactions: "Spazzini utili: ripuliscono carcasse e rifiuti organici. Possono rubare cibo ad altri uccelli (cleptoparassitismo leggero).",
    human: "In citt√† imparano i nostri ritmi e orari. A volte considerati ‚Äòmolesti‚Äô, ma svolgono un servizio ecologico.",
    fun: "Possono ricordarsi di chi li ha trattati bene (o male) per anni."
  },
  {
    name: "Pinguino imperatore",
    scientificName: "Aptenodytes forsteri",
    class: "Uccelli",
    emoji: "üêß",
    habitat: "Antartide: piattaforme di ghiaccio e acque gelide",
    diet: "Pesci, krill, calamari",
    lifespan: "15‚Äì20 anni",
    size: "Alto fino a 120 cm; 20‚Äì40 kg",
    conservation: "Near Threatened (NT)",
    description: "Vive e si riproduce nel pieno dell‚Äôinverno polare. Sulla terra sembra goffo, ma in acqua √® un nuotatore elegante che resiste a freddo estremo e grandi profondit√†.",
    sociality: "Colonie enormi; durante le bufere si stringono in gruppo ruotando lentamente per scaldarsi a turno.",
    reproduction: "La femmina depone un solo uovo e lo affida al maschio, che lo tiene sui piedi per settimane, digiuno, fino al ritorno della compagna.",
    feeding: "Tuffi anche oltre i 500 m, apnea di 15‚Äì20 minuti. Pesci e krill sono il menu quotidiano.",
    interactions: "Prede di foche leopardo e orche; indicatori dello stato del ghiaccio marino.",
    human: "Specie simbolo del cambiamento climatico; protetta in aree antartiche.",
    fun: "Scivolano sulla pancia per fare chilometri risparmiando energie."
  },
  {
    name: "Gallina domestica",
    scientificName: "Gallus gallus domesticus",
    class: "Uccelli",
    emoji: "üêî",
    habitat: "Aree rurali e urbane in tutto il mondo",
    diet: "Onnivora (semi, insetti, erbe)",
    lifespan: "5‚Äì10 anni (variabile)",
    size: "Molto variabile per razza",
    conservation: "‚Äî (domestica)",
    description: "Uccello domestico diffusissimo. Scava col becco e con le zampe per cercare semi e insetti. Communica con una variet√† di vocalizzi, non solo il famoso ‚Äòcoccod√®‚Äô.",
    sociality: "Vive in gruppi con gerarchie semplici (‚Äòordine di beccata‚Äô). Le chiocce proteggono e guidano i pulcini.",
    reproduction: "Depone uova con regolarit√†; se cova, le uova schiudono in circa 21 giorni. Pulcini precoci e indipendenti.",
    feeding: "Semi, erbe, insetti e avanzi; becchetta tutto il giorno.",
    interactions: "Attratta dai luoghi abitati dall‚Äôuomo: pollai, cortili, orti.",
    human: "Fondamentale per alimentazione e cultura rurale. Cresce l‚Äôinteresse per benessere e allevamenti all‚Äôaperto.",
    fun: "Riconosce i membri del gruppo e pu√≤ imparare piccole routine."
  },
  {
    name: "Coccodrillo del Nilo",
    scientificName: "Crocodylus niloticus",
    class: "Rettili",
    emoji: "üêä",
    habitat: "Fiumi, laghi e paludi dell‚ÄôAfrica",
    diet: "Carnivoro (pesci e grandi vertebrati)",
    lifespan: "40+ anni",
    size: "Fino a >5 m",
    conservation: "Least Concern (LC), tutele locali",
    description: "Massiccio e potente, passa ore immobile a scaldarsi al sole o in agguato in acqua. Mascelle fortissime e corpo corazzato.",
    sociality: "Spesso diversi individui condividono i migliori punti del fiume. Non di rado si vedono ‚Äòfile‚Äô di coccodrilli lungo le rive.",
    reproduction: "La femmina costruisce un nido nella sabbia e custodisce uova e piccoli. I neonati comunicano dal guscio con pigolii.",
    feeding: "Pesci, antilopi, zebre: afferra e trascina in acqua per annegare la preda. Denti per afferrare, non per masticare.",
    interactions: "Predatore al vertice delle catene fluviali; pu√≤ competere con grossi varani e rapaci.",
    human: "Temuto ma protetto in molte aree; regola popolazioni e mantiene sano l‚Äôecosistema acquatico.",
    fun: "Pu√≤ restare quasi immobile per ore: pazienza tattica da maestro."
  },
  {
    name: "Aquila reale",
    scientificName: "Aquila chrysaetos",
    class: "Uccelli",
    emoji: "ü¶Ö",
    habitat: "Montagne e scogliere dell‚Äôemisfero nord",
    diet: "Carnivoro (predatore)",
    lifespan: "20‚Äì30 anni",
    size: "Apertura alare fino a 2,3 m",
    conservation: "Least Concern (LC)",
    description: "Grande rapace dalla vista acutissima. Vola in cerchi sfruttando le correnti calde e si lancia in picchiate fulminee.",
    sociality: "Di solito in coppia stabile e territoriale; i nidi vengono riutilizzati per anni.",
    reproduction: "Depone 1‚Äì3 uova; il piccolo pi√π forte spesso prevale. I genitori si alternano nella cura.",
    feeding: "Preda lepri, marmotte e uccelli di medie dimensioni. In inverno pu√≤ nutrirsi anche di carcasse.",
    interactions: "Competizione con corvi e altri rapaci su carogne e territori.",
    human: "Specie simbolo delle montagne; sensibile al disturbo vicino ai nidi.",
    fun: "Veleggia per ore senza quasi battere le ali."
  },
  {
    name: "Salamandra pezzata",
    scientificName: "Salamandra salamandra",
    class: "Anfibi",
    emoji: "ü¶é",
    habitat: "Boschi umidi europei, vicino ad acqua pulita",
    diet: "Insettivora (vermi, larve, piccoli invertebrati)",
    lifespan: "Fino a 20 anni",
    size: "15‚Äì25 cm",
    conservation: "Varia per area; rischio malattie emergenti",
    description: "Corpo nero lucidissimo con macchie gialle ben visibili: un cartello ‚Äònon mangiarmi‚Äô. √à attiva soprattutto dopo la pioggia e di notte.",
    sociality: "Timida e solitaria, si rifugia sotto tronchi e pietre umide.",
    reproduction: "In molte popolazioni le femmine partoriscono larve in acqua limpida; i piccoli completano la metamorfosi in poche settimane.",
    feeding: "Caccia lentamente ci√≤ che si muove vicino al suolo: vermi, lumache e insetti.",
    interactions: "Le ghiandole cutanee secernono sostanze urticanti: i predatori imparano a evitarla.",
    human: "Specie indicatrice di acque e boschi sani; sensibile all‚Äôinquinamento.",
    fun: "Dopo un temporale √® il momento migliore per incontrarla in cammino nel bosco."
  },
  {
    name: "Camaleonte comune",
    scientificName: "Chamaeleo chamaeleon",
    class: "Rettili",
    emoji: "ü¶é",
    habitat: "Macchia mediterranea, arbusti e alberi bassi",
    diet: "Insettivoro",
    lifespan: "4‚Äì7 anni",
    size: "20‚Äì35 cm (con coda)",
    conservation: "Varia localmente",
    description: "Maestro del mimetismo: cambia colore per comunicare e regolare la temperatura. Occhi indipendenti e lingua ‚Äòa molla‚Äô velocissima.",
    sociality: "Territoriale e solitario; interazioni soprattutto in stagione riproduttiva.",
    reproduction: "La femmina depone uova nel terreno soffice; i piccoli nascono gi√† indipendenti.",
    feeding: "Cattura insetti con un colpo di lingua appiccicosa che scatta come una fionda.",
    interactions: "Predato da serpenti e rapaci; confida molto nell‚Äôimmobilit√† e nel mimetismo.",
    human: "Minacciato dalla perdita di habitat e dal prelievo illegale in alcune aree.",
    fun: "Ogni occhio guarda altrove: √® come avere due telecamere sul cavalletto."
  },
  {
    name: "Gatto domestico",
    scientificName: "Felis catus",
    class: "Mammiferi",
    emoji: "üê±",
    habitat: "Case, fattorie e ambienti urbani di tutto il mondo",
    diet: "Carnivoro facoltativo",
    lifespan: "12‚Äì18 anni (media)",
    size: "3‚Äì6 kg (media)",
    conservation: "‚Äî (domestica)",
    description: "Agile, curioso e indipendente. Ha sensi finissimi: vista notturna, baffi sensibili e udito teso anche ai suoni molto acuti.",
    sociality: "Pu√≤ vivere da solo o in gruppo; comunica con posture, fusa, miagolii e odori.",
    reproduction: "Gestazione di ~63 giorni; cucciolate multiple all‚Äôanno se non sterilizzato.",
    feeding: "Preferisce proteine animali; attenzione all‚Äôobesit√† in vita domestica.",
    interactions: "Ottimo predatore di piccoli animali; va gestito con responsabilit√† per tutelare la fauna locale.",
    human: "Compagno di casa amatissimo; richiede cure veterinarie, sterilizzazione e arricchimento ambientale.",
    fun: "Scatole, laser e sonnellini al sole: la triade del benessere felino."
  }
];

// ==========================
// UTILIT√Ä & TEMA
// ==========================
const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = [a.name,a.scientificName,a.habitat,a.diet,a.class].join(" ").toLowerCase(); });
const by = key => (a,b)=> (a[key]||"").localeCompare(b[key]||"");
const qs = sel => document.querySelector(sel);
const qsa = sel => [...document.querySelectorAll(sel)];
const state = { q:"", cls:"", route:"/home" };

const habClass = (hab='')=>{
  const h = hab.toLowerCase();
  if(h.includes('bamb√π')||h.includes('foreste')||h.includes('foresta')) return 'hab-foresta';
  if(h.includes('savana')||h.includes('prateria')) return 'hab-savana';
  if(h.includes('antart')||h.includes('ghiaccio')||h.includes('polo')) return 'hab-ghiaccio';
  if(h.includes('mare')||h.includes('oceano')||h.includes('coste')) return 'hab-oceano';
  if(h.includes('montagne')||h.includes('scogliere')||h.includes('alp')) return 'hab-montagna';
  if(h.includes('deserto')||h.includes('arido')) return 'hab-deserto';
  if(h.includes('prateria')||h.includes('steppe')) return 'hab-prateria';
  return 'hab-prateria';
};
const toTheme = (habClass)=>({
  'hab-foresta':'theme-foresta','hab-savana':'theme-savana','hab-ghiaccio':'theme-ghiaccio','hab-oceano':'theme-oceano','hab-montagna':'theme-montagna','hab-deserto':'theme-deserto','hab-prateria':'theme-prateria'
}[habClass]||'theme-prateria');
const THEMES = ['theme-foresta','theme-savana','theme-oceano','theme-montagna','theme-ghiaccio','theme-deserto','theme-prateria'];
function applyTheme(theme){ document.body.classList.remove(...THEMES); if(theme) document.body.classList.add(theme); }

// ==========================
// TEMPLATES
// ==========================
function cardTpl(a){
  const hc = habClass(a.habitat);
  return `
    <article class="card" aria-label="${a.name}">
      <div class="thumb ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
      <div class="body">
        <span class="badge">${a.class}</span>
        <h3>${a.name}</h3>
        <div class="meta"><i>${a.scientificName}</i></div>
        <div class="actions"><a class="btn" href="#/animal/${a.id}">Apri scheda</a></div>
      </div>
    </article>`;
}
function listTpl(){
  const items = filteredItems();
  const cards = items.map(cardTpl).join('');
  return `<div class="grid">${cards || emptyTpl()}</div>`;
}
function detailTpl(a){
  const facts = (a.facts||[]).map(f=>`<li>${f}</li>`).join('');
  return `
  <div class="detail">
    <a class="back" href="#/home">‚Üê Torna alla home</a>
    <div class="panel pad">
      <div style="display:flex; gap:16px; align-items:center; flex-wrap:wrap">
        <div class="thumb ${habClass(a.habitat)}" style="width:140px; height:140px; font-size:64px"><div class="emoji">${a.emoji||'üß¨'}</div></div>
        <div style="flex:1; min-width:240px">
          <h2 style="margin:0 0 6px">${a.name}</h2>
          <div class="meta"><i>${a.scientificName}</i></div>
          <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:8px" class="meta">
            <span>Habitat: <b>${a.habitat}</b></span> ¬∑
            <span>Dieta: <b>${a.diet}</b></span> ¬∑
            <span>Vita media: <b>${a.lifespan}</b></span>
          </div>
        </div>
      </div>
    </div>

    <div class="panel pad"><h3 style="margin-top:0">Descrizione</h3><p>${a.description||'‚Äî'}</p></div>
    <div class="panel pad"><h3 style="margin-top:0">Socialit√†</h3><p>${a.sociality||'‚Äî'}</p></div>
    <div class="panel pad"><h3 style="margin-top:0">Riproduzione</h3><p>${a.reproduction||'‚Äî'}</p></div>
    <div class="panel pad"><h3 style="margin-top:0">Alimentazione / Caccia</h3><p>${a.feeding||'‚Äî'}</p></div>
    <div class="panel pad"><h3 style="margin-top:0">Interazioni ecologiche</h3><p>${a.interactions||'‚Äî'}</p></div>
    <div class="panel pad"><h3 style="margin-top:0">Rapporto con l'uomo</h3><p>${a.human||'‚Äî'}</p></div>
    ${facts?`<div class="panel pad"><h3 style="margin-top:0">Curiosit√†</h3><ul>${facts}</ul></div>`:''}
    <div><a class="btn" href="#/animali">Torna all'elenco</a></div>
  </div>`;
}
function curiositaTpl(){
  const pick = arr=>arr[Math.floor(Math.random()*arr.length)];
  const facts = [];
  for(let i=0;i<6;i++){ const a = pick(ANIMALS); facts.push(`<li><b>${a.name}:</b> ${pick(a.facts||[a.description||'‚Äî'])}</li>`); }
  return `<div class="panel pad"><h2 style="margin-top:0">Curiosit√† casuali ‚ú®</h2><ul>${facts.join('')}</ul></div>`;
}
function contattiTpl(){ return `<div class="panel pad"><h2 style="margin-top:0">Contatti</h2><p>Progetto didattico. Apri una issue sul repository GitHub del progetto per suggerimenti o contributi.</p></div>` }
function notFoundTpl(){ return `<div class="panel pad"><h2>Ops!</h2><p>Animale non trovato.</p></div>` }
function emptyTpl(){ return `<div class="panel pad"><p>Nessun risultato. Prova a cambiare ricerca o filtro.</p></div>` }

// ==========================
// RENDER & ROUTER
// ==========================
function filteredItems(){
  const q = (state.q||'').trim().toLowerCase();
  return ANIMALS.filter(a => (!q || a._hay.includes(q))).filter(a => (!state.cls || a.class===state.cls)).sort(by('name'));
}
function render(){
  const container = qs('#view');
  const hash = location.hash.replace('#','') || '/home';
  state.route = hash;
  if(hash.startsWith('/animal/')){
    const id = hash.split('/')[2];
    const a = ANIMALS.find(x=>x.id===id);
    if(a) applyTheme(toTheme(habClass(a.habitat)));
    container.innerHTML = a ? detailTpl(a) : notFoundTpl();
    return;
  }
  if(hash==='/curiosita'){ applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]); container.innerHTML = curiositaTpl(); return; }
  if(hash==='/contatti'){ applyTheme(''); container.innerHTML = contattiTpl(); return; }
  // Home/Elenco
  applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]);
  container.innerHTML = listTpl();
}

// ==========================
// INTERAZIONE
// ==========================
function showToast(msg){ const t = qs('#toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(showToast._t); showToast._t = setTimeout(()=> t.classList.remove('show'), 2000); }
function goRandom(){ const items = filteredItems(); if(!items.length) return; const pick = items[Math.floor(Math.random()*items.length)]; location.hash = `#/animal/${pick.id}`; showToast(`Hai pescato: ${pick.name}! üé≤`); }

function setupControls(){
  qs('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
  qs('#filterClass').addEventListener('change', e=>{ state.cls = e.target.value; render(); });
  const br = qs('#btnRandom'); if(br) br.addEventListener('click', goRandom);
  window.addEventListener('keydown', (e)=>{ if(e.key && e.key.toLowerCase()==='r' && !e.metaKey && !e.ctrlKey && !e.altKey){ const active = document.activeElement; if(active && (active.tagName==='INPUT' || active.tagName==='TEXTAREA')) return; e.preventDefault(); goRandom(); }});
}

window.addEventListener('hashchange', render);
window.addEventListener('DOMContentLoaded', ()=>{ setupControls(); render(); });
</script>
</body>
</html>
