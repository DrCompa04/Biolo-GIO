<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biolo‚ÄëGio | Enciclopedia degli animali</title>
  <meta name="description" content="Schede chiare e ricche su animali, habitat, dieta, comportamento, riproduzione, ruolo ecologico e curiosit√†. Perfetto per GitHub Pages." />
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --muted:#475569; --text:#0f172a;
      --brand:#06b6d4; --brand-2:#8b5cf6; --accent:#10b981; --card:#ffffff; --ring:#22d3ee55; --radius:18px;
      --t0:#ffffff; --t1:#f1f5f9; --pattern:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'/>");
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--text); background:#f1f5f9; line-height:1.6;}

    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(10px); background:linear-gradient(180deg, #ffffffee, #ffffffcc); border-bottom:1px solid #e2e8f0}
    .wrap{max-width:1180px; margin:auto; padding:16px}
    .topbar{display:flex; align-items:center; gap:16px}
    .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .logo .mark{width:38px;height:38px;border-radius:12px;display:grid;place-items:center; background: conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--accent)); box-shadow:0 0 0 4px #00000005 inset, 0 10px 30px #0001;}
    .logo b{font-size:20px; letter-spacing:.3px}
    nav{margin-left:auto; display:flex; gap:14px; flex-wrap:wrap}
    nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
    nav a:hover{color:var(--text); background:#e2e8f0}

    .hero{display:grid; gap:4px; padding:24px 0 8px}
    .hero h1{margin:0; font-size:clamp(28px, 4vw, 44px); line-height:1.15}
    .hero p{margin:0; color:var(--muted)}

    .panel{background:var(--panel); border:1px solid #e2e8f0; border-radius:var(--radius); box-shadow:0 8px 30px #0000000d}
    .panel.pad{padding:16px}

    .controls{display:grid; grid-template-columns:1fr 200px; gap:12px; align-items:center}
    .search{position:relative}
    .search input{width:100%; padding:14px 44px 14px 14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}
    .search input:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
    .search .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.6}
    select{width:100%; padding:14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}

    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:16px; margin-top:16px}
    .card{background:var(--card); border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-4px); box-shadow:0 12px 30px #00000014}
    .thumb{height:160px; display:grid; place-items:center; font-size:72px; position:relative; overflow:hidden}
    .thumb .emoji{position:relative; z-index:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}

    .hab-foresta{background: linear-gradient(135deg,#dcfce7,#bbf7d0)}
    .hab-savana{background: linear-gradient(135deg,#fef9c3,#fde68a)}
    .hab-oceano{background: linear-gradient(135deg,#e0f2fe,#bae6fd)}
    .hab-montagna{background: linear-gradient(135deg,#e2e8f0,#cbd5e1)}
    .hab-ghiaccio{background: linear-gradient(135deg,#f1f5f9,#e0f2fe)}
    .hab-deserto{background: linear-gradient(135deg,#ffedd5,#fed7aa)}
    .hab-prateria{background: linear-gradient(135deg,#d1fae5,#a7f3d0)}

    .badge{display:inline-block; padding:4px 8px; border:1px solid #c7d2fe; border-radius:999px; font-size:12px; color:#4338ca; background:#eef2ff}
    .card .body{padding:12px 14px}
    .card h3{margin:0 0 6px; font-size:18px}
    .meta{font-size:13px; color:var(--muted)}
    .card .actions{display:flex; gap:8px; margin-top:12px}
    .btn{appearance:none; border:none; padding:10px 12px; border-radius:10px; background:#dbf4ff; color:#0c4a6e; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center}
    .btn:hover{background:#bae6fd}

    /* ===== LAYOUT SCHEDA: hero + sidebar sticky; sezioni a fisarmonica (collassabili) ===== */
    .detail{margin-top:24px; display:grid; grid-template-columns:1.6fr 0.9fr; gap:18px}
    .hero-animal{border-radius:16px; overflow:hidden; position:relative; border:1px solid #e2e8f0}
    .hero-animal .banner{height:180px; display:grid; place-items:center; font-size:96px}
    .hero-animal .head{display:flex; gap:16px; align-items:center; padding:12px 16px}
    .hero-animal h2{margin:0}
    .quick{position:sticky; top:90px; align-self:start}
    .quick .kv{display:grid; grid-template-columns:auto 1fr; gap:8px 12px; font-size:14px}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#f1f5f9; border:1px solid #e2e8f0; font-size:12px}

    .toc{display:flex; flex-wrap:wrap; gap:8px; padding:8px 0}
    .toc a{padding:6px 10px; border:1px solid #e2e8f0; border-radius:999px; text-decoration:none; color:#334155; background:#fff}
    .toc a:hover{background:#f8fafc}

    .section{scroll-margin-top:100px}
    .section h3{margin:0 0 8px}
    .callout{background:#ecfeff; border:1px solid #bae6fd; padding:10px 12px; border-radius:12px; font-size:14px}

    /* Dettagli/summary stilizzati per fisarmonica */
    details.panel{overflow:hidden}
    details[open] summary .chev{transform:rotate(90deg)}
    summary{list-style:none; cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:600}
    summary::-webkit-details-marker{display:none}
    .chev{transition:transform .2s ease}

    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(40px);background:linear-gradient(135deg,var(--brand),var(--brand-2));color:white;padding:10px 18px;border-radius:12px;box-shadow:0 8px 30px #00000026;opacity:0;pointer-events:none;transition:opacity .35s, transform .35s;z-index:9999}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    footer{margin:30px 0 60px; color:var(--muted)}
    footer a{color:var(--brand)}
    @media (max-width:900px){ .detail{grid-template-columns:1fr} .quick{position:relative; top:auto} }

    /* ===== Temi habitat PAGINA (gradiente + pattern sempre visibile) ===== */
    @keyframes drift { 0%{background-position:0 0, 0 0, 200px 200px} 100%{background-position:0 0, 0 0, 400px 400px} }
    body[class*="theme-"]{
      background-attachment: fixed;
      background-image:
        linear-gradient(180deg, var(--t0), var(--t1) 60%),
        radial-gradient(900px 700px at 110% 0%, rgba(255,255,255,.45), transparent),
        var(--pattern);
      background-size:auto, auto, 240px 240px;
      animation: drift 120s linear infinite;
    }
    body.theme-foresta{} body.theme-savana{} body.theme-oceano{} body.theme-montagna{} body.theme-ghiaccio{} body.theme-deserto{} body.theme-prateria{}
  </style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <a class="logo" href="#/home" aria-label="Biolo‚ÄëGio home">
      <div class="mark">üß¨</div>
      <b>Biolo‚ÄëGio</b>
    </a>
    <nav>
      <a href="#/home">Home</a>
      <a href="#/animali">Animali</a>
      <a href="#/curiosita">Curiosit√†</a>
      <a href="#/contatti">Contatti</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Enciclopedia degli animali, chiara e completa.</h1>
    <p>Descrizione sempre visibile. Altre categorie apribili con un click. Sfondi leggeri che richiamano l‚Äôhabitat.</p>
  </section>

  <section class="panel pad" id="controls">
    <div class="controls">
      <label class="search">
        <input id="q" placeholder="Cerca per nome, habitat, dieta‚Ä¶ (es. falco, savana, insettivoro)" autocomplete="off" />
        <span class="icon">üîé</span>
      </label>
      <label>
        <select id="filterClass">
          <option value="">Tutte le classi</option>
          <option>Mammiferi</option>
          <option>Uccelli</option>
          <option>Rettili</option>
          <option>Anfibi</option>
          <option>Pesci</option>
          <option>Invertebrati</option>
        </select>
      </label>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="btnRandom">üé≤ Animale casuale</button>
      <span class="meta">Premi <kbd>R</kbd> per pescarne uno a caso.</span>
    </div>
  </section>

  <section id="view"></section>

  <footer>
    <p>Progetto <b>Biolo‚ÄëGio</b>. Un solo file, massima semplicit√†. Pubblica su GitHub Pages e diffondi la meraviglia del regno animale.</p>
  </footer>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ==========================
   DATI (10 specie) ‚Äî testi ampliati, semplici e ricchi
   ========================== */
const ANIMALS = [
  {
    name: "Wombat",
    scientificName: "Vombatus ursinus",
    class: "Mammiferi",
    emoji: "ü™µ",
    habitat: "Praterie e foreste aperte dell'Australia sud‚Äëorientale",
    diet: "Erbivoro (erbe, cortecce, radici)",
    lifespan: "10‚Äì15 anni",
    size: "20‚Äì35 kg; ~1 m",
    conservation: "Least Concern",
    description: "Marsupiale tozzo e robusto, costruisce reti di tunnel freschi d'estate e tiepidi d'inverno, lunghi anche decine di metri. Ha zampe anteriori muscolose e artigli larghi per scavare terreni duri. Manto fitto, muso quadrato, orecchie piccole: design perfetto per la vita sottoterra.",
    sociality: "Solitario e notturno, ma tollera vicini nelle porzioni periferiche della tana. Segna il territorio con odori e con i celebri 'cubi'. Attivo dal tramonto all'alba; di giorno riposa in profondit√† dove la temperatura √® stabile.",
    reproduction: "Di solito un solo piccolo. Resta nel marsupio 6‚Äì7 mesi (aperto all'indietro, cos√¨ non entra terra), poi continua a nutrirsi di latte per alcune settimane mentre impara i percorsi della tana.",
    feeding: "Bruca erbe dure, cortecce e radici. Digestione lentissima (oltre 24‚Äì48 ore) che estrae energia da fibre povere; beve raramente perch√© ricava acqua dal cibo e dalla rugiada.",
    interactions: "Le tane creano micro‚Äëhabitat usati da rettili, piccoli mammiferi e uccelli. In caso di predatori si infila nel tunnel e pu√≤ 'tappare' l'ingresso con il posteriore osseo.",
    human: "Minacce: strade, recinzioni, perdita di habitat e siccit√†. In molte zone √® protetto e considerato 'ingegnere dell'ecosistema' per i benefici delle sue tane.",
    fun: "Produce feci a forma di cubo: non rotolano e restano dove servono a marcare.",
    facts: ["Tane ramificate e fresche","Marsupio rivolto all'indietro","Attivo soprattutto di notte","Digestione lentissima"]
  },
  {
    name: "Falco pellegrino",
    scientificName: "Falco peregrinus",
    class: "Uccelli",
    emoji: "ü™∂",
    habitat: "Scogliere, montagne e citt√† in tutto il mondo",
    diet: "Carnivoro (uccelli in volo)",
    lifespan: "~15 anni",
    size: "Apertura alare 80‚Äì120 cm",
    conservation: "Least Concern",
    description: "Rapace compatto e aerodinamico con ali appuntite e baffi scuri ai lati del becco. In picchiata supera i 300 km/h, rendendolo l'animale pi√π veloce del pianeta.",
    sociality: "Coppie stabili su territori con buone 'piste di decollo' (cenge, torri, campanili). In citt√† caccia tra i palazzi usando corridoi d'aria e correnti termiche urbane.",
    reproduction: "Nidifica in conchette su roccia o su tetti ghiaiosi. 2‚Äì4 uova, incubazione condivisa. I giovani esercitano la mira in inseguimenti‚Äëgioco con i genitori che lasciano cadere la preda.",
    feeding: "Preda uccelli in volo (piccioni, storni, limicoli). La picchiata colpisce e stordisce; la preda viene afferrata in aria o recuperata a terra.",
    interactions: "Predatore apicale di comunit√† urbane di uccelli; compete con gabbiani e corvidi per posatoi. Pu√≤ essere mobbato da stormi quando √® individuato.",
    human: "Crollato nel '900 per pesticidi (gusci fragili), √® tornato grazie ai divieti e ai progetti di tutela. Molte citt√† ospitano webcam sui nidi.",
    fun: "Un 'jet' naturale: manovre strette e controllo impressionante nelle curve aeree.",
    facts: [">300 km/h in picchiata","Nidi urbani su campanili","Vista 2‚Äì3√ó pi√π fine della nostra","Becco con 'dente' tagliente"]
  },
  {
    name: "Corvo comune",
    scientificName: "Corvus corone",
    class: "Uccelli",
    emoji: "üê¶",
    habitat: "Campagne, citt√† e boschi aperti in Europa e Asia",
    diet: "Onnivoro opportunista",
    lifespan: "10‚Äì15 anni",
    size: "45‚Äì50 cm; apertura alare ~1 m",
    conservation: "Least Concern",
    description: "Uccello nero lucido, intelligente e curioso. Riconosce volti, ricorda eventi, usa piccoli strumenti e apprende osservando gli altri.",
    sociality: "Coppie stabili; la sera grandi dormitori condivisi, soprattutto in inverno. Giovani 'in banda' esplorano e imparano dove trovare cibo.",
    reproduction: "Nido ben costruito in alto; 3‚Äì6 uova. Entrambi i genitori nutrono i piccoli e difendono il nido con richiamo d'allarme.",
    feeding: "Dieta flessibile: insetti, cereali, frutti, carcasse, scarti urbani. Nasconde cibo in 'dispense' e ricorda i nascondigli.",
    interactions: "Spazzino utile: accelera la decomposizione e pulisce rifiuti organici. Pu√≤ rubare cibo ad altri uccelli (cleptoparassitismo).",
    human: "In citt√† capisce i nostri orari (es. uscita delle mense). A volte rumoroso, ma aiuta a mantenere puliti i parchi.",
    fun: "Ricorda per anni chi lo ha aiutato‚Ä¶ o disturbato.",
    facts: ["Usa attrezzi semplici","Memoria a lungo termine","Si adatta alla vita urbana","Richiami vari e 'commenti'"]
  },
  {
    name: "Pinguino imperatore",
    scientificName: "Aptenodytes forsteri",
    class: "Uccelli",
    emoji: "üêß",
    habitat: "Antartide: piattaforme di ghiaccio e acque gelide",
    diet: "Pesci, krill, calamari",
    lifespan: "15‚Äì20 anni",
    size: "Fino a 120 cm; 20‚Äì40 kg",
    conservation: "Near Threatened",
    description: "L'unico uccello che si riproduce nel cuore dell'inverno antartico. Piume fittissime e strato di grasso isolante lo proteggono da venti e freddo intensi. Goffo a terra, elegantissimo in acqua.",
    sociality: "Colonie di migliaia. Durante le bufere gli adulti si stringono ruotando per scaldarsi a turno; i pulcini imparano presto la 'voce' dei genitori.",
    reproduction: "Un solo uovo: la femmina lo depone e parte a nutrirsi; il maschio lo cova sui piedi, sotto una piega di pelle, per ~60 giorni a digiuno. Poi si alternano.",
    feeding: "Tuffi profondi (anche >500 m) e apnea di 15‚Äì20 minuti. Caccia pesci e krill seguendo banchi e luce sotto il ghiaccio.",
    interactions: "Prede di foche leopardo e orche; in superficie devono evitare crepacci e predatori aerei sui pulcini.",
    human: "Specie simbolo della salute del ghiaccio marino; protetta e monitorata.",
    fun: "Si sposta 'pattinando' sulla pancia per risparmiare energia.",
    facts: ["Colonie gigantesche","Uovo covato sui piedi","Immersioni eccezionali","'Huddle' anti‚Äëtempesta"]
  },
  {
    name: "Gallina domestica",
    scientificName: "Gallus gallus domesticus",
    class: "Uccelli",
    emoji: "üêî",
    habitat: "Aree rurali e urbane di tutto il mondo",
    diet: "Onnivora (semi, insetti, erbe)",
    lifespan: "5‚Äì10 anni",
    size: "Variabile per razza",
    conservation: "‚Äî",
    description: "Uccello domestico diffusissimo. Becchetta e razzola tutto il giorno, comunicando con richiami diversi: allarme, scoperta cibo, richiamo dei pulcini.",
    sociality: "Vive in gruppo con gerarchie ('ordine di beccata'). La chioccia insegna ai pulcini cosa mangiare e li scalda sotto le ali.",
    reproduction: "Depone uova regolarmente; se cova, schiusa in ~21 giorni. Pulcini precoci: camminano e mangiano subito.",
    feeding: "Semi, erbe, insetti e scarti controllati. Serve acqua pulita e spazio per razzolare.",
    interactions: "Attira piccoli predatori (volpe, faina, poiane): pollaio da proteggere con reti e chiusure serali.",
    human: "Risorsa alimentare e culturale; cresce l'attenzione per benessere, spazio e luce naturale.",
    fun: "Riconosce i compagni e memorizza routine quotidiane.",
    facts: ["21 giorni di cova","Ordine di beccata","Molte razze selezionate","Comunicazione ricca di richiami"]
  },
  {
    name: "Coccodrillo del Nilo",
    scientificName: "Crocodylus niloticus",
    class: "Rettili",
    emoji: "üêä",
    habitat: "Fiumi, laghi e paludi dell‚ÄôAfrica",
    diet: "Carnivoro (pesci e grandi vertebrati)",
    lifespan: "40+ anni",
    size: ">5 m (massimi)",
    conservation: "Least Concern (tutele locali)",
    description: "Rettile massiccio e corazzato. Termoregola alternando sole e acqua. Attende immobile e scatta con potenza quando la preda √® a portata.",
    sociality: "Pi√π individui condividono gli stessi tratti di riva, soprattutto nella stagione secca quando l'acqua scarseggia.",
    reproduction: "La femmina scava un nido nella sabbia e sorveglia uova e piccoli. I neonati pigolano dal guscio: la madre li aiuta a uscire e li trasporta all'acqua.",
    feeding: "Pesci, antilopi, zebre e uccelli acquatici. Denti per afferrare, non per masticare: lacera scuotendo e ingoia grossi pezzi.",
    interactions: "Predatore al vertice che mantiene in equilibrio l'ecosistema fluviale rimuovendo prede deboli/malate.",
    human: "Conflitti vicino a rive non protette. La gestione di corridoi fluviali e la segnaletica riduce i rischi.",
    fun: "Apnea prolungata e mimetismo in acqua: solo gli occhi e le narici emergono.",
    facts: ["Morsi potentissimi","Cure parentali insospettate","Aspetta immobile per ore","Narici e occhi 'a periscopio'"]
  },
  {
    name: "Aquila reale",
    scientificName: "Aquila chrysaetos",
    class: "Uccelli",
    emoji: "ü¶Ö",
    habitat: "Montagne e scogliere dell'emisfero nord",
    diet: "Carnivoro (predatore)",
    lifespan: "20‚Äì30 anni",
    size: "Apertura alare fino a 2,3 m",
    conservation: "Least Concern",
    description: "Grande rapace bruno con nuca dorata. Vista acutissima e volo maestoso. Usa correnti ascensionali per veleggiare a lungo.",
    sociality: "Coppie stabili e territoriali. Nidi enormi su cenge o alberi, riutilizzati e ampliati per anni.",
    reproduction: "1‚Äì3 uova; spesso il primo nato prevale (siblicidio). Genitori si alternano tra caccia e cova.",
    feeding: "Lepri, marmotte, uccelli e, d'inverno, carogne. Attacchi rapidi dall'alto con affondi potenti.",
    interactions: "Competizione con corvi e altri rapaci; subisce mobbing dai corvidi vicino ai dormitori.",
    human: "Sensibile al disturbo in nidificazione e a infrastrutture (cavi, eolico). Specie tutelata in molte aree montane.",
    fun: "Pu√≤ restare in aria per ore con pochissimi battiti d'ala.",
    facts: ["Vista eccezionale (fovea sviluppatissima)","Nidi monumentali","Picchiate fulminee","Territori molto estesi"]
  },
  {
    name: "Salamandra pezzata",
    scientificName: "Salamandra salamandra",
    class: "Anfibi",
    emoji: "ü¶é",
    habitat: "Boschi umidi europei, presso acque pulite",
    diet: "Insettivora (vermi, larve, piccoli invertebrati)",
    lifespan: "Fino a 20 anni",
    size: "15‚Äì25 cm",
    conservation: "Varia per area",
    description: "Corpo nero lucido con macchie gialle vistose: avviso chimico per i predatori. Attiva con umidit√† alta, specialmente dopo i temporali.",
    sociality: "Schiva e solitaria. Di giorno si ripara sotto tronchi e pietre umide; esce di notte per cacciare.",
    reproduction: "In molte aree le femmine partoriscono larve in acque pulite di ruscelli e pozze. Metamorfosi in settimane prima della vita terrestre.",
    feeding: "Caccia lenta a breve distanza: lombrichi, lumache, larve e piccoli insetti del suolo.",
    interactions: "Secrezioni cutanee irritanti scoraggiano i predatori. Specie indicatrice: scompare se l'acqua si inquina.",
    human: "Minacciata da inquinamento, frammentazione boschiva e malattie fungine emergenti.",
    fun: "Dopo la pioggia √® pi√π facile vederla camminare sul sentiero bagnato.",
    facts: ["Colori di avviso (aposematismo)","Attiva dopo la pioggia","Pelle sensibile all'inquinamento","Larve in acqua pulita"]
  },
  {
    name: "Camaleonte comune",
    scientificName: "Chamaeleo chamaeleon",
    class: "Rettili",
    emoji: "ü¶é",
    habitat: "Macchia mediterranea, arbusti e alberi bassi",
    diet: "Insettivoro",
    lifespan: "4‚Äì7 anni",
    size: "20‚Äì35 cm (con coda)",
    conservation: "Varia localmente",
    description: "Corpo laterale compresso, dita a pinza, coda prensile. Occhi che si muovono indipendentemente e lingua 'a molla' pi√π lunga della testa. Cambia colore per comunicare e regolare la temperatura, non per 'sparire' come nei cartoni.",
    sociality: "Territoriale e solitario. Incontro fra adulti = esibizioni di colore e postura; se necessario, fuga lenta 'a dondolo' che imita il vento.",
    reproduction: "Dopo l'accoppiamento, la femmina depone uova nel terreno soffice e le ricopre. I piccoli nascono autosufficienti.",
    feeding: "Cattura insetti con uno scatto di lingua appiccicosa. Preferisce caccia d'agguato: attende immobile e si muove lentamente.",
    interactions: "Predato da serpenti e rapaci. Il mimetismo e l'immobilit√† sono le difese principali.",
    human: "Minacciato da perdita di habitat, traffico stradale e prelievo illegale in alcune aree.",
    fun: "Ogni occhio guarda un mondo diverso: pu√≤ seguire preda e predatore insieme.",
    facts: ["Lingua proiettile rapidissima","Occhi indipendenti","Coda prensile","Mimetismo per comunicare"]
  },
  {
    name: "Gatto domestico",
    scientificName: "Felis catus",
    class: "Mammiferi",
    emoji: "üê±",
    habitat: "Case, fattorie e citt√† di tutto il mondo",
    diet: "Carnivoro facoltativo",
    lifespan: "12‚Äì18 anni",
    size: "3‚Äì6 kg (media)",
    conservation: "‚Äî",
    description: "Agile e curioso. Vista crepuscolare, baffi come sensori di spazio, udito fino agli ultrasuoni: strumenti da cacciatore anche in casa.",
    sociality: "Vive da solo o in piccoli gruppi legati alle risorse. Linguaggio ricco: fusa, miagolii, posture, strofinamenti e marcature odorose.",
    reproduction: "Gestazione ~63 giorni; cucciolate multiple all'anno se non sterilizzato. Cuccioli ciechi alla nascita, svezzamento graduale.",
    feeding: "Preferisce proteine animali; in ambiente domestico servono dieta bilanciata, acqua fresca, gioco e arricchimento per prevenire obesit√†.",
    interactions: "Ottimo predatore di piccoli vertebrati: all'aperto va gestito (campanellino, orari) per ridurre l'impatto sulla fauna.",
    human: "Compagno diffuso; fondamentali sterilizzazione, vaccinazioni e visite veterinarie. Arricchimento: tiragraffi, nascondigli, giochi mentali.",
    fun: "Scatole, laser e sole: il trio della felicit√† felina.",
    facts: ["Visione crepuscolare","Baffi sensori di distanza","Cacciatore naturale","Necessita arricchimento in casa"]
  }
];

/* ==========================
   INDICIZZAZIONE & UTIL
   ========================== */
const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = [a.name,a.scientificName,a.habitat,a.diet,a.class,(a.facts||[]).join(" ")].join(" ").toLowerCase(); });
const by = key => (a,b)=> (a[key]||"").localeCompare(b[key]||"");
const qs = sel => document.querySelector(sel);
const qsa = sel => [...document.querySelectorAll(sel)];
const state = { q:"", cls:"", route:"/home" };

/* ==========================
   HABITAT ‚Üí classi card & tema pagina
   ========================== */
const habClass = (hab='')=>{
  const h = hab.toLowerCase();
  if(h.includes('bamb√π')||h.includes('foreste')||h.includes('foresta')) return 'hab-foresta';
  if(h.includes('savana')||h.includes('prateria')) return 'hab-savana';
  if(h.includes('antart')||h.includes('ghiaccio')||h.includes('polo')) return 'hab-ghiaccio';
  if(h.includes('mare')||h.includes('oceano')||h.includes('coste')||h.includes('acque')) return 'hab-oceano';
  if(h.includes('montagne')||h.includes('scogliere')||h.includes('alp')) return 'hab-montagna';
  if(h.includes('deserto')||h.includes('arido')) return 'hab-deserto';
  if(h.includes('prateria')||h.includes('steppe')) return 'hab-prateria';
  return 'hab-prateria';
};
const toTheme = (hc)=>({
  'hab-foresta':'theme-foresta','hab-savana':'theme-savana','hab-ghiaccio':'theme-ghiaccio',
  'hab-oceano':'theme-oceano','hab-montagna':'theme-montagna','hab-deserto':'theme-deserto','hab-prateria':'theme-prateria'
}[hc]||'theme-prateria');
const THEMES = ['theme-foresta','theme-savana','theme-oceano','theme-montagna','theme-ghiaccio','theme-deserto','theme-prateria'];

// ===== Palette/pattern variabili per sfondi =====
function pickThemeVars(theme){
  const tweak = (hex, delta=0) => {
    const c = hex.replace('#','');
    const r = parseInt(c.slice(0,2),16), g = parseInt(c.slice(2,4),16), b = parseInt(c.slice(4,6),16);
    const rn=r/255, gn=g/255, bn=b/255; const max=Math.max(rn,gn,bn), min=Math.min(rn,gn,bn);
    let h,s,l=(max+min)/2, d=max-min; if(d===0){ h=0; s=0; } else { s=d/(1-Math.abs(2*l-1)); switch(max){case rn:h=((gn-bn)/d)%6;break;case gn:h=(bn-rn)/d+2;break;default:h=(rn-gn)/d+4;} h*=60; if(h<0)h+=360; }
    l=Math.min(1,Math.max(0,l+delta)); const C=(1-Math.abs(2*l-1))*s, X=C*(1-Math.abs(((h/60)%2)-1)), m=l-C/2; let rr,gg,bb;
    if(0<=h&&h<60){rr=C;gg=X;bb=0;} else if(60<=h&&h<120){rr=X;gg=C;bb=0;} else if(120<=h&&h<180){rr=0;gg=C;bb=X;} else if(180<=h&&h<240){rr=0;gg=X;bb=C;} else if(240<=h&&h<300){rr=X;gg=0;bb=C;} else {rr=C;gg=0;bb=X;}
    const R=Math.round((rr+m)*255), G=Math.round((gg+m)*255), B=Math.round((bb+m)*255);
    return `#${R.toString(16).padStart(2,'0')}${G.toString(16).padStart(2,'0')}${B.toString(16).padStart(2,'0')}`;
  };
  const sets = {
    "theme-foresta": { base0:"#f0fdf4", base1:"#dcfce7", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.08'><g fill='none' stroke='%231a6e2a' stroke-width='1'><path d='M10 200c30-30 90-30 120 0'/><path d='M0 160c30-30 90-30 120 0'/></g><g fill='%231a6e2a'><circle cx='30' cy='40' r='5'/><circle cx='150' cy='90' r='4'/></g></svg>",
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.06'><path d='M0 200l30-50 20 35 25-40 25 45' fill='none' stroke='%231f7a3b'/></svg>"
    ]},
    "theme-savana": { base0:"#fffbeb", base1:"#fef9c3", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.07'><path d='M0 180c40-12 80-12 240 0' fill='none' stroke='%236b4f1d'/><path d='M0 140c40-12 80-12 240 0' fill='none' stroke='%23865e1d'/></svg>"
    ]},
    "theme-oceano": { base0:"#f0f9ff", base1:"#e0f2fe", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.08'><path d='M0 60q40 25 80 0t80 0t80 0' fill='none' stroke='%231084b3'/><path d='M0 120q40 25 80 0t80 0t80 0' fill='none' stroke='%230d5b8f'/></svg>"
    ]},
    "theme-montagna": { base0:"#f8fafc", base1:"#e2e8f0", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='260' height='160' opacity='0.06'><path d='M0 120L40 80l20 20 20-25 40 45H0z' fill='%23cbd5e1'/></svg>"
    ]},
    "theme-ghiaccio": { base0:"#f8fafc", base1:"#e0f2fe", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' opacity='0.06'><g fill='none' stroke='%230e7490' stroke-width='1'><path d='M100 0v200M0 100h200'/><path d='M50 0v200M0 50h200'/></g></svg>"
    ]},
    "theme-deserto": { base0:"#fff7ed", base1:"#ffedd5", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240' opacity='0.06'><path d='M0 180c50-20 100-20 240 0' fill='none' stroke='%23a16207'/></svg>"
    ]},
    "theme-prateria": { base0:"#ecfeff", base1:"#d1fae5", patterns:[
      "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='220' height='220' opacity='0.06'><path d='M0 200l10-20 10 20 10-25 10 25 10-18 10 18 10-22 10 22 10-19 10 19' fill='none' stroke='%230f766e'/></svg>"
    ]}
  };
  const set = sets[theme] || sets["theme-prateria"];
  const wiggle = (Math.random()*0.08)-0.04;
  const t0 = tweak(set.base0, wiggle);
  const t1 = tweak(set.base1, -wiggle/2);
  const pat = set.patterns[Math.floor(Math.random()*set.patterns.length)];
  return { t0, t1, pat };
}

function applyTheme(theme){
  document.body.classList.remove(...THEMES);
  document.body.classList.add(theme);
  const { t0, t1, pat } = pickThemeVars(theme);
  document.documentElement.style.setProperty('--t0', t0);
  document.documentElement.style.setProperty('--t1', t1);
  document.documentElement.style.setProperty('--pattern', `url("${pat}")`);
}

/* ==========================
   TEMPLATES ‚Äî home e scheda (descrizione sempre visibile, altre sezioni collassabili)
   ========================== */
function cardTpl(a){
  const hc = habClass(a.habitat);
  return `
    <article class="card" aria-label="${a.name}">
      <div class="thumb ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
      <div class="body">
        <span class="badge">${a.class}</span>
        <h3>${a.name}</h3>
        <div class="meta"><i>${a.scientificName}</i></div>
        <div class="actions"><a class="btn" href="#/animal/${a.id}">Apri scheda</a></div>
      </div>
    </article>`;
}
function listTpl(){
  const items = filteredItems();
  const cards = items.map(cardTpl).join('');
  return `<div class="grid">${cards || emptyTpl()}</div>`;
}
function quickFacts(a){
  return `
  <div class="panel pad quick">
    <h3 style="margin-top:0">Scheda rapida</h3>
    <div class="kv">
      <div class="meta">Nome scientifico</div><div><i>${a.scientificName||'‚Äî'}</i></div>
      <div class="meta">Classe</div><div>${a.class||'‚Äî'}</div>
      <div class="meta">Habitat</div><div>${a.habitat||'‚Äî'}</div>
      <div class="meta">Dieta</div><div>${a.diet||'‚Äî'}</div>
      <div class="meta">Vita media</div><div>${a.lifespan||'‚Äî'}</div>
      <div class="meta">Dimensioni</div><div>${a.size||'‚Äî'}</div>
      <div class="meta">Conservazione</div><div>${a.conservation||'‚Äî'}</div>
    </div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:12px">
      ${(a.facts||[]).slice(0,6).map(f=>`<span class="chip">${f}</span>`).join('')}
    </div>
  </div>`;
}
function sectionDetails(id, title, content){
  return `
  <details id="${id}" class="panel pad section">
    <summary><span class="chev">‚ñ∂</span> ${title}</summary>
    <div style="margin-top:8px">${content||'‚Äî'}</div>
  </details>`;
}
function detailTpl(a){
  const hc = habClass(a.habitat);
  const facts = (a.facts||[]).map(f=>`<li>${f}</li>`).join('');
  return `
  <div class="detail">
    <div>
      <div class="hero-animal panel">
        <div class="banner ${hc}"><div class="emoji">${a.emoji||'üß¨'}</div></div>
        <div class="head">
          <div style="flex:1;min-width:240px">
            <h2>${a.name}</h2>
            <div class="meta"><i>${a.scientificName}</i></div>
            <div class="toc" aria-label="vai a sezione">
              <a href="#soc" onclick="openSection('soc');return false;">Socialit√†</a>
              <a href="#feed" onclick="openSection('feed');return false;">Alimentazione</a>
              <a href="#repr" onclick="openSection('repr');return false;">Riproduzione</a>
              <a href="#eco" onclick="openSection('eco');return false;">Ruolo ecologico</a>
              <a href="#hum" onclick="openSection('hum');return false;">Rapporto con l'uomo</a>
              <a href="#facts" onclick="openSection('facts');return false;">Curiosit√†</a>
            </div>
          </div>
          <div>
            <a class="btn" href="#/home">‚Üê Torna all'elenco</a>
          </div>
        </div>
      </div>

      <div class="panel pad section" id="desc"><h3>Descrizione generale</h3><p>${a.description||'‚Äî'}</p></div>
      ${sectionDetails('soc','Socialit√† e comportamento', a.sociality)}
      ${sectionDetails('feed','Alimentazione e caccia', a.feeding)}
      ${sectionDetails('repr','Riproduzione e crescita', a.reproduction)}
      ${sectionDetails('eco','Ruolo ecologico e predatori', a.interactions)}
      ${sectionDetails('hum','Rapporto con l\'uomo', a.human)}
      ${(a.facts&&a.facts.length)? sectionDetails('facts','Curiosit√†', `<ul>${facts}</ul>`): ''}
    </div>
    ${quickFacts(a)}
  </div>`;
}
function curiositaTpl(){
  const pick = arr=>arr[Math.floor(Math.random()*arr.length)];
  const facts = [];
  for(let i=0;i<6;i++){ const a = pick(ANIMALS); facts.push(`<li><b>${a.name}:</b> ${pick(a.facts||[a.description||'‚Äî'])}</li>`); }
  return `<div class="panel pad"><h2 style="margin-top:0">Curiosit√† casuali ‚ú®</h2><ul>${facts.join('')}</ul></div>`;
}
function contattiTpl(){ return `<div class="panel pad"><h2 style="margin-top:0">Contatti</h2><p>Progetto didattico. Apri una issue sul repository GitHub del progetto per suggerimenti o contributi.</p></div>` }
function notFoundTpl(){ return `<div class="panel pad"><h2>Ops!</h2><p>Animale non trovato.</p></div>` }
function emptyTpl(){ return `<div class="panel pad"><p>Nessun risultato. Prova a cambiare ricerca o filtro.</p></div>` }

// ==========================
// RENDER & ROUTER
// ==========================
function filteredItems(){
  const q = (state.q||'').trim().toLowerCase();
  return ANIMALS
    .filter(a => (!q || a._hay.includes(q)))
    .filter(a => (!state.cls || a.class===state.cls))
    .sort(by('name'));
}
function render(){
  const container = qs('#view');
  const hash = location.hash.replace('#','') || '/home';
  state.route = hash;
  if(hash.startsWith('/animal/')){
    const id = hash.split('/')[2];
    const a = ANIMALS.find(x=>x.id===id);
    if(a) applyTheme(toTheme(habClass(a.habitat)));
    container.innerHTML = a ? detailTpl(a) : notFoundTpl();
    return;
  }
  if(hash==='/curiosita'){ applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]); container.innerHTML = curiositaTpl(); return; }
  if(hash==='/contatti'){ applyTheme(''); container.innerHTML = contattiTpl(); return; }
  // Home/Elenco
  applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]);
  container.innerHTML = listTpl();
}

// ==========================
// INTERAZIONE
// ==========================
function showToast(msg){ const t = qs('#toast'); t.textContent = msg; t.classList.add('show'); clearTimeout(showToast._t); showToast._t = setTimeout(()=> t.classList.remove('show'), 2000); }
function goRandom(){ const items = filteredItems(); if(!items.length) return; const pick = items[Math.floor(Math.random()*items.length)]; location.hash = `#/animal/${pick.id}`; showToast(`Hai pescato: ${pick.name}! üé≤`); }
function openSection(id){ const d = document.getElementById(id); if(!d) return; if(d.tagName.toLowerCase()==='details'){ d.open = true; } d.scrollIntoView({behavior:'smooth', block:'start'}); }

function setupControls(){
  qs('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
  qs('#filterClass').addEventListener('change', e=>{ state.cls = e.target.value; render(); });
  const br = qs('#btnRandom'); if(br) br.addEventListener('click', goRandom);
  window.addEventListener('keydown', (e)=>{ if(e.key && e.key.toLowerCase()==='r' && !e.metaKey && !e.ctrlKey && !e.altKey){ const active = document.activeElement; if(active && (active.tagName==='INPUT' || active.tagName==='TEXTAREA')) return; e.preventDefault(); goRandom(); }});
}

window.addEventListener('hashchange', render);
window.addEventListener('DOMContentLoaded', ()=>{ setupControls(); render(); });
</script>
</body>
</html>
