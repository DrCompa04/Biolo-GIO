<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biolo‚ÄëGio | Enciclopedia giocosa degli animali</title>
  <meta name="description" content="Biolo‚ÄëGio: scopri specie, habitat, dieta, conservazione e curiosit√† ‚Äî veloce e semplice su GitHub Pages." />
  <style>
    :root{
      --bg:#f8fafc;          /* sfondo chiaro */
      --panel:#ffffff;        /* pannelli */
      --muted:#475569;        /* testo secondario */
      --text:#0f172a;         /* testo principale */
      --brand:#06b6d4;        /* ciano */
      --brand-2:#8b5cf6;      /* viola */
      --accent:#10b981;       /* verde */
      --danger:#ef4444;       /* rosso */
      --card:#ffffff;         /* card */
      --ring:#22d3ee55;       /* focus */
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      color:var(--text);
      background:#f1f5f9; /* base neutra: i temi la sovrascrivono */
      line-height:1.6;
      transition: background 400ms ease;
    }
    /* Temi habitat per lo sfondo pagina */
    body.theme-foresta{
      background:
        radial-gradient(1200px 800px at 10% -10%, #bbf7d0, transparent),
        radial-gradient(900px 700px at 110% 0%, #86efac, transparent),
        linear-gradient(180deg, #f0fdf4, #dcfce7 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120" opacity="0.08"><g fill="none" stroke="%2316582A" stroke-width="1"><path d="M10 100c20-30 60-30 80 0"/><path d="M0 60c30-30 90-30 120 0"/></g><g fill="none" stroke="%231F7A3B" stroke-width="1"><circle cx="20" cy="20" r="6"/><circle cx="80" cy="40" r="5"/></g></svg>');
      background-attachment: fixed;
    }
    body.theme-savana{
      background:
        radial-gradient(1200px 800px at 10% -10%, #fde68a, transparent),
        radial-gradient(900px 700px at 110% 0%, #fef3c7, transparent),
        linear-gradient(180deg, #fffbeb, #fef9c3 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120" opacity="0.07"><g fill="none" stroke="%236B4F1D" stroke-width="1"><path d="M0 90c30-10 60-10 120 0"/><path d="M0 60c30-10 60-10 120 0"/></g></svg>');
      background-attachment: fixed;
    }
    body.theme-oceano{
      background:
        radial-gradient(1200px 800px at 10% -10%, #bae6fd, transparent),
        radial-gradient(900px 700px at 110% 0%, #a5f3fc, transparent),
        linear-gradient(180deg, #f0f9ff, #e0f2fe 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120" opacity="0.08"><path d="M0 30q30 20 60 0t60 0" fill="none" stroke="%230D5B8F"/><path d="M0 70q30 20 60 0t60 0" fill="none" stroke="%231084B3"/></svg>');
      background-attachment: fixed;
    }
    body.theme-montagna{
      background:
        radial-gradient(1200px 800px at 10% -10%, #e2e8f0, transparent),
        radial-gradient(900px 700px at 110% 0%, #cbd5e1, transparent),
        linear-gradient(180deg, #f8fafc, #e2e8f0 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160" opacity="0.07"><path d="M0 120L40 80l20 20 20-25 40 45H0z" fill="%23cbd5e1"/></svg>');
      background-attachment: fixed;
    }
    body.theme-ghiaccio{
      background:
        radial-gradient(1200px 800px at 10% -10%, #e0f2fe, transparent),
        radial-gradient(900px 700px at 110% 0%, #f1f5f9, transparent),
        linear-gradient(180deg, #f8fafc, #e0f2fe 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140" opacity="0.06"><g fill="none" stroke="%230e7490" stroke-width="1"><path d="M70 0v140M0 70h140"/><path d="M35 0v140M0 35h140"/></g></svg>');
      background-attachment: fixed;
    }
    body.theme-deserto{
      background:
        radial-gradient(1200px 800px at 10% -10%, #fed7aa, transparent),
        radial-gradient(900px 700px at 110% 0%, #ffedd5, transparent),
        linear-gradient(180deg, #fff7ed, #ffedd5 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160" opacity="0.06"><path d="M0 120c40-15 80-15 160 0" fill="none" stroke="%23a16207"/></svg>');
      background-attachment: fixed;
    }
    body.theme-prateria{
      background:
        radial-gradient(1200px 800px at 10% -10%, #a7f3d0, transparent),
        radial-gradient(900px 700px at 110% 0%, #d1fae5, transparent),
        linear-gradient(180deg, #ecfeff, #d1fae5 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140" opacity="0.06"><path d="M0 120l10-20 10 20 10-25 10 25 10-18 10 18 10-22 10 22 10-19 10 19" fill="none" stroke="%230f766e"/></svg>');
      background-attachment: fixed;
    }
    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(10px);
      background:linear-gradient(180deg, #ffffffee, #ffffffcc); border-bottom:1px solid #e2e8f0}
    .wrap{max-width:1100px; margin:auto; padding:16px}
    .topbar{display:flex; align-items:center; gap:16px}
    .logo{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .logo .mark{width:38px;height:38px;border-radius:12px;display:grid;place-items:center; 
      background: conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--accent));
      box-shadow:0 0 0 4px #00000005 inset, 0 10px 30px #0001;}
    .logo b{font-size:20px; letter-spacing:.3px}
    nav{margin-left:auto; display:flex; gap:14px; flex-wrap:wrap}
    nav a{color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px}
    nav a:hover{color:var(--text); background:#e2e8f0}

    .hero{display:grid; gap:18px; padding:30px 0 8px}
    .hero h1{margin:0; font-size:clamp(28px, 4vw, 44px); line-height:1.15}
    .hero p{margin:0; color:var(--muted)}

    .panel{background:var(--panel); border:1px solid #e2e8f0; border-radius:var(--radius); box-shadow:0 8px 30px #0000000d}
    .panel.pad{padding:16px}

    .controls{display:grid; grid-template-columns:1fr 180px; gap:12px; align-items:center}
    .search{position:relative}
    .search input{width:100%; padding:14px 44px 14px 14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}
    .search input:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
    .search .icon{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.6}
    select{width:100%; padding:14px; border-radius:12px; border:1px solid #cbd5e1; background:#ffffff; color:var(--text)}

    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:14px; margin-top:14px}
    .card{background:var(--card); border:1px solid #e2e8f0; border-radius:16px; overflow:hidden; transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-4px); box-shadow:0 12px 30px #00000014}
    .thumb{height:140px; display:grid; place-items:center; font-size:60px; position:relative; overflow:hidden}
    .thumb .img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:.95}
    .thumb .emoji{position:relative; z-index:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}

    /* gradiente delicato legato all'habitat (fallback quando non c'√® immagine) */
    .hab-foresta{background: linear-gradient(135deg,#dcfce7,#bbf7d0)}
    .hab-savana{background: linear-gradient(135deg,#fef9c3,#fde68a)}
    .hab-oceano{background: linear-gradient(135deg,#e0f2fe,#bae6fd)}
    .hab-montagna{background: linear-gradient(135deg,#e2e8f0,#cbd5e1)}
    .hab-ghiaccio{background: linear-gradient(135deg,#f1f5f9,#e0f2fe)}
    .hab-deserto{background: linear-gradient(135deg,#ffedd5,#fed7aa)}
    .hab-prateria{background: linear-gradient(135deg,#d1fae5,#a7f3d0)}

    .badge{display:inline-block; padding:4px 8px; border:1px solid #c7d2fe; border-radius:999px; font-size:12px; color:#4338ca; background:#eef2ff}
    .card .body{padding:12px 14px}
    .card h3{margin:0 0 6px; font-size:18px}
    .meta{font-size:13px; color:var(--muted)}
    .card .actions{display:flex; gap:8px; margin-top:12px}
    .btn{appearance:none; border:none; padding:10px 12px; border-radius:10px; background:#dbf4ff; color:#0c4a6e; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px; align-items:center}
    .btn:hover{background:#bae6fd}

    .detail{margin-top:24px; display:grid; gap:18px}
    .back{color:var(--brand); text-decoration:none}
    .fact{background:#f8fafc; border:1px dashed #cbd5e1; border-radius:12px; padding:12px}

    footer{margin:30px 0 60px; color:var(--muted)}
    footer a{color:var(--brand)}

    .pillbar{display:flex; flex-wrap:wrap; gap:8px}
    .pill{padding:6px 10px; border-radius:999px; border:1px solid #cbd5e1; background:#ffffff; color:#334155; font-size:12px}

    /* Sezioni in dettaglio */
    .sections{display:grid; gap:12px}
    details{border:1px solid #e2e8f0; border-radius:12px; background:#ffffff}
    summary{cursor:pointer; padding:10px 12px; font-weight:600; color:#0f172a}
    details>div{padding:0 12px 12px}

    /* Toast */
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--brand),var(--brand-2));color:white;padding:10px 18px;border-radius:12px;box-shadow:0 8px 30px #00000026;opacity:0;pointer-events:none;transition:opacity .35s, transform .35s;z-index:9999}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-8px)}

    @media (max-width:700px){ .controls{grid-template-columns:1fr} }
  </style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <a class="logo" href="#/home" aria-label="Biolo‚ÄëGio home">
      <div class="mark">üß¨</div>
      <b>Biolo‚ÄëGio</b>
    </a>
    <nav>
      <a href="#/home">Home</a>
      <a href="#/animali">Animali</a>
      <a href="#/curiosita">Curiosit√†</a>
      <a href="#/contatti">Contatti</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>Enciclopedia degli animali, a misura di curiosit√†.</h1>
    <p>Scopri specie, habitat, dieta, stato di conservazione e piccole perle zoologiche. Tutto in un unico file HTML, perfetto per GitHub Pages.</p>
  </section>

  <section class="panel pad" id="controls">
    <div class="controls">
      <label class="search">
        <input id="q" placeholder="Cerca per nome, habitat, dieta‚Ä¶ (es. panda, savana, onnivoro)" autocomplete="off" />
        <span class="icon">üîé</span>
      </label>
      <label>
        <select id="filterClass">
          <option value="">Tutte le classi</option>
          <option>Mammiferi</option>
          <option>Uccelli</option>
          <option>Rettili</option>
          <option>Anfibi</option>
          <option>Pesci</option>
          <option>Invertebrati</option>
        </select>
      </label>
    </div>
    <div class="pillbar" id="quickTags" style="margin-top:10px"></div>
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn" id="btnRandom">üé≤ Animale casuale</button>
      <span class="meta">Consiglio: premi <kbd>R</kbd> per pescarne uno a caso (rispetta ricerca e filtri).</span>
    </div>
  </section>

  <section id="view"></section>

  <footer>
    <p>Progetto <b>Biolo‚ÄëGio</b>. Codice in un solo file per semplicit√†. Pubblica su GitHub Pages e condividi la meraviglia del regno animale.</p>
  </footer>
</main>

<!-- Toast container -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
// ==========================
// DATI IN-LINEA (modifica qui per aggiungere animali!)
// ==========================
const ANIMALS = [
  {
    name: "Panda gigante",
    scientificName: "Ailuropoda melanoleuca",
    class: "Mammiferi",
    emoji: "üêº",
    habitat: "Foreste di bamb√π, Cina",
    diet: "Erbivoro (bamb√π, occasionalmente proteine)",
    lifespan: "20‚Äì30 anni",
    size: "75‚Äì160 kg",
    conservation: "Vulnerabile (IUCN)",
    description: "Urside monofagico con adattamenti cranio‚Äëmandibolari (muscoli masseterini robusti, dentatura bunodonte) e ‚Äòfalso pollice‚Äô (sesamoide radiale) per la presa del bamb√π. Stomaco e intestino da carnivoro, ma microbiota cellulolitico; metabolismo basale ridotto per compensare la dieta povera di energia.",
    sociality: "Specie generalmente solitaria con overlap limitato tra home range; marcature odorose su tronchi e rocce (glande anali) e vocalizzazioni (belati, nitriti) per comunicazione a distanza. Le madri mostrano intenso comportamento materno in tane riparate.",
    reproduction: "Seasonal breeder primaverile: estro brevissimo (24‚Äì72 h) che richiede sincronizzazione fine con i maschi. Diapausa embrionale facoltativa; impianto ritardato. Gestazione 95‚Äì160 giorni, nidiata 1‚Äì2 (spesso sopravvive un solo neonato). Svezzamento ~8‚Äì9 mesi; maturit√† sessuale 4‚Äì6 anni.",
    feeding: "Dieta dominata da culmi e germogli di Phyllostachys e Fargesia; selezione delle parti pi√π proteiche nelle fasi fenologiche favorevoli. Tempo di alimentazione 10‚Äì14 h/die; ingestione 10‚Äì20 kg/die. Dentizione e cranio adattati alla frantumazione di tessuti lignocellulosici; fermentazione intestinale limitata ‚Üí necessit√† di alto throughput.",
    interactions: "Pochi predatori adulti; cuccioli vulnerabili a leopardoni. Specie ingegnere di ecosistema: la selezione del bamb√π influenza struttura del sottobosco e nicchie per altre specie.",
    human: "Specie bandiera per la conservazione: corridoi ecologici e riserve in Cina hanno favorito un recupero demografico. Programmi di captive breeding con reintroduzioni selettive; conflitti minimi con agricoltura.",
    fun: "Professionisti del relax: routine ‚Äòmordi, mastica, ripeti‚Äô. I neonati nascono rossicci, ciechi e grandi come una barretta di cioccolato.",
    facts: [
      "Ha un falso pollice (osso del polso) per afferrare il bamb√π.",
      "Passa fino a 14 ore al giorno a mangiare.",
      "I cuccioli nascono rosa e molto piccoli (circa 100 grammi)."
    ]
  },
  {
    name: "Tigre del Bengala",
    scientificName: "Panthera tigris tigris",
    class: "Mammiferi",
    emoji: "üêØ",
    habitat: "Foreste, mangrovie e praterie del subcontinente indiano",
    diet: "Carnivoro",
    lifespan: "8‚Äì15 anni in natura",
    size: "100‚Äì220 kg",
    conservation: "In pericolo (IUCN: Endangered)",
    description: "Felide apicale con dimorfismo sessuale marcato; pelliccia striata per cripto-mimesi nel sottobosco. Cranio robusto e canini ~7‚Äì9 cm; arti posteriori potenti per sprint corti e balzi.",
    sociality: "Generalmente solitaria; territori marcati con urine/sfregamenti e graffi; le femmine imparentate possono tollerare overlap. Comunicazione olfattiva e vocale (ruggito, ‚Äòprusten‚Äô ‚Äì soffio amichevole).",
    reproduction: "Ciclo estrale 3‚Äì9 settimane; estro ~3‚Äì6 giorni. Accoppiamenti multipli; gestazione 100‚Äì110 giorni; cucciolate 2‚Äì4. Cure parentali materne fino a 18‚Äì24 mesi; subadulti dispersi successivamente.",
    feeding: "Strategia ‚Äòstalk-and-ambush‚Äô: avvicinamento controvento, scatto esplosivo, morso alla gola o nuca. Dieta principale: cervidi (cervo sambar, chital), cinghiali; consumo singolo 18‚Äì40 kg con caching parziale.",
    interactions: "Competizione con leopardi e dholes; in Sundarbans interazioni con coccodrilli e fauna di mangrovia. Regola popolazioni di ungulati, influenzando cascata trofica.",
    human: "Conflitto nei paesaggi agro-forestali (predazione di bestiame) mitigato da recinzioni, corridoi e indennizzi. Aree protette e anti-bracconaggio hanno favorito il recupero in alcune metapopolazioni.",
    fun: "Audio surround: il ruggito viaggia chilometri. Nuotatrice provetta ‚Äî attraversa fiumi come fossero corsie di una piscina naturale.",
    facts: [
      "Ogni tigre ha strisce uniche come impronte digitali.",
      "Ottima nuotatrice: pu√≤ attraversare lunghi corsi d'acqua.",
      "Ruggito udibile fino a 3 km."
    ]
  },
  {
    name: "Polpo comune",
    scientificName: "Octopus vulgaris",
    class: "Invertebrati",
    emoji: "üêô",
    habitat: "Mari temperati e tropicali, fondali rocciosi",
    diet: "Carnivoro (crostacei, molluschi)",
    lifespan: "1‚Äì2 anni",
    size: "3‚Äì10 kg (variabile)",
    conservation: "Non minacciato globalmente (pressioni locali)",
    description: "Cefalopode dal sistema nervoso distribuito: ~2/3 dei neuroni nei bracci, che possono eseguire pattern motori semi‚Äëautonomi. Cromatofori, iridofori e papille cutanee generano mimetismo dinamico in millisecondi.",
    sociality: "Per lo pi√π solitario ma con siti ad alta densit√† (‚ÄòOctopolis/Octlantis‚Äô) dove si osservano interazioni complesse, inclusi displays e lanci di sedimento.",
    reproduction: "Semelparo: maschi usano l‚Äôectocotile per trasferire spermatofori; femmine curano migliaia di uova aerandole fino alla schiusa, poi muoiono (senescenza programmata endocrina).",
    feeding: "Predazione tattile-visiva: esplorazione con chemio-recettori sui bracci, foratura con il becco e iniezione di veleno. Abilit√† nel problem solving (barattoli, serrature).",
    interactions: "Predatori: murene, cernie, squali, foche. Mutualismi opportunistici con pesci durante la caccia; uso di conchiglie/rocce come ‚Äòattrezzi‚Äô per rifugi.",
    human: "Pesca costiera importante; crescente attenzione a benessere e cognizione animale; in ricerca come modello di plasticit√† neurale.",
    fun: "Ninja del fondale: cambia pelle e texture in un battito di ciglia. E se trova un barattolo? √à gi√† casa sua.",
    facts: [
      "Tre cuori e sangue blu per la emosianina.",
      "Capace di risolvere puzzle e aprire barattoli.",
      "Mimetismo sofisticato grazie a cromatofori e papille."
    ]
  },
  {
    name: "Aquila reale",
    scientificName: "Aquila chrysaetos",
    class: "Uccelli",
    emoji: "ü¶Ö",
    habitat: "Montagne e scogliere dell'emisfero nord",
    diet: "Carnivoro (predatore)",
    lifespan: "20‚Äì30 anni",
    size: "Fino a 2,3 m di apertura alare",
    conservation: "Least Concern (tutela locale varia)",
    description: "Grande rapace con ali lunghe a profilo alare per planata efficiente; visione 4‚Äì5√ó umana con fovea doppia. Artigli possenti e becco uncinato per trattenere e smembrare prede.",
    sociality: "Coppie territoriali monogame a lungo termine; nidi (aeree) monumentali riutilizzati e ampliati per decenni.",
    reproduction: "Deposizione 1‚Äì3 uova; siblicidio frequente in scarsit√† di risorse. Incubazione ~41‚Äì45 giorni; involo a 65‚Äì80 giorni; maturit√† 4‚Äì5 anni.",
    feeding: "Predazione su lepri, marmotte, tetraonidi; caccia in picchiata o planata radente. Necrofagia opportunista in inverno.",
    interactions: "Competizione con corvi/grifoni per carcasse; influenza top‚Äëdown su meso‚Äëpredatori.",
    human: "Sensibile al disturbo in periodo riproduttivo e a collisioni con infrastrutture (cavi eolico). Programmi di monitoraggio e protezione dei siti di nidificazione.",
    fun: "Pilota di alianti naturale: sfrutta le termiche come se avesse un variometro interno.",
    facts: [
      "Voli planati sfruttando correnti ascensionali per ore.",
      "Vista eccezionale, 4‚Äì5 volte pi√π acuta dell'umano.",
      "Nidi (aeree) riutilizzati e ampliati per anni."
    ]
  },
  {
    name: "Rana freccia velenosa",
    scientificName: "Dendrobates tinctorius",
    class: "Anfibi",
    emoji: "üê∏",
    habitat: "Foreste pluviali sudamericane",
    diet: "Insettivoro",
    lifespan: "6‚Äì10 anni",
    size: "2‚Äì5 cm",
    conservation: "Variabile per specie; minacce: deforestazione",
    description: "Piccoli anuri aposematici; gli alcaloidi cutanei sono sequestrati dalla dieta (formiche, acari) e conferiscono tossicit√† neuro‚Äë/cardiotossica. Pattern cromatico specie‚Äëspecifico come segnale onesto ai predatori.",
    sociality: "Territorialit√† dei maschi su micro‚Äëhabitat umidi; chiamate vocali per difesa e corteggiamento.",
    reproduction: "Cure parentali notevoli: trasporto dei girini sul dorso verso fitotelmi (ascelle di bromelie). Deposizione suolo/foliaggio; alimentazione dei girini con uova non fecondate in alcune specie.",
    feeding: "Predatori di micro‚Äëartropodi con lingua proiettile adesiva; attivit√† diurna con picchi in ore umide.",
    interactions: "Predatori imparano ad evitarle (apprendimento associativo). Possibile mimetismo m√ºlleriano tra specie tossiche.",
    human: "Uso etnobiologico di specie affini per veleni da dardo (non generalizzare!). Ricerca farmacologica sugli alcaloidi.",
    fun: "Look fluo, messaggio chiaro: ‚Äònon sono un confetto‚Äô.",
    facts: [
      "Colorazione aposematica: avverte i predatori della tossicit√†.",
      "Tossine derivate dalla dieta di artropodi.",
      "Cure parentali: trasporto dei girini sulle spalle."
    ]
  },
  {
    name: "Cane domestico",
    scientificName: "Canis familiaris",
    class: "Mammiferi",
    emoji: "üê∂",
    habitat: "Cosmopolita, associato all'uomo",
    diet: "Onnivoro (prevalenza carnivora)",
    lifespan: "10‚Äì14 anni (media)",
    size: "Varia moltissimo per razza",
    conservation: "‚Äî (specie domestica)",
    description: "Canide con la pi√π ampia variabilit√† morfologica tra i mammiferi; selezione artificiale ha modellato tratti comportamentali (pastore, guardia, compagnia). Spiccata capacit√† di leggere gesti e sguardo umano (cognizione sociale).",
    sociality: "Fortemente sociale; strutture gerarchiche flessibili; attaccamento interspecifico (teoria dell‚Äôattaccamento applicata ai cani).",
    reproduction: "Poliestrale non stagionale; gestazione ~63 giorni; cucciolate 1‚Äì12+. Socializzazione critica 3‚Äì12 settimane.",
    feeding: "Onnivoro con preferenza proteica; adattamento parziale all‚Äôamido in molte razze (copy number amilasi).",
    interactions: "Predazione su fauna urbana (uccelli piccoli, micromammiferi); vettori di zoonosi se non gestiti (rabbia in regioni endemiche).",
    human: "Servizi (ricerca e soccorso, assistenza, detection), sport, pet‚Äëtherapy. Responsabilit√†: benessere, vaccinazioni, sterilizzazione responsabile.",
    fun: "Poliglotta domestico: abbaia in dialetto ‚Äòfrigo aperto‚Äô.",
    facts: [
      "Olfatto con oltre 200 milioni di recettori in molte razze.",
      "Capace di comprendere decine di parole/comandi.",
      "Addomesticamento da almeno 15.000 anni."
    ]
  },
  {
    name: "Pinguino imperatore",
    scientificName: "Aptenodytes forsteri",
    class: "Uccelli",
    emoji: "üêß",
    habitat: "Antartide",
    diet: "Piscivoro",
    lifespan: "15‚Äì20 anni",
    size: "1,1‚Äì1,3 m; 20‚Äì40 kg",
    conservation: "Quasi minacciato (IUCN)",
    description: "Sfeniscide massimo per taglia; isolamento multistrato (piume dense + grasso sottocutaneo) e emoglobina con alte affinit√† variabili per O2 consentono immersioni profonde e lunghe.",
    sociality: "Coloniale; huddling cooperativo che riduce perdita di calore fino al 50%. Comunicazioni vocali individuali per riconoscimento parentale.",
    reproduction: "Ciclo riproduttivo in pieno inverno antartico: uovo unico trasferito con rituale ai piedi del maschio; digiuno prolungato del maschio fino alla schiusa.",
    feeding: "Prede: pesci, krill, cefalopodi. Immersioni >500 m, bradicardia indotta, vasocostrizione periferica.",
    interactions: "Predazione da foche leopardo e orche; competizione su colonie con altre specie di pinguini.",
    human: "Specie indicatrice del ghiaccio marino: vulnerabile alla riduzione dei pack in scenari climatici di riscaldamento.",
    fun: "Maestri dello scivolo ventrale: spostamenti rapidi e scenografici.",
    facts: [
      "Incubazione affidata al maschio durante l'inverno.",
      "Immersioni oltre 500 m trattenendo il respiro per 20 min.",
      "Fitta plumatura e grasso per isolamento termico."
    ]
  },
  {
    name: "Squalo balena",
    scientificName: "Rhincodon typus",
    class: "Pesci",
    emoji: "ü¶à",
    habitat: "Mari tropicali e caldi",
    diet: "Filtratore (plancton)",
    lifespan: "70+ anni (stima)",
    size: "12‚Äì18 m",
    conservation: "In pericolo (IUCN)",
    description: "Il pi√π grande pesce vivente; filtro branchiale con lamelle dermiche per catturare plancton e uova. Strategia di nuoto lento ad alta efficienza energetica; pattern di macchie unico per individuo.",
    sociality: "Aggregazioni stagionali in aree di fioriture planctoniche/ spawning di pesci; solitario il resto dell‚Äôanno.",
    reproduction: "Ovoviviparo con numerosi embrioni a stadi diversi nello stesso utero; maturit√† tardiva.",
    feeding: "Suction‚Äëfilter e ram‚Äëfeeding in colonne d‚Äôacqua ricche; bocca subterminale ampia.",
    interactions: "Pochi predatori naturali (grandi squali, orche). Spesso accompagnato da remore e pesci pilota.",
    human: "Minacce: bycatch, collisioni con imbarcazioni, turismo mal gestito. Valore ecoturistico se regolato.",
    fun: "Gentile gigante che sa fare selfie migliori di molti influencer.",
    facts: [
      "Il pesce pi√π grande esistente.",
      "Macchie uniche come un'impronta.",
      "Gentile gigante, spesso curioso verso i sub."
    ]
  },
  {
    name: "Tartaruga marina verde",
    scientificName: "Chelonia mydas",
    class: "Rettili",
    emoji: "üê¢",
    habitat: "Mare tropicale/subtropicale; spiagge per la nidificazione",
    diet: "Erbivoro (alghe, fanerogame)",
    lifespan: "80+ anni",
    size: "100‚Äì180 kg",
    conservation: "In pericolo (IUCN)",
    description: "Chelonide con filopatria alle spiagge natali; navigazione magnetica (mappa geomagnetica). Dieta adulta erbivora che modella le praterie di fanerogame (ruolo ingegneristico).",
    sociality: "In mare prevalentemente solitarie; congregazioni su feeding grounds e rotte migratorie.",
    reproduction: "Pi√π deposizioni per stagione (clutches) distanziate di ~2 settimane; temperatura del nido determina il sesso (TSD). Schiusa sincronizzata per saturare i predatori.",
    feeding: "Brucatura selettiva di fanerogame e macroalghe; giovani pi√π onnivori.",
    interactions: "Predatori naturali (squali, orche); minacce antropiche: plastica, reti da pesca, luce artificiale sulle spiagge.",
    human: "Specie protetta con progetti di conservazione costiera, illuminotecnica ‚Äòturtle‚Äëfriendly‚Äô e dispositivi TED nelle reti.",
    fun: "GPS magnetico integrato: bussola interna migliore di molte app.",
    facts: [
      "Migrazioni oceaniche di migliaia di km.",
      "Determinazione del sesso dipende dalla temperatura del nido.",
      "Ritorno alla spiaggia natale per deporre."
    ]
  },
  {
    name: "Api da miele",
    scientificName: "Apis mellifera",
    class: "Invertebrati",
    emoji: "üêù",
    habitat: "Cosmopolita, ambienti con fiori",
    diet: "Nettare e polline",
    lifespan: "Operaia: ~6 settimane; regina: anni",
    size: "~1‚Äì1,5 cm",
    conservation: "Pressioni: pesticidi, patogeni, perdita habitat",
    description: "Eusociali con superorganismo organizzato in caste; comunicazione tramite waggle dance per codificare distanza e direzione delle risorse. Termoregolazione collettiva dell‚Äôalveare.",
    sociality: "Colonie con regina (riproduzione), operaie (foraggiamento, cura covata, difesa) e fuchi (accoppiamento). Decisioni collettive per siti di nido tramite quorum.",
    reproduction: "Regina si accoppia in voli nuziali multipli; ovideposizione massiva in stagione. Sciamatura come riproduzione della colonia.",
    feeding: "Nettare ‚Üí miele tramite disidratazione ed enzimi; polline come fonte proteica per larve. Navigazione con sole e segnali magnetici.",
    interactions: "Impollinatrici chiave in agroecosistemi; competizione/patogeni condivisi con impollinatori selvatici.",
    human: "Apicoltura, servizi ecosistemici, prodotti (miele, cera, propoli). Pratiche a basso impatto per sostenibilit√†.",
    fun: "Coreografia a otto per dire ‚Äòristorante fiorito a ore dieci, 200 metri‚Äô.",
    facts: [
      "Danza dell'addome per comunicare la posizione del cibo.",
      "Impollinatrici chiave per agricoltura ed ecosistemi.",
      "Colonie con suddivisione in caste."
    ]
  }
];

// ==========================
// UTILIT√Ä
// ==========================
const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")
  .replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
const by = key => (a,b)=> (a[key]||"").localeCompare(b[key]||"");
const qs = sel => document.querySelector(sel);
const qsa = sel => [...document.querySelectorAll(sel)];
const state = { q:"", cls:"", route:"/home" };

const habClass = (hab='')=>{
  const h = hab.toLowerCase();
const toTheme = (habClass)=>{
  switch(habClass){
    case 'hab-foresta': return 'theme-foresta';
    case 'hab-savana': return 'theme-savana';
    case 'hab-ghiaccio': return 'theme-ghiaccio';
    case 'hab-oceano': return 'theme-oceano';
    case 'hab-montagna': return 'theme-montagna';
    case 'hab-deserto': return 'theme-deserto';
    case 'hab-prateria': return 'theme-prateria';
    default: return '';
  }
};
const THEMES = ['theme-foresta','theme-savana','theme-oceano','theme-montagna','theme-ghiaccio','theme-deserto','theme-prateria'];
function applyTheme(theme){
  document.body.classList.remove(...THEMES);
  if(theme) document.body.classList.add(theme);
}
  if(h.includes('bamb√π')||h.includes('foreste')||h.includes('foresta')) return 'hab-foresta';
  if(h.includes('savana')||h.includes('prateria')) return 'hab-savana';
  if(h.includes('antart')||h.includes('ghiaccio')) return 'hab-ghiaccio';
  if(h.includes('mare')||h.includes('oceano')||h.includes('coste')||h.includes('tropicali')) return 'hab-oceano';
  if(h.includes('montagne')||h.includes('scogliere')) return 'hab-montagna';
  if(h.includes('deserto')) return 'hab-deserto';
  return '';
};

ANIMALS.forEach(a=>{ a.id = slug(a.name); a._hay = [a.name,a.scientificName,a.habitat,a.diet,a.class].join(" ").toLowerCase(); });

// ==========================
// RENDER
// ==========================
function render(){
  const container = qs('#view');
  const hash = location.hash.replace('#','') || '/home';
  state.route = hash;

  if(hash.startsWith('/animal/')){
    const id = hash.split('/')[2];
    const a = ANIMALS.find(x=>x.id===id);
    if(a){ applyTheme(toTheme(habClass(a.habitat))); }
    container.innerHTML = a ? detailTpl(a) : notFoundTpl();
    return;
  }
  if(hash==='/contatti')  { applyTheme(''); container.innerHTML = contattiTpl();  return; }

  // Home / elenco ‚Üí sfondo habitat casuale
  applyTheme(THEMES[Math.floor(Math.random()*THEMES.length)]);
  container.innerHTML = listTpl();
}
  if(hash==='/curiosita') { container.innerHTML = curiositaTpl(); return; }
  if(hash==='/contatti')  { container.innerHTML = contattiTpl();  return; }

  container.innerHTML = listTpl();
}

function filteredItems(){
  const q = state.q.trim().toLowerCase();
  return ANIMALS
    .filter(a => (!q || a._hay.includes(q)))
    .filter(a => (!state.cls || a.class===state.cls))
    .sort(by('name'));
}

function listTpl(){
  const items = filteredItems();
  const cards = items.map(cardTpl).join('');
  return `<div class="grid">${cards || emptyTpl()}</div>`;
}

function cardTpl(a){
  const hc = habClass(a.habitat);
  return `
    <article class="card" aria-label="${a.name}">
      <div class="thumb ${hc}" aria-hidden="true">
        ${a.image ? `<img class='img' src='${a.image}' alt='${a.name}' loading='lazy'/>` : ''}
        <div class="emoji">${a.emoji || 'üß¨'}</div>
      </div>
      <div class="body">
        <span class="badge">${a.class}</span>
        <h3>${a.name}</h3>
        <div class="meta"><i>${a.scientificName}</i></div>
        <div class="actions">
          <a class="btn" href="#/animal/${a.id}">Scheda</a>
          <a class="btn" href="#/curiosita" title="Vai alle curiosit√†">‚ú®</a>
        </div>
      </div>
    </article>`;
}

function detailTpl(a){
  const facts = a.facts.map(f=>`<li>${f}</li>`).join('');
  const hc = habClass(a.habitat);
  return `
    <div class="detail">
      <a class="back" href="javascript:history.back()">‚Üê Torna indietro</a>
      <div class="panel pad">
        <div style="display:flex; gap:16px; align-items:center; flex-wrap:wrap">
          <div class="thumb ${hc}" style="width:140px; height:140px; font-size:64px">
            ${a.image ? `<img class='img' src='${a.image}' alt='${a.name}' loading='lazy'/>` : ''}
            <div class="emoji">${a.emoji||'üß¨'}</div>
          </div>
          <div style="flex:1; min-width:240px">
            <h2 style="margin:0 0 6px">${a.name}</h2>
            <div class="meta"><i>${a.scientificName}</i></div>
            <div class="pillbar" style="margin-top:10px">
              <span class="pill">Classe: ${a.class}</span>
              <span class="pill">Habitat: ${a.habitat}</span>
              <span class="pill">Dieta: ${a.diet}</span>
              <span class="pill">Vita media: ${a.lifespan}</span>
              <span class="pill">Taglia: ${a.size}</span>
              <span class="pill">Conservazione: ${a.conservation}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="sections">
        <details open>
          <summary>Descrizione scientifica</summary>
          <div><p>${a.description||'‚Äî'}</p></div>
        </details>
        <details>
          <summary>Socialit√†</summary>
          <div><p>${a.sociality||'‚Äî'}</p></div>
        </details>
        <details>
          <summary>Riproduzione</summary>
          <div><p>${a.reproduction||'‚Äî'}</p></div>
        </details>
        <details>
          <summary>Alimentazione / Caccia</summary>
          <div><p>${a.feeding||'‚Äî'}</p></div>
        </details>
        <details>
          <summary>Interazioni ecologiche</summary>
          <div><p>${a.interactions||'‚Äî'}</p></div>
        </details>
        <details>
          <summary>Rapporto con l'uomo</summary>
          <div><p>${a.human||'‚Äî'}</p></div>
        </details>
        <details>
          <summary>Curiosit√† accattivanti</summary>
          <div>
            <p>${a.fun||''}</p>
            <ul style="margin-top:8px">${facts}</ul>
          </div>
        </details>
      </div>

      <div>
        <a class="btn" href="#/animali">Torna all'elenco</a>
      </div>
    </div>`;
}

function curiositaTpl(){
  const pick = (arr)=> arr[Math.floor(Math.random()*arr.length)];
  const facts = [];
  for(let i=0;i<6;i++){
    const a = pick(ANIMALS);
    facts.push(`<li><b>${a.name}:</b> ${pick(a.facts)}</li>`);
  }
  return `
    <div class="panel pad">
      <h2 style="margin-top:0">Curiosit√† casuali ‚ú®</h2>
      <p class="meta">Aggiorna la pagina per nuove chicche.</p>
      <ul>${facts.join('')}</ul>
    </div>`;
}

function contattiTpl(){
  return `
    <div class="panel pad">
      <h2 style="margin-top:0">Contatti</h2>
      <p>Progetto didattico. Per suggerimenti o collaborazioni, apri una issue sul repository GitHub del progetto oppure invia un messaggio tramite i canali indicati nel profilo.</p>
      <p class="meta">Suggerimento: crea un file <code>README.md</code> nel repository con le istruzioni per contribuire.</p>
    </div>`;
}

function notFoundTpl(){ return `<div class="panel pad"><h2>Ops!</h2><p>Animale non trovato.</p></div>` }
function emptyTpl(){ return `<div class="panel pad"><p>Nessun risultato. Prova a cambiare ricerca o filtro.</p></div>` }

// ==========================
// TOAST & RANDOM
// ==========================
function showToast(msg){
  const t = qs('#toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=> t.classList.remove('show'), 2000);
}

function goRandom(){
  const items = filteredItems();
  if(!items.length) return;
  const pick = items[Math.floor(Math.random()*items.length)];
  location.hash = `#/animal/${pick.id}`;
  showToast(`Hai pescato: ${pick.name}! üé≤`);
}

// ==========================
// INTERAZIONE
// ==========================
function setupControls(){
  qs('#q').addEventListener('input', e=>{ state.q = e.target.value; render(); });
  qs('#filterClass').addEventListener('change', e=>{ state.cls = e.target.value; render(); });

  // Tag rapidi
  const tags = ["Foreste","Savana","Antartide","Oceano","Montagne","Erbivoro","Carnivoro","Onnivoro","Filtratore","Insettivoro"];
  qs('#quickTags').innerHTML = tags.map(t=>`<button class="btn" data-tag="${t.toLowerCase()}">${t}</button>`).join('');
  qsa('#quickTags .btn').forEach(b=> b.addEventListener('click', ()=>{ qs('#q').value = b.dataset.tag; state.q = b.dataset.tag; render(); }));

  // Bottone animale casuale
  const br = qs('#btnRandom');
  if(br) br.addEventListener('click', goRandom);

  // Shortcut da tastiera: R ‚Üí random (disattiva con meta/ctrl/alt per non confliggere)
  window.addEventListener('keydown', (e)=>{
    if(e.key && e.key.toLowerCase()==='r' && !e.metaKey && !e.ctrlKey && !e.altKey){
      // evita trigger se stai scrivendo nella search
      const active = document.activeElement;
      if(active && (active.tagName==='INPUT' || active.tagName==='TEXTAREA')) return;
      e.preventDefault();
      goRandom();
    }
  });
}

window.addEventListener('hashchange', render);
window.addEventListener('DOMContentLoaded', ()=>{ setupControls(); render(); });
</script>
</body>
</html>
